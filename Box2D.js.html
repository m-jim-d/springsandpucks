<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://triquence.org/Box2D.js.html' />
  <title>Box2D.js</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #3D7B7B; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
body .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
body .cp { color: #9C6500 } /* Comment.Preproc */
body .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
body .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #E40000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #008400 } /* Generic.Inserted */
body .go { color: #717171 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #687822 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #717171; font-weight: bold } /* Name.Entity */
body .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #767600 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #A45A77 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">b2DW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span><span class="w"> </span>
<span class="w">   </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;b2DW _*-*_&quot;</span><span class="p">);</span>
<span class="w">   </span>
<span class="w">   </span><span class="cm">/*</span>
<span class="cm">   * Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com</span>
<span class="cm">   *</span>
<span class="cm">   * This software is provided &#39;as-is&#39;, without any express or implied</span>
<span class="cm">   * warranty.  In no event will the authors be held liable for any damages</span>
<span class="cm">   * arising from the use of this software.</span>
<span class="cm">   * Permission is granted to anyone to use this software for any purpose,</span>
<span class="cm">   * including commercial applications, and to alter it and redistribute it</span>
<span class="cm">   * freely, subject to the following restrictions:</span>
<span class="cm">   * 1. The origin of this software must not be misrepresented; you must not</span>
<span class="cm">   * claim that you wrote the original software. If you use this software</span>
<span class="cm">   * in a product, an acknowledgment in the product documentation would be</span>
<span class="cm">   * appreciated but is not required.</span>
<span class="cm">   * 2. Altered source versions must be plainly marked as such, and must not be</span>
<span class="cm">   * misrepresented as being the original software.</span>
<span class="cm">   * 3. This notice may not be removed or altered from any source distribution.</span>
<span class="cm">   */</span>

<span class="w">   </span><span class="cm">/* </span>
<span class="cm">      JDM:  1:02 PM Thu July 20, 2023</span>
<span class="cm">      * Modified the code relating to mixed restitution. Colliding bodies now use the </span>
<span class="cm">        lowest restitution of the two bodies. Search on JDM to find the related changes.</span>
<span class="cm">      * Implemented the bug fix related to Object.defineProperty as discussed on GitHub.</span>
<span class="cm">      * Ran ESLint on this code. It found a few minor issues that I have commented on.</span>
<span class="cm">      * Put everything in a closure. See public references that are revealed at the end</span>
<span class="cm">        (more can be added).</span>
<span class="cm">   */</span>

<span class="w">   </span><span class="c1">// beginning of original code</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">Box2D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a2j</span><span class="p">,</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// JDM: in next line, changed Object.prototype.defineProperty to Object.defineProperty</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="p">)</span>
<span class="w">         </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span>
<span class="w">         </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">get</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="p">)</span>
<span class="w">               </span><span class="nx">obj</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">get</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">set</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="p">)</span>
<span class="w">               </span><span class="nx">obj</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span><span class="w"> </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">emptyFn</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">a2j</span><span class="p">.</span><span class="nx">inherit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">cls</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmpCtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cls</span><span class="p">;</span>
<span class="w">         </span><span class="nx">emptyFn</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">base</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cls</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">emptyFn</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cls</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmpCtr</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">a2j</span><span class="p">.</span><span class="nx">generateCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">generateCallback</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cb</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">a2j</span><span class="p">.</span><span class="nx">NVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">NVector</span><span class="p">(</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="nx">length</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span>
<span class="w">         </span><span class="nx">tmp</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">tmp</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">a2j</span><span class="p">.</span><span class="nx">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">is</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span><span class="w"> </span><span class="nx">o2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">o1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">o2</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Function</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">o1</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">o2</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">o1</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">__implements</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">o1</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">__implements</span><span class="p">[</span><span class="nx">o2</span><span class="p">]))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">a2j</span><span class="p">.</span><span class="nx">parseUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">   </span><span class="p">})(</span><span class="nx">Box2D</span><span class="p">);</span>

<span class="w">   </span><span class="c1">//#TODO remove assignments from global namespace</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">Vector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">;</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">NVector</span><span class="p">;</span>
<span class="w">   </span><span class="c1">//package structure</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">   </span><span class="c1">//pre-definitions</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">IBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Box2D.Collision.IBroadPhase&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Bound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Bound</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2BoundValues</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2BoundValues</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2BoundValues</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2BoundValues</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactPoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactPoint</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactPoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Distance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Distance</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DistanceInput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DistanceInput</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DistanceInput</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DistanceOutput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DistanceOutput</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DistanceOutput</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DynamicTree</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2DynamicTree</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DynamicTree</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DynamicTreeNode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DynamicTreeNode</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DynamicTreeNode</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DynamicTreePair</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DynamicTreePair</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DynamicTreePair</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Point</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Point</span><span class="p">.</span><span class="nx">b2Point</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Point</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2RayCastInput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2RayCastInput</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2RayCastInput</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RayCastInput</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2RayCastOutput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2RayCastOutput</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RayCastOutput</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Segment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Segment</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Simplex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Simplex</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Simplex</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2SimplexCache</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2SimplexCache</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SimplexCache</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2SimplexVertex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2SimplexVertex</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SimplexVertex</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2TOIInput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2TOIInput</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TOIInput</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2WorldManifold</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2WorldManifold</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2WorldManifold</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">ClipVertex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">ClipVertex</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ClipVertex</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">Features</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Features</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Features</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2EdgeChainDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2EdgeChainDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2EdgeChainDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2MassData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2MassData</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">;</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Box2D.Common.b2internal&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2BodyDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2BodyDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2BodyDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactFilter</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactImpulse</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactImpulse</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactListener</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ContactManager</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactManager</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DestructionListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DestructionListener</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2FilterData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2FilterData</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2FixtureDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2FixtureDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2FixtureDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Island</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Island</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Island</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2TimeStep</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeStep</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2World</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2World</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2CircleContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2CircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2CircleContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactConstraint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactConstraint</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ContactConstraint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactConstraint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactConstraintPoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactConstraintPoint</span><span class="p">.</span><span class="nx">b2ContactConstraintPoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraintPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactConstraintPoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactEdge</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactEdge</span><span class="p">.</span><span class="nx">b2ContactEdge</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactEdge</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ContactFactory</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactFactory</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactRegister</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactRegister</span><span class="p">.</span><span class="nx">b2ContactRegister</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactRegister</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactResult</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactResult</span><span class="p">.</span><span class="nx">b2ContactResult</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactResult</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2EdgeAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2NullContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2NullContact</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2NullContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PolyAndCircleContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PolyAndCircleContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndEdgeContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PolygonContact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolygonContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PolygonContact</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PositionSolverManifold</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PositionSolverManifold</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PositionSolverManifold</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2BuoyancyController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2BuoyancyController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2BuoyancyController</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ConstantAccelController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ConstantAccelController</span><span class="p">.</span><span class="nx">b2ConstantAccelController</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ConstantAccelController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ConstantAccelController</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ConstantForceController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ConstantForceController</span><span class="p">.</span><span class="nx">b2ConstantForceController</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ConstantForceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ConstantForceController</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Controller</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Controller</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2ControllerEdge</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2ControllerEdge</span><span class="p">.</span><span class="nx">b2ControllerEdge</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ControllerEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ControllerEdge</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2GravityController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2GravityController</span><span class="p">.</span><span class="nx">b2GravityController</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2GravityController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2GravityController</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2TensorDampingController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2TensorDampingController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TensorDampingController</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DistanceJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2DistanceJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DistanceJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2DistanceJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2DistanceJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2DistanceJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2FrictionJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2FrictionJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2FrictionJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2FrictionJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2FrictionJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2FrictionJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2GearJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2GearJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2GearJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2GearJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2GearJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2GearJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Jacobian</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Jacobian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Jacobian</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2JointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2JointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2JointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2JointEdge</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2JointEdge</span><span class="p">.</span><span class="nx">b2JointEdge</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2JointEdge</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2LineJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2LineJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2LineJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2LineJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2LineJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2LineJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2MouseJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2MouseJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2MouseJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2MouseJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2MouseJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2MouseJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PrismaticJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PrismaticJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PrismaticJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2PulleyJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2PulleyJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PulleyJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2RevoluteJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2RevoluteJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RevoluteJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2WeldJoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2WeldJoint</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2WeldJoint</span><span class="p">;</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">b2WeldJointDef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">constructor</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">b2WeldJointDef</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2WeldJointDef</span><span class="p">;</span>
<span class="w">   </span><span class="p">})();</span><span class="w"> </span><span class="c1">//definitions</span>
<span class="w">   </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Bound</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Point</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Segment</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Features</span><span class="p">,</span>
<span class="w">         </span><span class="nx">IBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">IBroadPhase</span><span class="p">;</span>

<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">valid</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetExtents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Contains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">absDX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dX</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">absDY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">absDX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">pX</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">inv_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d</span><span class="p">;</span>
<span class="w">               </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d</span><span class="p">;</span>
<span class="w">               </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">t2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t2</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t3</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">tmin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">tmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">tmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">tmax</span><span class="p">,</span><span class="w"> </span><span class="nx">t2</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">tmin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">tmax</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">absDY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">pY</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">inv_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d</span><span class="p">;</span>
<span class="w">               </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d</span><span class="p">;</span>
<span class="w">               </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">t2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t2</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t3</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">tmin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">tmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">tmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">tmax</span><span class="p">,</span><span class="w"> </span><span class="nx">t2</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">tmin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">tmax</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">output</span><span class="p">.</span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmin</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d1X</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2X</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">Combine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb1</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">Combine</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">aabb</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Combine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb1</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Bound</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tempValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tempProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tempStabbingCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">stabbingCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">proxy</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">stabbingCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">stabbingCount</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tempValue</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tempProxy</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">stabbingCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tempStabbingCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2BoundValues</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2BoundValues</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerValues</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerValues</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperValues</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperValues</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">ClipSegmentToLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vOut</span><span class="p">,</span><span class="w"> </span><span class="nx">vIn</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cv</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">numOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vIn0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vIn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">distance0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">distance1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">vIn1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">vIn1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distance0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">vOut</span><span class="p">[</span><span class="nx">numOut</span><span class="o">++</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distance1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">vOut</span><span class="p">[</span><span class="nx">numOut</span><span class="o">++</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distance0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">distance1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">distance0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">distance0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">distance1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vOut</span><span class="p">[</span><span class="nx">numOut</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">interp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">vIn1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">interp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">vIn1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vIn0</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vOut</span><span class="p">[</span><span class="nx">numOut</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">cv2</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distance0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">cv2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">               </span><span class="nx">cv</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv2</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">cv2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">               </span><span class="nx">cv</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv2</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="o">++</span><span class="nx">numOut</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">numOut</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">EdgeSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge1</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">edge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normals1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals1</span><span class="p">[</span><span class="nx">edge1</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1WorldX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1WorldY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">minDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count2</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices2</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">minDot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">minDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dot</span><span class="p">;</span>
<span class="w">               </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices1</span><span class="p">[</span><span class="nx">edge1</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices2</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">v2X</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v1X</span><span class="p">;</span>
<span class="w">         </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1WorldY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">separation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">FindMaxSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">edgeIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normals1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">;</span>
<span class="w">         </span><span class="nx">dX</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dLocal1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dLocal1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count1</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals1</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dLocal1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dLocal1Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxDot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">maxDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dot</span><span class="p">;</span>
<span class="w">               </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">EdgeSeparation</span><span class="p">(</span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">prevEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">edge</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sPrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">EdgeSeparation</span><span class="p">(</span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">prevEdge</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">nextEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">edge</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">EdgeSeparation</span><span class="p">(</span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">nextEdge</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sPrev</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">sPrev</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">sNext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prevEdge</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bestSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sPrev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sNext</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nextEdge</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bestSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sNext</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">edgeIndex</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// JDM: ESLint warning = constant condition</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">increment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">EdgeSeparation</span><span class="p">(</span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">bestSeparation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bestEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bestSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">edgeIndex</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bestEdge</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">bestSeparation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">FindIncidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge1</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">edge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normals1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normals2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly2</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals1</span><span class="p">[</span><span class="nx">edge1</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">normal1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">normal1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">minDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count2</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals2</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">normal1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">minDot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">minDot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dot</span><span class="p">;</span>
<span class="w">               </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tClip</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tClip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices2</span><span class="p">[</span><span class="nx">i1</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">referenceEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">incidentVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices2</span><span class="p">[</span><span class="nx">i2</span><span class="p">];</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">referenceEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tClip</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">incidentVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">MakeClipPointVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ClipVertex</span><span class="p">();</span>
<span class="w">         </span><span class="nx">r</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ClipVertex</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollidePolygons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">polyA</span><span class="p">,</span><span class="w"> </span><span class="nx">xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">polyB</span><span class="p">,</span><span class="w"> </span><span class="nx">xfB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cv</span><span class="p">;</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">totalRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polyA</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polyB</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edgeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeAO</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edgeA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">separationA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">FindMaxSeparation</span><span class="p">(</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeAO</span><span class="p">,</span><span class="w"> </span><span class="nx">polyA</span><span class="p">,</span><span class="w"> </span><span class="nx">xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">polyB</span><span class="p">,</span><span class="w"> </span><span class="nx">xfB</span><span class="p">);</span>
<span class="w">         </span><span class="nx">edgeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeAO</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separationA</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">totalRadius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edgeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeBO</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edgeB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">separationB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">FindMaxSeparation</span><span class="p">(</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeBO</span><span class="p">,</span><span class="w"> </span><span class="nx">polyB</span><span class="p">,</span><span class="w"> </span><span class="nx">xfB</span><span class="p">,</span><span class="w"> </span><span class="nx">polyA</span><span class="p">,</span><span class="w"> </span><span class="nx">xfA</span><span class="p">);</span>
<span class="w">         </span><span class="nx">edgeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeBO</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separationB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">totalRadius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">poly1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">poly2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_relativeTol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.98</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_absoluteTol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.001</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separationB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">k_relativeTol</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">separationA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">k_absoluteTol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">poly1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polyB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">poly2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polyA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">xf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">edge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edgeB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">poly1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polyA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">poly2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polyB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">xf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">edge1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edgeA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_incidentEdge</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">FindIncidentEdge</span><span class="p">(</span><span class="nx">incidentEdge</span><span class="p">,</span><span class="w"> </span><span class="nx">poly1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge1</span><span class="p">,</span><span class="w"> </span><span class="nx">poly2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly1</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">local_v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices1</span><span class="p">[</span><span class="nx">edge1</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">local_v12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices1</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">edge1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)];</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">local_v12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices1</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localTangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_localTangent</span><span class="p">;</span>
<span class="w">         </span><span class="nx">localTangent</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_localNormal</span><span class="p">;</span>
<span class="w">         </span><span class="nx">localNormal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">localNormal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">planePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_planePoint</span><span class="p">;</span>
<span class="w">         </span><span class="nx">planePoint</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_tangent</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localTangent</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangent2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_tangent2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tangent2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">tangent</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tangent2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">tangent</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_normal</span><span class="p">;</span>
<span class="w">         </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">tangent</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_v11</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_v12</span><span class="p">;</span>
<span class="w">         </span><span class="nx">v11</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">v11</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v11</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">v12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">v12</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">local_v12</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">frontOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v11</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v11</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sideOffset1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">tangent</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v11</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v11</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">totalRadius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sideOffset2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tangent</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v12</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">totalRadius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPoints1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_clipPoints1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPoints2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_clipPoints2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">ClipSegmentToLine</span><span class="p">(</span><span class="nx">clipPoints1</span><span class="p">,</span><span class="w"> </span><span class="nx">incidentEdge</span><span class="p">,</span><span class="w"> </span><span class="nx">tangent2</span><span class="p">,</span><span class="w"> </span><span class="nx">sideOffset1</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">np</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="nx">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">ClipSegmentToLine</span><span class="p">(</span><span class="nx">clipPoints2</span><span class="p">,</span><span class="w"> </span><span class="nx">clipPoints1</span><span class="p">,</span><span class="w"> </span><span class="nx">tangent</span><span class="p">,</span><span class="w"> </span><span class="nx">sideOffset2</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">np</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">localNormal</span><span class="p">);</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">planePoint</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPoints2</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">frontOffset</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">totalRadius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">pointCount</span><span class="p">];</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cv</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_id</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">cv</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">               </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flip</span><span class="p">;</span>
<span class="w">               </span><span class="o">++</span><span class="nx">pointCount</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollideCircles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">circle1</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">circle2</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle1</span><span class="p">.</span><span class="nx">m_p</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle2</span><span class="p">.</span><span class="nx">m_p</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">distSqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle1</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">circle2</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distSqr</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_circles</span><span class="p">;</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle1</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle2</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollidePolygonAndCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">polygon</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">circle</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tPoint</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">separation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertIndex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">normalIndex</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertIndex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">vertIndex1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">vertIndex1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">vertIndex1</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">vertIndex2</span><span class="p">];</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">normals</span><span class="p">[</span><span class="nx">normalIndex</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">u1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">u2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">faceCenterX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">faceCenterY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">faceCenterX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normals</span><span class="p">[</span><span class="nx">vertIndex1</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">faceCenterY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normals</span><span class="p">[</span><span class="nx">vertIndex1</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals</span><span class="p">[</span><span class="nx">vertIndex1</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normals</span><span class="p">[</span><span class="nx">vertIndex1</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">faceCenterX</span><span class="p">,</span><span class="w"> </span><span class="nx">faceCenterY</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">            </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">t2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">t2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">;</span>
<span class="w">         </span><span class="nx">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">t2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">t2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d1X</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2X</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">MakeClipPointVector</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_clipPoints1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">MakeClipPointVector</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_clipPoints2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">MakeClipPointVector</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeAO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_edgeBO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_localTangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_localNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_planePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_tangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_tangent2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">s_v12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">b2CollidePolyTempVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">b2_nullFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Features</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">_m_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">.</span><span class="nx">_key</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">();</span>
<span class="w">         </span><span class="nx">id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2ContactID</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;key&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">_referenceEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">_incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000ff00</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">_incidentVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00ff0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">_flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff000000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">24</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ContactPoint</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="o">++</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2_gjkCalls</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">transformA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">transformA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">transformB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">transformB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_simplex</span><span class="p">;</span>
<span class="w">         </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">ReadCache</span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">,</span><span class="w"> </span><span class="nx">transformB</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_maxIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">saveA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_saveA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">saveB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_saveB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">saveCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">closestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">GetClosestPoint</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">distanceSqr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">closestPoint</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">distanceSqr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">distanceSqr1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">iter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">k_maxIters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">saveCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">saveCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">saveA</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexA</span><span class="p">;</span>
<span class="w">               </span><span class="nx">saveB</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexB</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">               </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">Solve2</span><span class="p">();</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">3</span><span class="o">:</span>
<span class="w">               </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">Solve3</span><span class="p">();</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span>
<span class="w">               </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">GetClosestPoint</span><span class="p">();</span>
<span class="w">            </span><span class="nx">distanceSqr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">distanceSqr2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">distanceSqr1</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// JDM: ESLint warning = empty block</span>
<span class="w">            </span><span class="nx">distanceSqr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">distanceSqr2</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">GetSearchDirection</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_count</span><span class="p">];</span>
<span class="w">            </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">GetSupport</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">()));</span>
<span class="w">            </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexA</span><span class="p">));</span>
<span class="w">            </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">GetSupport</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">));</span>
<span class="w">            </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexB</span><span class="p">));</span>
<span class="w">            </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">vertex</span><span class="p">.</span><span class="nx">wB</span><span class="p">,</span><span class="w"> </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">wA</span><span class="p">);</span>
<span class="w">            </span><span class="o">++</span><span class="nx">iter</span><span class="p">;</span>
<span class="w">            </span><span class="o">++</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2_gjkIters</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">duplicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">saveCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">saveA</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">vertex</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">saveB</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">duplicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                  </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">duplicate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="o">++</span><span class="nx">simplex</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2_gjkMaxIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">b2_gjkMaxIters</span><span class="p">,</span><span class="w"> </span><span class="nx">iter</span><span class="p">);</span>
<span class="w">         </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">GetWitnessPoints</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">);</span>
<span class="w">         </span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">).</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">         </span><span class="nx">output</span><span class="p">.</span><span class="nx">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">iter</span><span class="p">;</span>
<span class="w">         </span><span class="nx">simplex</span><span class="p">.</span><span class="nx">WriteCache</span><span class="p">(</span><span class="nx">cache</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">useRadii</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">rA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">rB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rB</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">rA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rB</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">normal</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">rA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">rA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">rB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">rB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">               </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">               </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Simplex</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_saveA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">s_saveB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2DistanceInput</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DistanceOutput</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">pointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">pointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">GetType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygon</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">bestValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">bestIndex</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">bestValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">bestIndex</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceProxy</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_insertionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">userData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">AllocateNode</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">extendX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbExtension</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">extendY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbExtension</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">extendX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">extendY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">extendX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">extendY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userData</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">InsertLeaf</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">node</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">RemoveLeaf</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">FreeNode</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MoveProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">displacement</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">());</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">aabb</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">RemoveLeaf</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">extendX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbExtension</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbMultiplier</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">displacement</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">displacement</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">displacement</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">extendY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbExtension</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbMultiplier</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">displacement</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">displacement</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">displacement</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">extendX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">extendY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">extendX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">extendY</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">InsertLeaf</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Rebalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">iterations</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_path</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">bit</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child1</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">bit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mf">31</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_path</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">RemoveLeaf</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">InsertLeaf</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">aabb</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">userData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stack</span><span class="p">[</span><span class="o">--</span><span class="nx">count</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">aabb</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">proceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">proceed</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child1</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child2</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossFV</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">abs_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AbsV</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">segmentAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">tX</span><span class="p">);</span>
<span class="w">            </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">            </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">tX</span><span class="p">);</span>
<span class="w">            </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stack</span><span class="p">[</span><span class="o">--</span><span class="nx">count</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">segmentAABB</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">GetCenter</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">GetExtents</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">abs_v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">abs_v</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">subInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2RayCastInput</span><span class="p">();</span>
<span class="w">               </span><span class="nx">subInput</span><span class="p">.</span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">;</span>
<span class="w">               </span><span class="nx">subInput</span><span class="p">.</span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">;</span>
<span class="w">               </span><span class="nx">subInput</span><span class="p">.</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="p">;</span>
<span class="w">               </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">subInput</span><span class="p">,</span><span class="w"> </span><span class="nx">node</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">tX</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">tX</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">segmentAABB</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child1</span><span class="p">;</span>
<span class="w">               </span><span class="nx">stack</span><span class="p">[</span><span class="nx">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">child2</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AllocateNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">node</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DynamicTreeNode</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">FreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_freeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InsertLeaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">leaf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_insertionCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaf</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaf</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">GetCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sibling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sibling</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">child1</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">child2</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">norm1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">norm2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">norm1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">norm2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">sibling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">child1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">sibling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">child2</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">sibling</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">AllocateNode</span><span class="p">();</span>
<span class="w">         </span><span class="nx">node2</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node2</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">node2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">Combine</span><span class="p">(</span><span class="nx">leaf</span><span class="p">.</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">sibling</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaf</span><span class="p">;</span>
<span class="w">            </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">leaf</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">node2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">Combine</span><span class="p">(</span><span class="nx">node1</span><span class="p">.</span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">               </span><span class="nx">node2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">;</span>
<span class="w">               </span><span class="nx">node1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">)</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaf</span><span class="p">;</span>
<span class="w">            </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">leaf</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTree</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RemoveLeaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">leaf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaf</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node2</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">leaf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sibling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sibling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node2</span><span class="p">.</span><span class="nx">child1</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">node2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">FreeNode</span><span class="p">(</span><span class="nx">node2</span><span class="p">);</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">node1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">;</span>
<span class="w">               </span><span class="nx">node1</span><span class="p">.</span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">.</span><span class="nx">Combine</span><span class="p">(</span><span class="nx">node1</span><span class="p">.</span><span class="nx">child1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">node1</span><span class="p">.</span><span class="nx">child2</span><span class="p">.</span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">oldAABB</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">node1</span><span class="p">.</span><span class="nx">aabb</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="nx">node1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node1</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sibling</span><span class="p">;</span>
<span class="w">            </span><span class="nx">sibling</span><span class="p">.</span><span class="nx">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">FreeNode</span><span class="p">(</span><span class="nx">node2</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DynamicTree</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">userData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">userData</span><span class="p">);</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">BufferMove</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">proxy</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">UnBufferMove</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MoveProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">displacement</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">MoveProxy</span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">displacement</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">BufferMove</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabbA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">proxyA</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabbB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">proxyB</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">aabbA</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">aabbB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetProxyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">UpdatePairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">            </span><span class="nx">queryProxy</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">queryProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

<span class="w">            </span><span class="kd">function</span><span class="w"> </span><span class="nx">QueryCallback</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// JDM: ESLint warning = Move function declaration to function body root.</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">queryProxy</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="p">[</span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DynamicTreePair</span><span class="p">();</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="p">[</span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="p">];</span>
<span class="w">               </span><span class="nx">pair</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">queryProxy</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">queryProxy</span><span class="p">;</span>
<span class="w">               </span><span class="nx">pair</span><span class="p">.</span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">queryProxy</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">proxy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">queryProxy</span><span class="p">;</span><span class="o">++</span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="p">;</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fatAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">queryProxy</span><span class="p">);</span>
<span class="w">            </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">QueryCallback</span><span class="p">,</span><span class="w"> </span><span class="nx">fatAABB</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="p">;)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// JDM: ESLint warning = i is already defined</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">primaryPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">userDataA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">primaryPair</span><span class="p">.</span><span class="nx">proxyA</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">userDataB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">primaryPair</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">);</span>
<span class="w">            </span><span class="nx">callback</span><span class="p">(</span><span class="nx">userDataA</span><span class="p">,</span><span class="w"> </span><span class="nx">userDataB</span><span class="p">);</span>
<span class="w">            </span><span class="o">++</span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_pairBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">primaryPair</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">proxyB</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">primaryPair</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span><span class="o">++</span><span class="nx">i</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Rebalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tree</span><span class="p">.</span><span class="nx">Rebalance</span><span class="p">(</span><span class="nx">iterations</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">BufferMove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxy</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">UnBufferMove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">proxy</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_moveBuffer</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComparePairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">pair1</span><span class="p">,</span><span class="w"> </span><span class="nx">pair2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">__implements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">.</span><span class="nx">__implements</span><span class="p">[</span><span class="nx">IBroadPhase</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2DynamicTreeNode</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DynamicTreeNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLeaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">child1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DynamicTreePair</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">)).</span><span class="nx">Reset</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">)).</span><span class="nb">Set</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">m_type</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">();</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">copy</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_circles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0002</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0004</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Reset</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ManifoldPoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_id</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">m_id</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Point</span><span class="p">.</span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Point</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Support</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">vX</span><span class="p">,</span><span class="w"> </span><span class="nx">vY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vX</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vY</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Point</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFirstVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RayCastInput</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2RayCastInput</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">maxFraction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">p1</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">p2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxFraction</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RayCastOutput</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestSegment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lambda</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">segment</span><span class="p">,</span><span class="w"> </span><span class="nx">maxLambda</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxLambda</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">maxLambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">segment</span><span class="p">.</span><span class="nx">p1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">segment</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">segment</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">nY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">dX</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_slop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">));</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denom</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">k_slop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">maxLambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">k_slop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denom</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">denom</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">k_slop</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">a</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">denom</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">nLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">nX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">nY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">nX</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">nLen</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">nY</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">nLen</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">lambda</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">normal</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">nX</span><span class="p">,</span><span class="w"> </span><span class="nx">nY</span><span class="p">);</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Extend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ExtendForward</span><span class="p">(</span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ExtendBackward</span><span class="p">(</span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ExtendForward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">POSITIVE_INFINITY</span><span class="p">,</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">POSITIVE_INFINITY</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">lambda</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">lambda</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Segment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ExtendBackward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">POSITIVE_INFINITY</span><span class="p">,</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">POSITIVE_INFINITY</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">lambda</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">lambda</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">,</span><span class="w"> </span><span class="nx">transformB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointA2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointB2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sgn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_points</span><span class="p">;</span>
<span class="w">            </span><span class="nx">localPointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAX</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAY</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">localPointA1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointA2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">localPointA2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">localPointA2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointA2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">localPointB1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointB2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">localPointB2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">localPointB2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointB2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointBX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointBY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">localPointA1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointA2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointB1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">localPointB2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">pA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointA2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">pB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointB2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">dB</span><span class="p">,</span><span class="w"> </span><span class="nx">dA</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denom</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">((</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">denom</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">f</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">e</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">((</span><span class="nx">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">localPointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">            </span><span class="nx">localPointA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointA2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">localPointA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointA2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">localPointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">            </span><span class="nx">localPointB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointB2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">localPointB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">localPointB2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceB</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointB2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB1</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">sgn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointBX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointBY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="p">();</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceA</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">localPointA2</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA1</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transformB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">sgn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="p">();</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">transformB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axisA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axisB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">seperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal</span><span class="p">;</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_points</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">axisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">);</span>
<span class="w">               </span><span class="nx">axisB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">());</span>
<span class="w">               </span><span class="nx">localPointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="p">(</span><span class="nx">axisA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">localPointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="p">(</span><span class="nx">axisB</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">);</span>
<span class="w">               </span><span class="nx">seperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">seperation</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceA</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">);</span>
<span class="w">               </span><span class="nx">axisB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">());</span>
<span class="w">               </span><span class="nx">localPointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyB</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="p">(</span><span class="nx">axisB</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointB</span><span class="p">);</span>
<span class="w">               </span><span class="nx">seperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">seperation</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceB</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">transformB</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">);</span>
<span class="w">               </span><span class="nx">axisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">transformA</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">());</span>
<span class="w">               </span><span class="nx">localPointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxyA</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="p">(</span><span class="nx">axisA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">pointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">localPointA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">seperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointB</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pointA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointB</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">seperation</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x01</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x02</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">.</span><span class="nx">e_faceB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x04</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SimplexVertex</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SimplexVertex</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SimplexVertex</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ReadCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">,</span><span class="w"> </span><span class="nx">transformB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wALocal</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wBLocal</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">wALocal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">indexA</span><span class="p">);</span>
<span class="w">            </span><span class="nx">wBLocal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">indexB</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">wALocal</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">wBLocal</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">wB</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">wA</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">metric1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">metric</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">metric2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetMetric</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">metric2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">metric1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">metric1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">metric2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">metric2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">wALocal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">wBLocal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">GetVertex</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformA</span><span class="p">,</span><span class="w"> </span><span class="nx">wALocal</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">transformB</span><span class="p">,</span><span class="w"> </span><span class="nx">wBLocal</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">wB</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">wA</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">WriteCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">cache</span><span class="p">.</span><span class="nx">metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetMetric</span><span class="p">();</span>
<span class="w">         </span><span class="nx">cache</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexA</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexA</span><span class="p">);</span>
<span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">indexB</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexB</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSearchDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">();</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">sgn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">e12</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">());</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sgn</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossFV</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nx">e12</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">e12</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetClosestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWitnessPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">pA</span><span class="p">,</span><span class="w"> </span><span class="nx">pB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="nx">pA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wA</span><span class="p">);</span>
<span class="w">            </span><span class="nx">pB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wB</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">            </span><span class="nx">pA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">3</span><span class="o">:</span>
<span class="w">            </span><span class="nx">pB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">pB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMetric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">).</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">3</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">));</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">w2</span><span class="p">,</span><span class="w"> </span><span class="nx">w1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d12_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">w1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">w1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e12</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d12_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">w2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e12</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">w2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e12</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d12_2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d12_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d12</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d12_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d12</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Simplex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">w2</span><span class="p">,</span><span class="w"> </span><span class="nx">w1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w1</span><span class="p">,</span><span class="w"> </span><span class="nx">e12</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w2</span><span class="p">,</span><span class="w"> </span><span class="nx">e12</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d12_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2e12</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d12_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">w1e12</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">e13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">w3</span><span class="p">,</span><span class="w"> </span><span class="nx">w1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1e13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w1</span><span class="p">,</span><span class="w"> </span><span class="nx">e13</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w3e13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w3</span><span class="p">,</span><span class="w"> </span><span class="nx">e13</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d13_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w3e13</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d13_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">w1e13</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">e23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">w3</span><span class="p">,</span><span class="w"> </span><span class="nx">w2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2e23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w2</span><span class="p">,</span><span class="w"> </span><span class="nx">e23</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w3e23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">w3</span><span class="p">,</span><span class="w"> </span><span class="nx">e23</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d23_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w3e23</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d23_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">w2e23</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">n123</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">e12</span><span class="p">,</span><span class="w"> </span><span class="nx">e13</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d123_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">n123</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">w2</span><span class="p">,</span><span class="w"> </span><span class="nx">w3</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d123_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">n123</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">w3</span><span class="p">,</span><span class="w"> </span><span class="nx">w1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d123_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">n123</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="p">(</span><span class="nx">w1</span><span class="p">,</span><span class="w"> </span><span class="nx">w2</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d13_2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d12_2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d123_3</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d12_2</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d12_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d12</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d12_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d12</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d13_1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d13_2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d123_2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d13_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d13_2</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d13_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d13</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d13_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d13</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d12_1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d23_2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d13_1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d23_1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d23_1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d23_2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">d123_1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d23_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d23_2</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d23_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d23</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d23_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d23</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv_d123</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d123_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d123_2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d123_3</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d123_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d123</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d123_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d123</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v3</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d123_3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv_d123</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2SimplexCache</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2SimplexVertex</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2SimplexVertex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">wA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">wA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">wB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">wB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">w</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">indexA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">indexA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">indexB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">indexB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="o">++</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiCalls</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sweepA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">sweepA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sweepB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">sweepB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">sweepA</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">sweepB</span><span class="p">.</span><span class="nx">t0</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sweepA</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tolerance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">tolerance</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_maxIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_cache</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">.</span><span class="nx">useRadii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sweepA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">alpha</span><span class="p">);</span>
<span class="w">            </span><span class="nx">sweepB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">,</span><span class="w"> </span><span class="nx">alpha</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">.</span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">.</span><span class="nx">transformA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">.</span><span class="nx">transformB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">Distance</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceOutput</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_cache</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceOutput</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_fcn</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_cache</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_fcn</span><span class="p">.</span><span class="nx">Evaluate</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tolerance</span><span class="p">,</span><span class="w"> </span><span class="mf">0.75</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tolerance</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tolerance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">newAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alpha</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alpha</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">separation</span><span class="p">;</span>
<span class="w">               </span><span class="nx">sweepA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">x2</span><span class="p">);</span>
<span class="w">               </span><span class="nx">sweepB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">,</span><span class="w"> </span><span class="nx">x2</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_fcn</span><span class="p">.</span><span class="nx">Evaluate</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">f2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rootIterCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rootIterCount</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">x1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">f2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">x1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x2</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">sweepA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">sweepB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">);</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_fcn</span><span class="p">.</span><span class="nx">Evaluate</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="p">);</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.025</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tolerance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">newAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span><span class="o">++</span><span class="nx">rootIterCount</span><span class="p">;</span>
<span class="w">                  </span><span class="o">++</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiRootIters</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rootIterCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">50</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxRootIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxRootIters</span><span class="p">,</span><span class="w"> </span><span class="nx">rootIterCount</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">newAlpha</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newAlpha</span><span class="p">;</span>
<span class="w">            </span><span class="nx">iter</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="o">++</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiIters</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">k_maxIterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxIters</span><span class="p">,</span><span class="w"> </span><span class="nx">iter</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">alpha</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiCalls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiRootIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">b2_toiMaxRootIters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SimplexCache</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceInput</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_xfB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_fcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SeparationFunction</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">s_distanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceOutput</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2TOIInput</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">sweepA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">sweepB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WorldManifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">radiusA</span><span class="p">,</span><span class="w"> </span><span class="nx">xfB</span><span class="p">,</span><span class="w"> </span><span class="nx">radiusB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusA</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radiusA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusB</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radiusB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_circles</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">d2</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">radiusA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">radiusA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cBX</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cAY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cBY</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusB</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusB</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceB</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfB</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">normalX</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">normalY</span><span class="p">);</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">m_localPoint</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xfA</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusA</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">radiusB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">radiusA</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">ClipVertex</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">ClipVertex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">v</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Features</span><span class="p">.</span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;referenceEdge&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_referenceEdge</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;referenceEdge&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_referenceEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xffffff00</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_referenceEdge</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000ff</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;incidentEdge&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentEdge</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;incidentEdge&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xffff00ff</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentEdge</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000ff00</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;incidentVertex&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentVertex</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;incidentVertex&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff00ffff</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_incidentVertex</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00ff0000</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;flip&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_flip</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Features</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;flip&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_m_id</span><span class="p">.</span><span class="nx">_key</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00ffffff</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_flip</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">24</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff000000</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Bound</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Point</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Segment</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Features</span><span class="p">,</span>
<span class="w">         </span><span class="nx">IBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">IBroadPhase</span><span class="p">;</span>

<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2CircleShape</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nb">Set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">other</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">other</span><span class="p">,</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">other2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other2</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">transform</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">dX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">positionX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">positionY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">sX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sY</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">sX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sigma</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">sigma</span><span class="p">)));</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">a</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">rr</span><span class="p">;</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">pX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">,</span><span class="w"> </span><span class="nx">pY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">);</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">pX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">,</span><span class="w"> </span><span class="nx">pY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">,</span><span class="w"> </span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeSubmergedArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span><span class="p">));</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">l2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">l</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">l2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">com</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">l2</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">);</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">com</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">com</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLocalPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLocalPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_p</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeChainDef</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2EdgeChainDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">isALoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2EdgeShape</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">transform</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">nY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1X</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_slop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">));</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denom</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">k_slop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">k_slop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denom</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">mu2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">denom</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">k_slop</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">a</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">denom</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">output</span><span class="p">.</span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">nLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">nX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">nY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">nY</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">nLen</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nY</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">nLen</span><span class="p">;</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">v1X</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">v2X</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2X</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1X</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">v1Y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">,</span><span class="w"> </span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeSubmergedArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">offset</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">v1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">d2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">d2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">d2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">d2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">d2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// JDM: ESLint warning = empty block</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">v0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">v0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v0</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v0</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v0</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v0</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetCoreVertex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetCoreVertex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNormalVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetCorner1Vector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetCorner2Vector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Corner1IsConvex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerConvex1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Corner2IsConvex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerConvex2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFirstVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNextEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nextEdge</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetPrevEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prevEdge</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Support</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">dX</span><span class="p">,</span><span class="w"> </span><span class="nx">dY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">v1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">v2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1X</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2X</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">s_supportVec</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prevEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nextEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_direction</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir2</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetPrevEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">,</span><span class="w"> </span><span class="nx">convex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prevEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">core</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerConvex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convex</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetNextEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">,</span><span class="w"> </span><span class="nx">convex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nextEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_coreV2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">core</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerDir2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_cornerConvex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convex</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MassData</span><span class="p">.</span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PolygonShape</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nb">Set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">other</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">other</span><span class="p">,</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">other2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other2</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other2</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">Reserve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other2</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other2</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAsArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">v</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tVec</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAsVector</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">AsArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">polygonShape</span><span class="p">.</span><span class="nx">SetAsArray</span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">polygonShape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAsVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Reserve</span><span class="p">(</span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i2</span><span class="p">],</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i1</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">ComputeCentroid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">AsVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">polygonShape</span><span class="p">.</span><span class="nx">SetAsVector</span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">polygonShape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAsBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Reserve</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">hx</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">hy</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">hy</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">3</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">hx</span><span class="p">),</span><span class="w"> </span><span class="nx">hy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">3</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">AsBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">polygonShape</span><span class="p">.</span><span class="nx">SetAsBox</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">polygonShape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAsOrientedBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Reserve</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">hx</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">hy</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">hy</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">3</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">hx</span><span class="p">),</span><span class="w"> </span><span class="nx">hy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">3</span><span class="p">].</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">center</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">center</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">AsOrientedBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">polygonShape</span><span class="p">.</span><span class="nx">SetAsOrientedBox</span><span class="p">(</span><span class="nx">hx</span><span class="p">,</span><span class="w"> </span><span class="nx">hy</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">polygonShape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAsEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Reserve</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">v2</span><span class="p">,</span><span class="w"> </span><span class="nx">v1</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">AsEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">polygonShape</span><span class="p">.</span><span class="nx">SetAsEdge</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">polygonShape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pLocalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">pLocalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pLocalX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pLocalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tY</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">denominator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denominator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">numerator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denominator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denominator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">denominator</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">denominator</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">upper</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">denominator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">denominator</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">upper</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lower</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerY</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vX</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vY</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">upperX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">vX</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">upperY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">vY</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vY</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">,</span><span class="w"> </span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">centerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">centerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_inv3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">e1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e2X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">D</span><span class="p">;</span><span class="nx">area</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="p">;</span>
<span class="w">            </span><span class="nx">centerX</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k_inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">centerY</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k_inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">py</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ey1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e2X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ey2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e2Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">intx2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">k_inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ex1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ex1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ex2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ex1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ex2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ex2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">px</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ex1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">px</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ex2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">px</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">px</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">inty2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">k_inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ey1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ey1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ey2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ey1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ey2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ey2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">py</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ey1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">py</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ey2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">py</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">py</span><span class="p">;</span><span class="nx">I</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">intx2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inty2</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">         </span><span class="nx">centerX</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">         </span><span class="nx">centerY</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">centerX</span><span class="p">,</span><span class="w"> </span><span class="nx">centerY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">I</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeSubmergedArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">offsetL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">depths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">diveCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">intoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">outoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lastSubmerged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">depths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">normalL</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offsetL</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">isSubmerged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">depths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isSubmerged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">lastSubmerged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">intoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">diveCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastSubmerged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">outoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">diveCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">lastSubmerged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isSubmerged</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">diveCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastSubmerged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">md</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2MassData</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="p">(</span><span class="nx">md</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">center</span><span class="p">));</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// JDM: ESLint warning = unreachable code</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">intoIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">intoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">outoIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">intoIndex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="nx">intoIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">outoIndex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="nx">outoIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">intoLamdda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">depths</span><span class="p">[</span><span class="nx">intoIndex</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">depths</span><span class="p">[</span><span class="nx">intoIndex2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">depths</span><span class="p">[</span><span class="nx">intoIndex</span><span class="p">]);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">outoLamdda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">depths</span><span class="p">[</span><span class="nx">outoIndex</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">depths</span><span class="p">[</span><span class="nx">outoIndex2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">depths</span><span class="p">[</span><span class="nx">outoIndex</span><span class="p">]);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">intoVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">intoIndex</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoLamdda</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">intoIndex2</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">intoLamdda</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">intoIndex</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoLamdda</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">intoIndex2</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">intoLamdda</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">outoVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">outoIndex</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">outoLamdda</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">outoIndex2</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">outoLamdda</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">outoIndex</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">outoLamdda</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">outoIndex2</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">outoLamdda</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">intoIndex2</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p3</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intoIndex2</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">outoIndex2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">outoIndex2</span><span class="p">)</span><span class="w"> </span><span class="nx">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">outoVec</span><span class="p">;</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">            </span><span class="nx">area</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">intoVec</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p3</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">center</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">);</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetVertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNormals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">bestValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">bestIndex</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSupportVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">bestValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bestIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bestValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">bestIndex</span><span class="p">];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_centroid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">ComputeCentroid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">inv3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">vs</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vs</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">e2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">e1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">e1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">e2X</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">D</span><span class="p">;</span><span class="nx">area</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="p">;</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">triangleArea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">inv3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">p1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">ComputeOBB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">obb</span><span class="p">,</span><span class="w"> </span><span class="nx">vs</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">p</span><span class="p">[</span><span class="nx">count</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">minArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">uxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">uxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">uxX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">uxX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">uxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">uxY</span><span class="p">);</span>
<span class="w">            </span><span class="nx">uxX</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">            </span><span class="nx">uxY</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">uyX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">uxY</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">uyY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uxX</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">uxX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">uxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">uyX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">uyY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">lowerX</span><span class="p">)</span><span class="w"> </span><span class="nx">lowerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rX</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">lowerY</span><span class="p">)</span><span class="w"> </span><span class="nx">lowerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">upperX</span><span class="p">)</span><span class="w"> </span><span class="nx">upperX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rX</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rY</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">upperY</span><span class="p">)</span><span class="w"> </span><span class="nx">upperY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">upperX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lowerX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">upperY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lowerY</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">area</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.95</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">minArea</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">minArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uxX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uxY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uyX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uyY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">centerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">lowerX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">upperX</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">centerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">lowerY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">upperY</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obb</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">centerX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">centerY</span><span class="p">);</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">root</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">centerX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">centerY</span><span class="p">);</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">upperX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lowerX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">obb</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">upperY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lowerY</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">.</span><span class="nx">s_mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">,</span><span class="w"> </span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeSubmergedArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">shape1</span><span class="p">,</span><span class="w"> </span><span class="nx">transform1</span><span class="p">,</span><span class="w"> </span><span class="nx">shape2</span><span class="p">,</span><span class="w"> </span><span class="nx">transform2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceInput</span><span class="p">();</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">();</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">shape1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceProxy</span><span class="p">();</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">shape2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">transformA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">transformB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">transform2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">input</span><span class="p">.</span><span class="nx">useRadii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">simplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2SimplexCache</span><span class="p">();</span>
<span class="w">         </span><span class="nx">simplexCache</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceOutput</span><span class="p">();</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="p">.</span><span class="nx">Distance</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">simplexCache</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_unknownShape</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_unknownShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_shapeTypeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_hitCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_missCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_startsInsideCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">;</span>

<span class="w">      </span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span><span class="w"> </span><span class="nx">gg</span><span class="p">,</span><span class="w"> </span><span class="nx">bb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gg</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">gg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bb</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">gg</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">bb</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span><span class="w"> </span><span class="nx">gg</span><span class="p">,</span><span class="w"> </span><span class="nx">bb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gg</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">gg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bb</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">gg</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">bb</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rr</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">gg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gg</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">gg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">gg</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">set</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bb</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">parseUInt</span><span class="p">(</span><span class="mf">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">bb</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">b2Color</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">enumerable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">         </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_r</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_g</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_b</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2MixFriction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">friction1</span><span class="p">,</span><span class="w"> </span><span class="nx">friction2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">friction1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">friction1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">friction2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">friction2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">friction1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">friction2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2MixRestitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">restitution1</span><span class="p">,</span><span class="w"> </span><span class="nx">restitution2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="cm">/*</span>
<span class="cm">         if (restitution1 === undefined) restitution1 = 0;</span>
<span class="cm">         if (restitution2 === undefined) restitution2 = 0;</span>
<span class="cm">         return restitution1 &gt; restitution2 ? restitution1 : restitution2;</span>
<span class="cm">         </span>
<span class="cm">         JDM: changed (see above in this comment) from &quot;restitution1 : restitution2&quot; to &quot;restitution2 : restitution1&quot; (see below), to take the lower of the two values.</span>
<span class="cm">         And made a corresponding change: all places where restitution was set to 0.0. Now set to 1.0. Search on JDM to find these changes.</span>
<span class="cm">         Restitution is undefined for walls, so they also yield 1.0 here, now (after these changes).</span>
<span class="cm">         */</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">restitution1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">restitution1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// JDM: changed 0 to 1.0</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">restitution2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">restitution2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// JDM: changed 0 to 1.0</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">restitution1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">restitution2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">restitution2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">restitution1</span><span class="p">;</span><span class="w"> </span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;Assertion Failed&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2.1alpha&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">USHRT_MAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000ffff</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbExtension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_aabbMultiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_polygonRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.005</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTOIContactsPerIsland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">32</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTOIJointsPerIsland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">32</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_velocityThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxAngularCorrection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslationSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotationSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_contactBaumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_timeToSleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSleepTolerance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSleepTolerance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_pi</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">;</span>

<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="nx">mat</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">mat</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="nx">mat</span><span class="p">.</span><span class="nx">SetVV</span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">mat</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">s</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="nx">mat</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">mat</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetZero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetInverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">det</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">det</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">);</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">out</span><span class="p">,</span><span class="w"> </span><span class="nx">bX</span><span class="p">,</span><span class="w"> </span><span class="nx">bY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bY</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a21</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">det</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">det</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">Abs</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">Abs</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">,</span><span class="w"> </span><span class="nx">c3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c3</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">c3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">c1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">c2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">c3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c2</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c3</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetVVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">,</span><span class="w"> </span><span class="nx">c3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">c3</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">col3</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetZero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">out</span><span class="p">,</span><span class="w"> </span><span class="nx">bX</span><span class="p">,</span><span class="w"> </span><span class="nx">bY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bY</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a21</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">det</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">det</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Mat33</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">out</span><span class="p">,</span><span class="w"> </span><span class="nx">bX</span><span class="p">,</span><span class="w"> </span><span class="nx">bY</span><span class="p">,</span><span class="w"> </span><span class="nx">bZ</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bY</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bZ</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a31</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">det</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">det</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bZ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="p">));</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">bY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bZ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">bZ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a33</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a31</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">bX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a13</span><span class="p">));</span>
<span class="w">         </span><span class="nx">out</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">det</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bZ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bZ</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a31</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">a12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">IsValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">isFinite</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossVF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossFV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">u</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">u</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">T</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">);</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulXT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">cX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cY</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">DistanceSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">cX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cY</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulFV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddMM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col1</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col2</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">C</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col1</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col2</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">C</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col1</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col1</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col2</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">.</span><span class="nx">col2</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span><span class="w"> </span><span class="nx">c2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">C</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">a</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AbsV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AbsM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AbsV</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AbsV</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">B</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MinV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MaxV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">low</span><span class="p">,</span><span class="w"> </span><span class="nx">high</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">low</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">high</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">low</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">low</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">high</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">high</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">ClampV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">low</span><span class="p">,</span><span class="w"> </span><span class="nx">high</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MaxV</span><span class="p">(</span><span class="nx">low</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MinV</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">high</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="nx">a</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">         </span><span class="nx">b</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmp</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">RandomRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lo</span><span class="p">,</span><span class="w"> </span><span class="nx">hi</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lo</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hi</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
<span class="w">         </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">hi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lo</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">lo</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">NextPowerOfTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="nx">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x3FFFFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="nx">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0FFFFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="nx">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00FFFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="nx">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000FFFF</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">IsPowerOfTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Vec2_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Mat22_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromVV</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Transform_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Vec2_zero</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2Mat22_identity</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">c0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">a0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">t0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">);</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">);</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">copy</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Sweep</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Advance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">R</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Transform</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="p">,</span><span class="w"> </span><span class="nx">y_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">y_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x_</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y_</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetZero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="p">,</span><span class="w"> </span><span class="nx">y_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">y_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x_</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y_</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNegative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">Make</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="p">,</span><span class="w"> </span><span class="nx">y_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y_</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">y_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">x_</span><span class="p">,</span><span class="w"> </span><span class="nx">y_</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Subtract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Multiply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MulM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MulTM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CrossVF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CrossFV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MinV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">MaxV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Normalize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">invLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">invLength</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">invLength</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">z</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetZero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">z</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNegative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">NegativeSelf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Subtract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Vec3</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Multiply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2ControllerEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ControllerEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Bound</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Point</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Segment</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Features</span><span class="p">,</span>
<span class="w">         </span><span class="nx">IBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">IBroadPhase</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2CircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2CircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactConstraintPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraintPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactRegister</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactResult</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2EdgeAndCircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2NullContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolyAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndCircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolyAndEdgeContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndEdgeContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolygonContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PositionSolverManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FrictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2GearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Jacobian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Jacobian</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2JointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2JointEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2LineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WeldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="p">;</span>

<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">connectEdges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">s1</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">,</span><span class="w"> </span><span class="nx">angle1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angle2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">().</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">().</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coreOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">tan</span><span class="p">((</span><span class="nx">angle2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">angle1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulFV</span><span class="p">(</span><span class="nx">coreOffset</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">());</span>
<span class="w">         </span><span class="nx">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetNormalVector</span><span class="p">());</span>
<span class="w">         </span><span class="nx">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulFV</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_toiSlop</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">);</span>
<span class="w">         </span><span class="nx">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetVertex1</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cornerDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">s1</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">(),</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">());</span>
<span class="w">         </span><span class="nx">cornerDir</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">convex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">s1</span><span class="p">.</span><span class="nx">GetDirectionVector</span><span class="p">(),</span><span class="w"> </span><span class="nx">s2</span><span class="p">.</span><span class="nx">GetNormalVector</span><span class="p">())</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s1</span><span class="p">.</span><span class="nx">SetNextEdge</span><span class="p">(</span><span class="nx">s2</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">,</span><span class="w"> </span><span class="nx">convex</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s2</span><span class="p">.</span><span class="nx">SetPrevEdge</span><span class="p">(</span><span class="nx">s1</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">cornerDir</span><span class="p">,</span><span class="w"> </span><span class="nx">convex</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">angle2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateFixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="p">();</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">            </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">;</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="p">;</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_density</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_newFixture</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">fixture</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateFixture2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">,</span><span class="w"> </span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2FixtureDef</span><span class="p">();</span>
<span class="w">         </span><span class="nx">def</span><span class="p">.</span><span class="nx">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shape</span><span class="p">;</span>
<span class="w">         </span><span class="nx">def</span><span class="p">.</span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">density</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">CreateFixture</span><span class="p">(</span><span class="nx">def</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyFixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">ppF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ppF</span><span class="p">)</span><span class="w"> </span><span class="nx">ppF</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">               </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">ppF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">;</span>
<span class="w">            </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">;</span>
<span class="w">            </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">            </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// JDM: ESLint warning = empty block</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">();</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetPositionAndAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">angle</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">Synchronize</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">FindNewContacts</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetPositionAndAngle</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetPositionAndAngle</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetPositionAndAngle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">(),</span><span class="w"> </span><span class="nx">angle</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLocalCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLinearVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAngularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">omega</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">omega</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">omega</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAngularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2BodyDef</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetType</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">allowSleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularDamping</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">fixedRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">bullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">awake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">linearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearDamping</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">());</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bd</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">bd</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">force</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">force</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">((</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">force</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">force</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ApplyTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">torque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ApplyImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">linearVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetAngularVelocity</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">GetDefinition</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">prev</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="p">;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">next</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">body1</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">next</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">body1</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">               </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">               </span><span class="nx">body2</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">               </span><span class="nx">body2</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">               </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">;</span>
<span class="w">               </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">               </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">         </span><span class="nx">body2</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">velocity1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">linearVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossFV</span><span class="p">(</span><span class="nx">angularVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">center1</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">)));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">velocity2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">linearVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">CrossFV</span><span class="p">(</span><span class="nx">angularVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">center2</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">)));</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">SetLinearVelocity</span><span class="p">(</span><span class="nx">velocity1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">body2</span><span class="p">.</span><span class="nx">SetLinearVelocity</span><span class="p">(</span><span class="nx">velocity2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">SetAngularVelocity</span><span class="p">(</span><span class="nx">angularVelocity</span><span class="p">);</span>
<span class="w">         </span><span class="nx">body2</span><span class="p">.</span><span class="nx">SetAngularVelocity</span><span class="p">(</span><span class="nx">angularVelocity</span><span class="p">);</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="p">();</span>
<span class="w">         </span><span class="nx">body2</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">body2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Merge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">f</span><span class="p">;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">            </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">velocity1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">velocity2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angular1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetAngularVelocity</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetAngularVelocity</span><span class="p">();</span>
<span class="w">         </span><span class="nx">body1</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetInertia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">data</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">;</span>
<span class="w">         </span><span class="nx">data</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="p">;</span>
<span class="w">         </span><span class="nx">data</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_kinematicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">.</span><span class="nx">Make</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">m_density</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">massData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">GetMassData</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">massData</span><span class="p">.</span><span class="nx">I</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_inertiaScale</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">center</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">localPoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">u</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">u</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">localVector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">localVector</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulXT</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="nx">worldPoint</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLocalVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">worldVector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulTMV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">worldVector</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLinearVelocityFromWorldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLinearVelocityFromLocalPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">localPoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">worldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">worldPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLinearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearDamping</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLinearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">linearDamping</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">linearDamping</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">linearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">linearDamping</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAngularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularDamping</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAngularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">angularDamping</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">angularDamping</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">angularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">angularDamping</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">type</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span><span class="w"> </span><span class="nx">ce</span><span class="p">;</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">FlagForFiltering</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetBullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsBullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetSleepingAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAwake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsAwake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFixedRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ResetMassData</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsFixedRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">;</span>
<span class="w">            </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">f</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">;</span>
<span class="w">            </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">f</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">ce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">ce0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">ce0</span><span class="p">.</span><span class="nx">contact</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsSleepingAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetControllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetContactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">,</span><span class="w"> </span><span class="nx">world</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">bullet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">fixedRotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">allowSleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">awake</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">world</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angle</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bd</span><span class="p">.</span><span class="nx">linearVelocity</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">linearDamping</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">angularDamping</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_inertiaScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">inertiaScale</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bd</span><span class="p">.</span><span class="nx">userData</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">s_xf1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">;</span>
<span class="w">         </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">Synchronize</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span><span class="w"> </span><span class="nx">jn</span><span class="p">;</span><span class="w"> </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jn</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jn</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jn</span><span class="p">.</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_collideConnected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Advance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">s_xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_awakeFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0002</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0004</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_bulletFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0008</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_fixedRotationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0010</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_activeFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0020</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_kinematicBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2BodyDef</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2BodyDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearVelocity</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">allowSleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">awake</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">fixedRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">inertiaScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">filter1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetFilterData</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">filter2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetFilterData</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filter1</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">filter2</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filter1</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">filter1</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">collide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">filter1</span><span class="p">.</span><span class="nx">maskBits</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">filter2</span><span class="p">.</span><span class="nx">categoryBits</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">filter1</span><span class="p">.</span><span class="nx">categoryBits</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">filter2</span><span class="p">.</span><span class="nx">maskBits</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">collide</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">userData</span><span class="p">,</span><span class="w"> </span><span class="nx">fixture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userData</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="p">((</span><span class="nx">userData</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">userData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">fixture</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">b2_defaultFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactFilter</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ContactImpulse</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normalImpulses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">tangentImpulses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">BeginContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EndContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">PreSolve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">oldManifold</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">PostSolve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">impulse</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">b2_defaultListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactListener</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactFilter</span><span class="p">.</span><span class="nx">b2_defaultFilter</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactListener</span><span class="p">.</span><span class="nx">b2_defaultListener</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactFactory</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">proxyUserDataA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyUserDataB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">proxyUserDataA</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">proxyUserDataA</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">proxyUserDataB</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">proxyUserDataB</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetContactList</span><span class="p">();</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">fA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">fB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="p">(</span><span class="nx">bodyA</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFilter</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFactory</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">         </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">         </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">;</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">FindNewContacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">.</span><span class="nx">UpdatePairs</span><span class="p">(</span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">generateCallback</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">AddPair</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">IsTouching</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="p">.</span><span class="nx">EndContact</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFactory</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
<span class="w">         </span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Collide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">();</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_filterFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="p">(</span><span class="nx">bodyA</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">cNuke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cNuke</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">();</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">cNuke</span><span class="p">);</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactFilter</span><span class="p">.</span><span class="nx">ShouldCollide</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">cNuke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cNuke</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">();</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">cNuke</span><span class="p">);</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_filterFlag</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">proxyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">overlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">proxyA</span><span class="p">,</span><span class="w"> </span><span class="nx">proxyB</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">overlap</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">cNuke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">               </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cNuke</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">cNuke</span><span class="p">);</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="p">);</span>
<span class="w">            </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">.</span><span class="nx">s_evalCP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactPoint</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AppendFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClearFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetSprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDrawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">drawScale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">drawScale</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDrawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lineThickness</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lineThickness</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetXFormScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xformScale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xformScale</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">xformScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetXFormScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawPolygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSolidPolygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSolidCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">,</span><span class="w"> </span><span class="nx">axis</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_shapeBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_jointBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0002</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_aabbBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0004</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_pairBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0008</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_centerOfMassBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0010</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_controllerBit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0020</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2DestructionListener</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2DestructionListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SayGoodbyeJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">joint</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2DestructionListener</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SayGoodbyeFixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixture</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2FilterData</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">categoryBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maskBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2FilterData</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2FilterData</span><span class="p">();</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">categoryBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">categoryBits</span><span class="p">;</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">maskBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maskBits</span><span class="p">;</span>
<span class="w">         </span><span class="nx">copy</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">groupIndex</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">copy</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2FilterData</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">GetType</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_isSensor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">sensor</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_isSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sensor</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">GetContactList</span><span class="p">();</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">SetSensor</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">());</span>
<span class="w">            </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_isSensor</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">GetContactList</span><span class="p">();</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">FlagForFiltering</span><span class="p">();</span>
<span class="w">            </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_filter</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">TestPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">TestPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(),</span><span class="w"> </span><span class="nx">p</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">massData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">massData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">massData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2MassData</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">ComputeMass</span><span class="p">(</span><span class="nx">massData</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_density</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">massData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">density</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">density</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_density</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFriction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_friction</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFriction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">friction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">friction</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">friction</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetRestitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_restitution</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetRestitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">restitution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">restitution</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// JDM: changed 0 to 1.0</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">restitution</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// JDM: changed 0 to 1.0</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">userData</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">friction</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">restitution</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_isSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">isSensor</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">density</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Fixture</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Synchronize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">,</span><span class="w"> </span><span class="nx">transform1</span><span class="p">,</span><span class="w"> </span><span class="nx">transform2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">,</span><span class="w"> </span><span class="nx">transform1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="p">(</span><span class="nx">aabb2</span><span class="p">,</span><span class="w"> </span><span class="nx">transform2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">.</span><span class="nx">Combine</span><span class="p">(</span><span class="nx">aabb1</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">displacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="nx">transform2</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">transform1</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">MoveProxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">displacement</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FixtureDef</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2FilterData</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2FixtureDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// JDM: changed 0 to 1.0</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">categoryBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">maskBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFF</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">groupIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">isSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyCapacity</span><span class="p">,</span><span class="w"> </span><span class="nx">contactCapacity</span><span class="p">,</span><span class="w"> </span><span class="nx">jointCapacity</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">,</span><span class="w"> </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">contactSolver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyCapacity</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">bodyCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contactCapacity</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">contactCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointCapacity</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">jointCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyCapacity</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contactCapacity</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jointCapacity</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allocator</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">listener</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contactSolver</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">bodyCapacity</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">contactCapacity</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">jointCapacity</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Clear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">,</span><span class="w"> </span><span class="nx">gravity</span><span class="p">,</span><span class="w"> </span><span class="nx">allowSleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">joint</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_torque</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearDamping</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularDamping</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">contactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">;</span>
<span class="w">         </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">joint</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="nx">joint</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">joint</span><span class="p">.</span><span class="nx">FinalizeVelocityConstraints</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">FinalizeVelocityConstraints</span><span class="p">();</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translationX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translationY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">translationX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">translationX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">translationY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">translationY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslationSquared</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotationSquared</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">positionIterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">contactsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_contactBaumgarte</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_contactBaumgarte</span><span class="p">);</span>
<span class="w">               </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">jointOkay</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contactsOkay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Report</span><span class="p">(</span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allowSleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">minSleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">linTolSqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSleepTolerance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSleepTolerance</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">angTolSqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSleepTolerance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSleepTolerance</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">minSleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_allowSleepFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">angTolSqr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">linTolSqr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">minSleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">minSleepTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">minSleepTime</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sleepTime</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">minSleepTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_timeToSleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveTOI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">subStep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">subStep</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">contactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">InitVelocityConstraints</span><span class="p">(</span><span class="nx">subStep</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="p">();</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">SolveVelocityConstraints</span><span class="p">(</span><span class="nx">subStep</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translationX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translationY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">translationX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">translationX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">translationY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">translationY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslationSquared</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTranslation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotationSquared</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxRotation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c0</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_toiBaumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.75</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">positionIterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">contactsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="p">(</span><span class="nx">k_toiBaumgarte</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">SolvePositionConstraints</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_contactBaumgarte</span><span class="p">);</span>
<span class="w">               </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">jointOkay</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contactsOkay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">jointsOkay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">Report</span><span class="p">(</span><span class="nx">contactSolver</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">constraints</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_listener</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">s_impulse</span><span class="p">.</span><span class="nx">normalImpulses</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">s_impulse</span><span class="p">.</span><span class="nx">tangentImpulses</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">tangentImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_listener</span><span class="p">.</span><span class="nx">PostSolve</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">s_impulse</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_islandIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">joint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">.</span><span class="nx">s_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactImpulse</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2TimeStep</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2TimeStep</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">positionIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">positionIterations</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">warmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">s_stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactManager</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Island</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">gravity</span><span class="p">,</span><span class="w"> </span><span class="nx">doSleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_warmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_continuousPhysics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allowSleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">doSleep</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gravity</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_inv_dt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2BodyDef</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">bd</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">listener</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filter</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">listener</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">debugDraw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">debugDraw</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">CreateProxy</span><span class="p">(</span><span class="nx">oldBroadPhase</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">),</span><span class="w"> </span><span class="nx">f</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">.</span><span class="nx">Validate</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetProxyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">.</span><span class="nx">GetProxyCount</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">IsLocked</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">jn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jn0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jn</span><span class="p">;</span>
<span class="w">            </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jn</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="p">.</span><span class="nx">SayGoodbyeJoint</span><span class="p">(</span><span class="nx">jn0</span><span class="p">.</span><span class="nx">joint</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">DestroyJoint</span><span class="p">(</span><span class="nx">jn0</span><span class="p">.</span><span class="nx">joint</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">coe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">coe0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coe</span><span class="p">;</span>
<span class="w">            </span><span class="nx">coe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coe</span><span class="p">.</span><span class="nx">nextController</span><span class="p">;</span>
<span class="w">            </span><span class="nx">coe0</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">RemoveBody</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">ce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">ce0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">;</span>
<span class="w">            </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">ce0</span><span class="p">.</span><span class="nx">contact</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_contactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_destructionListener</span><span class="p">.</span><span class="nx">SayGoodbyeFixture</span><span class="p">(</span><span class="nx">f0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">f0</span><span class="p">.</span><span class="nx">DestroyProxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">);</span>
<span class="w">            </span><span class="nx">f0</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_fixtureCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">collideConnected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetContactList</span><span class="p">();</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">FlagForFiltering</span><span class="p">();</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">collideConnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_collideConnected</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_jointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">         </span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">collideConnected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetContactList</span><span class="p">();</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">edge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">FlagForFiltering</span><span class="p">();</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RemoveController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">)</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CreateController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Controller can only be a member of one world&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">;</span>
<span class="w">         </span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="p">;</span>
<span class="w">         </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">controller</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DestroyController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">controller</span><span class="p">.</span><span class="nx">Clear</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">)</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_prev</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">         </span><span class="o">--</span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetWarmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_warmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetContinuousPhysics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_continuousPhysics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBodyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetContactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetGravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">gravity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gravity</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetGravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gravity</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetGroundBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">dt</span><span class="p">,</span><span class="w"> </span><span class="nx">velocityIterations</span><span class="p">,</span><span class="w"> </span><span class="nx">positionIterations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">velocityIterations</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">velocityIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">positionIterations</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">positionIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_newFixture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">FindNewContacts</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_newFixture</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_locked</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_timestep2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dt</span><span class="p">;</span>
<span class="w">         </span><span class="nx">step</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">velocityIterations</span><span class="p">;</span>
<span class="w">         </span><span class="nx">step</span><span class="p">.</span><span class="nx">positionIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">positionIterations</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">dt</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_inv_dt0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dt</span><span class="p">;</span>
<span class="w">         </span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_warmStarting</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">Collide</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">Solve</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">m_continuousPhysics</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">SolveTOI</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_inv_dt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">inv_dt</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_locked</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClearForces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">body</span><span class="p">;</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_force</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawDebugData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">m_sprite</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">GetFlags</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bp</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">invQ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">()];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_shapeBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">GetFixtureList</span><span class="p">();</span>
<span class="w">               </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">();</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">                     </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">                     </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_kinematicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">);</span>
<span class="w">                     </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">);</span>
<span class="w">                     </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="p">);</span>
<span class="w">                     </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_jointBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">DrawJoint</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_controllerBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">Draw</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_pairBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">color</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span><span class="w"> </span><span class="nx">contact</span><span class="p">;</span><span class="w"> </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetAABB</span><span class="p">().</span><span class="nx">GetCenter</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetAABB</span><span class="p">().</span><span class="nx">GetCenter</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">cA</span><span class="p">,</span><span class="w"> </span><span class="nx">cB</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_aabbBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">            </span><span class="nx">vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">()];</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">GetFixtureList</span><span class="p">();</span>
<span class="w">               </span><span class="nx">f</span><span class="p">;</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bp</span><span class="p">.</span><span class="nx">GetFatAABB</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">m_proxy</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">vs</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">vs</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">vs</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">vs</span><span class="p">[</span><span class="mf">3</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawPolygon</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">e_centerOfMassBit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_xf</span><span class="p">;</span>
<span class="w">               </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawTransform</span><span class="p">(</span><span class="nx">xf</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">QueryAABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">WorldQueryWrapper</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">));</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">WorldQueryWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">QueryShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">shape</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">transform</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">transform</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">            </span><span class="nx">transform</span><span class="p">.</span><span class="nx">SetIdentity</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">WorldQueryWrapper</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">shape</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">,</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">(),</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">().</span><span class="nx">GetTransform</span><span class="p">()))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">fixture</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="nx">shape</span><span class="p">.</span><span class="nx">ComputeAABB</span><span class="p">(</span><span class="nx">aabb</span><span class="p">,</span><span class="w"> </span><span class="nx">transform</span><span class="p">);</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">WorldQueryWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">QueryPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">WorldQueryWrapper</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixture</span><span class="p">.</span><span class="nx">TestPoint</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">fixture</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2AABB</span><span class="p">();</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">);</span>
<span class="w">         </span><span class="nx">aabb</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">);</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">WorldQueryWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">aabb</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">broadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_broadPhase</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2RayCastOutput</span><span class="p">;</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">RayCastWrapper</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">proxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">GetUserData</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">userData</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">userData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">hit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">fraction</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">fraction</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">point1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">point2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">fraction</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">point1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fraction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">point2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">fixture</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">fraction</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">maxFraction</span><span class="p">;</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2RayCastInput</span><span class="p">(</span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">broadPhase</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">RayCastWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCastOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">RayCastOneWrapper</span><span class="p">(</span><span class="nx">fixture</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">fraction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fraction</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">fraction</span><span class="p">;</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="nx">__this</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">RayCastOneWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RayCastAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>

<span class="w">         </span><span class="kd">function</span><span class="w"> </span><span class="nx">RayCastAllWrapper</span><span class="p">(</span><span class="nx">fixture</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="nx">fraction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fraction</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">result</span><span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">         </span><span class="nx">__this</span><span class="p">.</span><span class="nx">RayCast</span><span class="p">(</span><span class="nx">RayCastAllWrapper</span><span class="p">,</span><span class="w"> </span><span class="nx">point1</span><span class="p">,</span><span class="w"> </span><span class="nx">point2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetContactList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_locked</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Solve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span><span class="w"> </span><span class="nx">controller</span><span class="p">;</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">controller</span><span class="p">.</span><span class="nx">Step</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_island</span><span class="p">;</span>
<span class="w">         </span><span class="nx">island</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">stackSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">s_stack</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">seed</span><span class="p">;</span><span class="w"> </span><span class="nx">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">seed</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seed</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seed</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">seed</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seed</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">island</span><span class="p">.</span><span class="nx">Clear</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">stackCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">stack</span><span class="p">[</span><span class="nx">stackCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">seed</span><span class="p">;</span>
<span class="w">            </span><span class="nx">seed</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">stackCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stack</span><span class="p">[</span><span class="o">--</span><span class="nx">stackCount</span><span class="p">];</span>
<span class="w">               </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddBody</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span><span class="w"> </span><span class="nx">ce</span><span class="p">;</span><span class="w"> </span><span class="nx">ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsTouching</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddContact</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">ce</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ce</span><span class="p">.</span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">stack</span><span class="p">[</span><span class="nx">stackCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span><span class="w"> </span><span class="nx">jn</span><span class="p">;</span><span class="w"> </span><span class="nx">jn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jn</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jn</span><span class="p">.</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jn</span><span class="p">.</span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddJoint</span><span class="p">(</span><span class="nx">jn</span><span class="p">.</span><span class="nx">joint</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">jn</span><span class="p">.</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">stack</span><span class="p">[</span><span class="nx">stackCount</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">island</span><span class="p">.</span><span class="nx">Solve</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gravity</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allowSleep</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="nx">stack</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">FindNewContacts</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveTOI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">fB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_island</span><span class="p">;</span>
<span class="w">         </span><span class="nx">island</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTOIContactsPerIsland</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxTOIJointsPerIsland</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactSolver</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_queue</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">j</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">minContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">minTOI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">c</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">IsContinuous</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_toi</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">fA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">fB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">t0</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">t0</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">t0</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">ComputeTOI</span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="mf">0.0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">toi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">toi</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">t0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">toi</span><span class="p">;</span>
<span class="w">                     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">toi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_toi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">toi</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">toi</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">minTOI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">minContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">minTOI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">toi</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">minContact</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">minTOI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">fA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minContact</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">fB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minContact</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">minTOI</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">minTOI</span><span class="p">);</span>
<span class="w">            </span><span class="nx">minContact</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">m_contactListener</span><span class="p">);</span>
<span class="w">            </span><span class="nx">minContact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">minContact</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">minContact</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupA</span><span class="p">);</span>
<span class="w">               </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupB</span><span class="p">);</span>
<span class="w">               </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">               </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">minContact</span><span class="p">.</span><span class="nx">IsTouching</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seed</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">island</span><span class="p">.</span><span class="nx">Clear</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">queueStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">queue</span><span class="p">[</span><span class="nx">queueStart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">queueSize</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">seed</span><span class="p">;</span>
<span class="w">            </span><span class="nx">seed</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">queueSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">queue</span><span class="p">[</span><span class="nx">queueStart</span><span class="o">++</span><span class="p">];</span>
<span class="w">               </span><span class="o">--</span><span class="nx">queueSize</span><span class="p">;</span>
<span class="w">               </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddBody</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">b</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">cEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">               </span><span class="nx">cEdge</span><span class="p">;</span><span class="w"> </span><span class="nx">cEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">island</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_contactCapacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">IsTouching</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddContact</span><span class="p">(</span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">other</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">minTOI</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">other</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">queue</span><span class="p">[</span><span class="nx">queueStart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">queueSize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="o">++</span><span class="nx">queueSize</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">jEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span><span class="w"> </span><span class="nx">jEdge</span><span class="p">;</span><span class="w"> </span><span class="nx">jEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">island</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_jointCapacity</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jEdge</span><span class="p">.</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jEdge</span><span class="p">.</span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">island</span><span class="p">.</span><span class="nx">AddJoint</span><span class="p">(</span><span class="nx">jEdge</span><span class="p">.</span><span class="nx">joint</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">jEdge</span><span class="p">.</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_staticBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">other</span><span class="p">.</span><span class="nx">Advance</span><span class="p">(</span><span class="nx">minTOI</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">other</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">queue</span><span class="p">[</span><span class="nx">queueStart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">queueSize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">other</span><span class="p">;</span>
<span class="w">                  </span><span class="o">++</span><span class="nx">queueSize</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">other</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">subStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_timestep</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">warmStarting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">minTOI</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dt</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">dtRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">velocityIterations</span><span class="p">;</span>
<span class="w">            </span><span class="nx">subStep</span><span class="p">.</span><span class="nx">positionIterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">positionIterations</span><span class="p">;</span>
<span class="w">            </span><span class="nx">island</span><span class="p">.</span><span class="nx">SolveTOI</span><span class="p">(</span><span class="nx">subStep</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_bodies</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">continue</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">b</span><span class="p">.</span><span class="nx">SynchronizeFixtures</span><span class="p">();</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">cEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_contactList</span><span class="p">;</span>
<span class="w">               </span><span class="nx">cEdge</span><span class="p">;</span><span class="w"> </span><span class="nx">cEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">cEdge</span><span class="p">.</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_contactCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_contacts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_jointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">island</span><span class="p">.</span><span class="nx">m_joints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">               </span><span class="nx">j</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_contactManager</span><span class="p">.</span><span class="nx">FindNewContacts</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">joint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">.</span><span class="nx">GetBodyA</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">.</span><span class="nx">GetBodyB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b1</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf1</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf2</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_jointColor</span><span class="p">;</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="o">:</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pulley</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">joint</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">joint</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pulley</span><span class="p">.</span><span class="nx">GetGroundAnchorA</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pulley</span><span class="p">.</span><span class="nx">GetGroundAnchorB</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">s1</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">s2</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">s1</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_mouseJoint</span><span class="o">:</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">x2</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2World</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">shape</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_p</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSolidCircle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">,</span><span class="w"> </span><span class="nx">axis</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">poly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">shape</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertexCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">GetVertexCount</span><span class="p">());</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">localVertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">poly</span><span class="p">.</span><span class="nx">GetVertices</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">vertexCount</span><span class="p">);</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">localVertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSolidPolygon</span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">GetVertex1</span><span class="p">()),</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulX</span><span class="p">(</span><span class="nx">xf</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">GetVertex2</span><span class="p">()),</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_timestep2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2TimeStep</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Transform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_backupB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Sweep</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2TimeStep</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">s_jointColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_newFixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">.</span><span class="nx">e_locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0002</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2CircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2CircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactConstraintPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactConstraintPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactRegister</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactResult</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2EdgeAndCircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2NullContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolyAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndCircleContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolyAndEdgeContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolyAndEdgeContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PolygonContact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PositionSolverManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2AABB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Bound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Bound</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BoundValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2BoundValues</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Collision</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactID</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ContactPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Distance</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DistanceProxy</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTree</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeBroadPhase</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreeNode</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DynamicTreePair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2DynamicTreePair</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ManifoldPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2ManifoldPoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Point</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RayCastOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2RayCastOutput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Segment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Segment</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SeparationFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SeparationFunction</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Simplex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Simplex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexCache</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2SimplexVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2SimplexVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeOfImpact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TimeOfImpact</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TOIInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2TOIInput</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">,</span>
<span class="w">         </span><span class="nx">ClipVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">ClipVertex</span><span class="p">,</span>
<span class="w">         </span><span class="nx">Features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Features</span><span class="p">,</span>
<span class="w">         </span><span class="nx">IBroadPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">IBroadPhase</span><span class="p">;</span>

<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2CircleContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">b2CircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2CircleContact</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">Reset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollideCircles</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactEdge</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactEdge</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">worldManifold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">();</span>
<span class="w">         </span><span class="nx">worldManifold</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(),</span><span class="w"> </span><span class="nx">shapeA</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">,</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(),</span><span class="w"> </span><span class="nx">shapeB</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsTouching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsContinuous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">FlagForFiltering</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_filterFlag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">IsSensor</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">IsBullet</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">IsBullet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeA</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_nodeB</span><span class="p">.</span><span class="nx">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tManifold</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">touching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wasTouching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">aabbOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">m_aabb</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">aabbOverlap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">xfA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">xfB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">               </span><span class="nx">touching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">TestOverlap</span><span class="p">(</span><span class="nx">shapeA</span><span class="p">,</span><span class="w"> </span><span class="nx">xfA</span><span class="p">,</span><span class="w"> </span><span class="nx">shapeB</span><span class="p">,</span><span class="w"> </span><span class="nx">xfB</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">IsBullet</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">IsBullet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">aabbOverlap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">Evaluate</span><span class="p">();</span>
<span class="w">               </span><span class="nx">touching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">mp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">                  </span><span class="nx">mp2</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">mp2</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">id2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mp2</span><span class="p">.</span><span class="nx">m_id</span><span class="p">;</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="kd">var</span><span class="w"> </span><span class="nx">mp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">                     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mp1</span><span class="p">.</span><span class="nx">m_id</span><span class="p">.</span><span class="nx">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">id2</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">mp2</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mp1</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="p">;</span>
<span class="w">                        </span><span class="nx">mp2</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mp1</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="p">;</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">touching</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">wasTouching</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">               </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">touching</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">wasTouching</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">touching</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">listener</span><span class="p">.</span><span class="nx">BeginContact</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">wasTouching</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">touching</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">listener</span><span class="p">.</span><span class="nx">EndContact</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">m_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">listener</span><span class="p">.</span><span class="nx">PreSolve</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_oldManifold</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ComputeTOI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sweepA</span><span class="p">,</span><span class="w"> </span><span class="nx">sweepB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">.</span><span class="nx">proxyA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">());</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">.</span><span class="nx">proxyB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">());</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">.</span><span class="nx">sweepA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sweepA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">.</span><span class="nx">sweepB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sweepB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">.</span><span class="nx">tolerance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2TimeOfImpact</span><span class="p">.</span><span class="nx">TimeOfImpact</span><span class="p">(</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_sensorFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0001</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_continuousFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0002</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0004</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_toiFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0008</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_touchingFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0010</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_enabledFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0020</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">e_filterFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0040</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">s_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2TOIInput</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2ContactConstraint</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localPlaneNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normalMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactConstraint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ContactConstraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactConstraintPoint</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactConstraintPoint</span><span class="p">.</span><span class="nx">b2ContactConstraintPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">rA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">rB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactEdge</span><span class="p">.</span><span class="nx">b2ContactEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ContactFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allocator</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">InitializeRegisters</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">createFcn</span><span class="p">,</span><span class="w"> </span><span class="nx">destroyFcn</span><span class="p">,</span><span class="w"> </span><span class="nx">type1</span><span class="p">,</span><span class="w"> </span><span class="nx">type2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">type1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">type2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type1</span><span class="p">][</span><span class="nx">type2</span><span class="p">].</span><span class="nx">createFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFcn</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type1</span><span class="p">][</span><span class="nx">type2</span><span class="p">].</span><span class="nx">destroyFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">destroyFcn</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type1</span><span class="p">][</span><span class="nx">type2</span><span class="p">].</span><span class="nx">primary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">type2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type2</span><span class="p">][</span><span class="nx">type1</span><span class="p">].</span><span class="nx">createFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFcn</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type2</span><span class="p">][</span><span class="nx">type1</span><span class="p">].</span><span class="nx">destroyFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">destroyFcn</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type2</span><span class="p">][</span><span class="nx">type1</span><span class="p">].</span><span class="nx">primary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitializeRegisters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_shapeTypeCount</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_shapeTypeCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_shapeTypeCount</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_shapeTypeCount</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactRegister</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">AddType</span><span class="p">(</span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="p">,</span><span class="w"> </span><span class="nx">b2CircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">AddType</span><span class="p">(</span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="p">,</span><span class="w"> </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">AddType</span><span class="p">(</span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">Create</span><span class="p">,</span><span class="w"> </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">AddType</span><span class="p">(</span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="p">,</span><span class="w"> </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">AddType</span><span class="p">(</span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">Create</span><span class="p">,</span><span class="w"> </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type1</span><span class="p">][</span><span class="nx">type2</span><span class="p">];</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">pool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">pool</span><span class="p">;</span>
<span class="w">            </span><span class="nx">reg</span><span class="p">.</span><span class="nx">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">            </span><span class="nx">reg</span><span class="p">.</span><span class="nx">poolCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">createFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">createFcn</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">createFcn</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">primary</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFcn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFcn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">               </span><span class="nx">c</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">fixtureB</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">);</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactFactory</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">            </span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_registers</span><span class="p">[</span><span class="nx">type1</span><span class="p">][</span><span class="nx">type2</span><span class="p">];</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// JDM: ESLint warning = constant condition</span>
<span class="w">            </span><span class="nx">reg</span><span class="p">.</span><span class="nx">poolCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">pool</span><span class="p">;</span>
<span class="w">            </span><span class="nx">reg</span><span class="p">.</span><span class="nx">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">destroyFcn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="nx">destroyFcn</span><span class="p">;</span>
<span class="w">         </span><span class="nx">destroyFcn</span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactRegister</span><span class="p">.</span><span class="nx">b2ContactRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2ContactResult</span><span class="p">.</span><span class="nx">b2ContactResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactID</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2TimeStep</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">,</span><span class="w"> </span><span class="nx">contacts</span><span class="p">,</span><span class="w"> </span><span class="nx">contactCount</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">contactCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">contactCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">contact</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_step</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allocator</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contactCount</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ContactConstraint</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">contactCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contacts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">fixtureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">m_shape</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">radiusA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shapeA</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">radiusB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shapeB</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">GetManifold</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2MixFriction</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetFriction</span><span class="p">(),</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetFriction</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2MixRestitution</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetRestitution</span><span class="p">(),</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetRestitution</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="nx">radiusA</span><span class="p">,</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="nx">radiusB</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">manifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_pointCount</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">friction</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">restitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">restitution</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPlaneNormal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPlaneNormal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPlaneNormal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">radiusA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">radiusB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">cc</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_type</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">cp</span><span class="p">.</span><span class="nx">m_localPoint</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rnA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rnB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">rnA</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">rnA</span><span class="p">;</span>
<span class="w">               </span><span class="nx">rnB</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">rnB</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">kNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rnA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rnB</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">kNormal</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">kEqualized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">               </span><span class="nx">kEqualized</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rnA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rnB</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">equalizedMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">kEqualized</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">normalX</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rtA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rtB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">rtA</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">rtA</span><span class="p">;</span>
<span class="w">               </span><span class="nx">rtB</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">rtB</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">kTangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rtA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rtB</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">kTangent</span><span class="p">;</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">velocityBias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">));</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vBY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vAY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">vRel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vRel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_velocityThreshold</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="c1">//JDM: added this commented console.log.</span>
<span class="w">                  </span><span class="c1">//console.log(&quot;vRel,-vT=&quot; + vRel + &quot;,&quot; + (-b2Settings.b2_velocityThreshold));</span>
<span class="w">                  </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">velocityBias</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">cc</span><span class="p">.</span><span class="nx">restitution</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">vRel</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rn1A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rn1B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rn2A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rn2B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1B</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2B</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn1B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rn2B</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_maxConditionNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">k11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k11</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">k_maxConditionNumber</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">k11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">k12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k12</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">cc</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">k11</span><span class="p">,</span><span class="w"> </span><span class="nx">k12</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">cc</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">k12</span><span class="p">,</span><span class="w"> </span><span class="nx">k22</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">cc</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">GetInverse</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">normalMass</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">normalX</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">tCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">                  </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentX</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentY</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">tCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">                  </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">ccp2</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dvX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dvY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxFriction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">vB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normalY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tangentY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">normalX</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">friction</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">ccp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="nx">dvX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">dvY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dvX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dvY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">vt</span><span class="p">);</span>
<span class="w">               </span><span class="nx">maxFriction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">friction</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">lambda</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">maxFriction</span><span class="p">),</span><span class="w"> </span><span class="nx">maxFriction</span><span class="p">);</span>
<span class="w">               </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tangentY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">tCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">ccp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">               </span><span class="nx">dvX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">               </span><span class="nx">dvY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">               </span><span class="nx">vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dvX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dvY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">vn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">velocityBias</span><span class="p">));</span>
<span class="w">               </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">lambda</span><span class="p">;</span>
<span class="w">               </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">ccp</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">cp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">aX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">aY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dv1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dv1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dv2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dv2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">vn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dv1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dv1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">vn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dv2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dv2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vn1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">velocityBias</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vn2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">velocityBias</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">K</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bX</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bY</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_errorTol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.001</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">normalMass</span><span class="p">;</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">));</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">));</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="p">;</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">xX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bX</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">xY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">vn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">vn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bY</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">vn2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="p">;</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">xX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">xY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bY</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">vn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bX</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">vn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">vn1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="p">;</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="nx">xX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">xY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">vn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bX</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">vn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bY</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">vn1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">vn2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">aY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normalY</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">P1Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">rB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">                     </span><span class="nx">cp1</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xX</span><span class="p">;</span>
<span class="w">                     </span><span class="nx">cp2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xY</span><span class="p">;</span>
<span class="w">                     </span><span class="k">break</span><span class="p">;</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wB</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">FinalizeVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">manifold</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">point1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">point2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="nx">point1</span><span class="p">.</span><span class="nx">m_normalImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point2</span><span class="p">.</span><span class="nx">normalImpulse</span><span class="p">;</span>
<span class="w">               </span><span class="nx">point1</span><span class="p">.</span><span class="nx">m_tangentImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point2</span><span class="p">.</span><span class="nx">tangentImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">minSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraintCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constraints</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_psm</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_psm</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">ccp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_psm</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_psm</span><span class="p">.</span><span class="nx">m_separations</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">minSeparation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minSeparation</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">minSeparation</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">separation</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">separation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">ccp</span><span class="p">.</span><span class="nx">equalizedMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">               </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">               </span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">minSeparation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_worldManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2WorldManifold</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2ContactSolver</span><span class="p">.</span><span class="nx">s_psm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PositionSolverManifold</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2EdgeAndCircleContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">b2EdgeAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">Reset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">b2CollideEdgeAndCircle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2EdgeAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2CollideEdgeAndCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">circle</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2NullContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2NullContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2NullContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PolyAndCircleContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">b2PolyAndCircleContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolyAndCircleContact</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">Reset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolyAndCircleContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">m_body</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollidePolygonAndCircle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PolyAndEdgeContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">b2PolyAndEdgeContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">Reset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polygonShape</span><span class="p">);</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">fixtureB</span><span class="p">.</span><span class="nx">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_edgeShape</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">b2CollidePolyAndEdge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolyAndEdgeContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2CollidePolyAndEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">manifold</span><span class="p">,</span><span class="w"> </span><span class="nx">polygon</span><span class="p">,</span><span class="w"> </span><span class="nx">xf1</span><span class="p">,</span><span class="w"> </span><span class="nx">edge</span><span class="p">,</span><span class="w"> </span><span class="nx">xf2</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PolygonContact</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">b2PolygonContact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">b2Contact</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PolygonContact</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">Reset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureA</span><span class="p">,</span><span class="w"> </span><span class="nx">fixtureB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PolygonContact</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">();</span>
<span class="w">         </span><span class="nx">b2Collision</span><span class="p">.</span><span class="nx">CollidePolygons</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_manifold</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureA</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fixtureB</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_separations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector_a2j_Number</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector</span><span class="p">(</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxManifoldPoints</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">cc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_circles</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAX</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pointAY</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">d2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">d2</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pointBX</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">pointAY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pointBY</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_separations</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceA</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPlaneNormal</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_separations</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointX</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clipPointY</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Manifold</span><span class="p">.</span><span class="nx">e_faceB</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPlaneNormal</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">               </span><span class="nx">planePointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">planePointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">               </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">pointCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">localPoint</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_separations</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointX</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">clipPointY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">planePointY</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cc</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nb">Set</span><span class="p">(</span><span class="nx">clipPointX</span><span class="p">,</span><span class="w"> </span><span class="nx">clipPointY</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">circlePointA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Contacts</span><span class="p">.</span><span class="nx">b2PositionSolverManifold</span><span class="p">.</span><span class="nx">circlePointB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2CircleShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeChainDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeChainDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2EdgeShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2EdgeShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MassData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PolygonShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2Shape</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BuoyancyController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2BuoyancyController</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ConstantAccelController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ConstantAccelController</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ConstantForceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ConstantForceController</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ControllerEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2ControllerEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2GravityController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2GravityController</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TensorDampingController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2TensorDampingController</span><span class="p">;</span>

<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2BuoyancyController</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">b2BuoyancyController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearDrag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularDrag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">useDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">useWorldGravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useWorldGravity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">GetWorld</span><span class="p">().</span><span class="nx">GetGravity</span><span class="p">().</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">areac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">massc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetFixtureList</span><span class="p">();</span><span class="w"> </span><span class="nx">fixture</span><span class="p">;</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fixture</span><span class="p">.</span><span class="nx">GetShape</span><span class="p">().</span><span class="nx">ComputeSubmergedArea</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">(),</span><span class="w"> </span><span class="nx">sc</span><span class="p">);</span>
<span class="w">               </span><span class="nx">area</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="p">;</span>
<span class="w">               </span><span class="nx">areac</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sc</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">               </span><span class="nx">areac</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sc</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">shapeDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useDensity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">shapeDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">shapeDensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="nx">mass</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">shapeDensity</span><span class="p">;</span>
<span class="w">               </span><span class="nx">massc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">shapeDensity</span><span class="p">;</span>
<span class="w">               </span><span class="nx">massc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">sarea</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">shapeDensity</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">areac</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">            </span><span class="nx">areac</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">area</span><span class="p">;</span>
<span class="w">            </span><span class="nx">massc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="nx">massc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">mass</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">area</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">buoyancyForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">GetNegative</span><span class="p">();</span>
<span class="w">            </span><span class="nx">buoyancyForce</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">density</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">area</span><span class="p">);</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">buoyancyForce</span><span class="p">,</span><span class="w"> </span><span class="nx">massc</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">dragForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocityFromWorldPoint</span><span class="p">(</span><span class="nx">areac</span><span class="p">);</span>
<span class="w">            </span><span class="nx">dragForce</span><span class="p">.</span><span class="nx">Subtract</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">);</span>
<span class="w">            </span><span class="nx">dragForce</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">linearDrag</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">area</span><span class="p">));</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">dragForce</span><span class="p">,</span><span class="w"> </span><span class="nx">areac</span><span class="p">);</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">ApplyTorque</span><span class="p">((</span><span class="o">-</span><span class="nx">body</span><span class="p">.</span><span class="nx">GetInertia</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetAngularVelocity</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">angularDrag</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2BuoyancyController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Draw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">debugDraw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">         </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">         </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">         </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Color</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">debugDraw</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2ConstantAccelController</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2ConstantAccelController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2ConstantAccelController</span><span class="p">.</span><span class="nx">b2ConstantAccelController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ConstantAccelController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">smallA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">A</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">A</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">body</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">SetLinearVelocity</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">smallA</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">smallA</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2ConstantForceController</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2ConstantForceController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2ConstantForceController</span><span class="p">.</span><span class="nx">b2ConstantForceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2ConstantForceController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">body</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">F</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">());</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Draw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">debugDraw</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AddBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2ControllerEdge</span><span class="p">();</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">;</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">.</span><span class="nx">prevBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">         </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">.</span><span class="nx">prevController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">;</span>
<span class="w">         </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RemoveBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">controller</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="p">)</span>
<span class="w">         </span><span class="nx">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevBody</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevBody</span><span class="p">.</span><span class="nx">nextBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">.</span><span class="nx">prevBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevBody</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">.</span><span class="nx">prevController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevController</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevController</span><span class="p">)</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">prevController</span><span class="p">.</span><span class="nx">nextController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">edge</span><span class="p">)</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">edge</span><span class="p">.</span><span class="nx">nextController</span><span class="p">;</span>
<span class="w">         </span><span class="nx">body</span><span class="p">.</span><span class="nx">m_controllerCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyCount</span><span class="o">--</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Clear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">)</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">RemoveBody</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetWorld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_world</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBodyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2ControllerEdge</span><span class="p">.</span><span class="nx">b2ControllerEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2GravityController</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2GravityController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2GravityController</span><span class="p">.</span><span class="nx">b2GravityController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">invSqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2GravityController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">body2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">invSqr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">body1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">               </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">               </span><span class="nx">mass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">();</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">               </span><span class="nx">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">body2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">                  </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">f</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">G</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">r2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">mass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">());</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body1</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">f</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body2</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">body1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">               </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">               </span><span class="nx">mass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">();</span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span>
<span class="w">               </span><span class="nx">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">body2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">j</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">();</span>
<span class="w">                  </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="p">;</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                  </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">f</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">G</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">mass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">());</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body1</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="nx">body1</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">);</span>
<span class="w">                  </span><span class="nx">f</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">((</span><span class="o">-</span><span class="mf">1</span><span class="p">));</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">body2</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="nx">body2</span><span class="p">.</span><span class="nx">ApplyForce</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2TensorDampingController</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">b2TensorDampingController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">b2Controller</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAxisAligned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xDamping</span><span class="p">,</span><span class="w"> </span><span class="nx">yDamping</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xDamping</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">xDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">yDamping</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">yDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">xDamping</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">yDamping</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xDamping</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">yDamping</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">xDamping</span><span class="p">,</span><span class="w"> </span><span class="nx">yDamping</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2TensorDampingController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timestep</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timestep</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTimestep</span><span class="p">;</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">nextBody</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">body</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">damping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLocalVector</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">())));</span>
<span class="w">            </span><span class="nx">body</span><span class="p">.</span><span class="nx">SetLinearVelocity</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">damping</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">timestep</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">GetLinearVelocity</span><span class="p">().</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">damping</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">timestep</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Color</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2internal</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat22</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Mat33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Mat33</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Math</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Math</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Sweep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Transform</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Vec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec3</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FrictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2GearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Jacobian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Jacobian</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2JointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2JointEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointEdge</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2LineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WeldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2BodyDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactFilter</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactImpulse</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2ContactManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactManager</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2DestructionListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DestructionListener</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FilterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FilterData</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2FixtureDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2Island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Island</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2TimeStep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2TimeStep</span><span class="p">,</span>
<span class="w">         </span><span class="nx">b2World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">;</span>

<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2DistanceJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFrequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFrequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hz</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hz</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">frequencyHz</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">dampingRatio</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cr1u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cr2u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr1u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr1u</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr2u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr2u</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1X</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">Cdot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bias</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">dX</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">dY</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_length</span><span class="p">;</span>
<span class="w">         </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">dX</span><span class="p">,</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2DistanceJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2DistanceJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">,</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchorA</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchorB</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2FrictionJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">force</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMaxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">torque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMaxTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxTorque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2FrictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearMass</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxForce</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxTorque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">K</span><span class="p">.</span><span class="nx">GetInverse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearMass</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxTorque</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">maxImpulse</span><span class="p">),</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_angularImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulseV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearMass</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">((</span><span class="o">-</span><span class="nx">CdotX</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">CdotY</span><span class="p">)));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulseV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">impulseV</span><span class="p">);</span>
<span class="w">            </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">Normalize</span><span class="p">();</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="nx">maxImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">impulseV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">SubtractVV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_linearImpulse</span><span class="p">,</span><span class="w"> </span><span class="nx">oldImpulseV</span><span class="p">);</span>
<span class="w">            </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseV</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2FrictionJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_frictionJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2FrictionJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2GearJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Jacobian</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2GearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="p">.</span><span class="nx">m_type</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">type2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="p">.</span><span class="nx">m_type</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="p">.</span><span class="nx">GetBodyA</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="p">.</span><span class="nx">GetBodyB</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_revoluteJoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">.</span><span class="nx">GetJointAngle</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="p">.</span><span class="nx">GetBodyA</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="p">.</span><span class="nx">GetBodyB</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">type2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_revoluteJoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">.</span><span class="nx">GetJointAngle</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">joint2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">coordinate2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">g1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">ugX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">ugY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tVec</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">crug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">K</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g1</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">ugX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">ugY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">crug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugX</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="nx">ugX</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">ugY</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">crug</span><span class="p">);</span>
<span class="w">            </span><span class="nx">K</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">crug</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">crug</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="p">);</span>
<span class="w">            </span><span class="nx">K</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g2</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">ugX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">ugY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tVec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">crug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugX</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugX</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">ugY</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">crug</span><span class="p">);</span>
<span class="w">            </span><span class="nx">K</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">crug</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">crug</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">Compute</span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2GearJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute1</span><span class="p">.</span><span class="nx">GetJointAngle</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic1</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_revolute2</span><span class="p">.</span><span class="nx">GetJointAngle</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">coordinate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prismatic2</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">coordinate1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">coordinate2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_J</span><span class="p">.</span><span class="nx">angularB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2GearJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2GearJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_gearJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">joint1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">joint2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">b2Jacobian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetZero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nb">Set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span><span class="w"> </span><span class="nx">a1</span><span class="p">,</span><span class="w"> </span><span class="nx">x2</span><span class="p">,</span><span class="w"> </span><span class="nx">a2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">x1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">x2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Jacobian</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span><span class="w"> </span><span class="nx">a1</span><span class="p">,</span><span class="w"> </span><span class="nx">x2</span><span class="p">,</span><span class="w"> </span><span class="nx">a2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">linearA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">angularA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">linearB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">angularB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">a2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_edgeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2JointEdge</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_edgeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2JointEdge</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetBodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetUserData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">IsActive</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">Create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2DistanceJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2DistanceJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_mouseJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2MouseJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_prismaticJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PrismaticJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_revoluteJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_gearJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2GearJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2GearJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_lineJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2LineJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_weldJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2WeldJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_frictionJoint</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nx">joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2FrictionJoint</span><span class="p">((</span><span class="nx">def</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">b2FrictionJointDef</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">joint</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">Destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">joint</span><span class="p">,</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2Joint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2Assert</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_collideConnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">collideConnected</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_islandFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">userData</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">FinalizeVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_unknownJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_revoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_prismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_mouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_gearJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_lineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_weldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_frictionJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_unknownJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">collideConnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2JointEdge</span><span class="p">.</span><span class="nx">b2JointEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2LineJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">translation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">)))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLimitEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLowerLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUpperLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="p">,</span><span class="w"> </span><span class="nx">upper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">upper</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lower</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upper</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsMotorEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">force</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMaxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2LineJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAxisA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">lowerTranslation</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">upperTranslation</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxMotorForce</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableLimit</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableMotor</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetLocalCenter</span><span class="p">());</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetLocalCenter</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">maxImpulse</span><span class="p">),</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot2</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">df</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">f2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">f2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f2r</span><span class="p">;</span>
<span class="w">            </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">Cdot1</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">df2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">limitC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldLimitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromAngle</span><span class="p">(</span><span class="nx">a1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">R2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromAngle</span><span class="p">(</span><span class="nx">a2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">R1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">R2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">R1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">translation</span><span class="p">);</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">translation</span><span class="p">;</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">;</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">R1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">linearError</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C1</span><span class="p">));</span>
<span class="w">         </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve</span><span class="p">(</span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C2</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">k11</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">impulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">C1</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">k11</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">impulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">a1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">a2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2LineJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2LineJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_lineJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2LineJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchor</span><span class="p">,</span><span class="w"> </span><span class="nx">axis</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalVector</span><span class="p">(</span><span class="nx">axis</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2MouseJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">IsAwake</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMaxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">maxForce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxForce</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxForce</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFrequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFrequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">hz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hz</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">hz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hz</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ratio</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2MouseJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxForce</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">frequencyHz</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">dampingRatio</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">GetMass</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_frequencyHz</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_dampingRatio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">omega</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">invI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">AddM</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">GetInverse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_C</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_C</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_target</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">0.98</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rY</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rX</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CdotX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_C</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CdotY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_C</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tY</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">tY</span><span class="p">));</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxForce</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">LengthSquared</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Length</span><span class="p">());</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">impulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulseX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulseY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2MouseJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2MouseJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2MouseJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2MouseJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_mouseJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">frequencyHz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">dampingRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PrismaticJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">translation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetWorldVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">)))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)));</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLimitEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLowerLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUpperLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="p">,</span><span class="w"> </span><span class="nx">upper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">upper</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lower</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upper</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsMotorEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">force</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">force</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PrismaticJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAxisA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_refAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">lowerTranslation</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">upperTranslation</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxMotorForce</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableLimit</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableMotor</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetLocalCenter</span><span class="p">());</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetLocalCenter</span><span class="p">());</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">xf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">GetTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Number</span><span class="p">.</span><span class="nx">MIN_VALUE</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">xf1</span><span class="p">.</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointTransition</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorForce</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">maxImpulse</span><span class="p">),</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve33</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot2</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">df</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">f2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="nx">bX</span><span class="p">,</span><span class="w"> </span><span class="nx">bY</span><span class="p">);</span>
<span class="w">            </span><span class="nx">f2r</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">f2r</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f2r</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f2r</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">df</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">f1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">df2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">limitC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldLimitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromAngle</span><span class="p">(</span><span class="nx">a1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">R2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">.</span><span class="nx">FromAngle</span><span class="p">(</span><span class="nx">a2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">R1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">R2</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localCenterB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">c1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">R1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localXAxis1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">translation</span><span class="p">);</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerTranslation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">translation</span><span class="p">;</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">translation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperTranslation</span><span class="p">;</span>
<span class="w">               </span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">MulMV</span><span class="p">(</span><span class="nx">R1</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localYAxis1</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">dY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_refAngle</span><span class="p">;</span>
<span class="w">         </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">linearError</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C1X</span><span class="p">));</span>
<span class="w">         </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C1Y</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve33</span><span class="p">(</span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1Y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C2</span><span class="p">));</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="p">;</span>
<span class="w">            </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">k11</span><span class="p">,</span><span class="w"> </span><span class="nx">k12</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">k12</span><span class="p">,</span><span class="w"> </span><span class="nx">k22</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_K</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_perp</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_axis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a1</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_s2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_a2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">a1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">c2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invMassB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">         </span><span class="nx">a2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_invIB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">L2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a2</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PrismaticJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PrismaticJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_prismaticJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperTranslation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxMotorForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PrismaticJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchor</span><span class="p">,</span><span class="w"> </span><span class="nx">axis</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAxisA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalVector</span><span class="p">(</span><span class="nx">axis</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PulleyJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetGroundAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetGroundAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Copy</span><span class="p">();</span>
<span class="w">         </span><span class="nx">a</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLength1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLength2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">sY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sY</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dY</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_world</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">groundAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">groundAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">groundAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">groundAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">lengthA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">lengthB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">maxLengthA</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2_minPulleyLength</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">maxLengthB</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2_minPulleyLength</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p1X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1X</span><span class="p">,</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1Y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2X</span><span class="p">,</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2Y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length1</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length2</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">length1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">length2</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cr1u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">cr2u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr1u1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr1u1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr2u2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cr2u2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pulleyMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pulleyMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pulleyMass</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_pulleyMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">Cdot</span><span class="p">));</span>
<span class="w">            </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">v1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">v1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v1Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">            </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">P1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P1X</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">v2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">v2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">v2Y</span><span class="p">));</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">Cdot</span><span class="p">);</span>
<span class="w">            </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitImpulse2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">P2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">P2X</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ground</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_groundAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">length2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldLimitPositionImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p1X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1X</span><span class="p">,</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2X</span><span class="p">,</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">length1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">            </span><span class="nx">length2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length1</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length2</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_constant</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">length1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">length2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">linearError</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C</span><span class="p">));</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_pulleyMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p1X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1X</span><span class="p">,</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">length1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length1</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">length1</span><span class="p">;</span>
<span class="w">            </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">linearError</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C</span><span class="p">));</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p1X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="nx">p2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2X</span><span class="p">,</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">s2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">length2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">Length</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length2</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">length2</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxLength2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">length2</span><span class="p">;</span>
<span class="w">            </span><span class="nx">linearError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">linearError</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C</span><span class="p">));</span>
<span class="w">            </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxLinearCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitMass2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">impulse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_u2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2X</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2Y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">p2X</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">linearError</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2_minPulleyLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2PulleyJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2PulleyJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorA</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">.</span><span class="nb">Set</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxLengthA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxLengthB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">collideConnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2PulleyJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">gaA</span><span class="p">,</span><span class="w"> </span><span class="nx">gaB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">,</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">gaA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">groundAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">gaB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchorB</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gaA</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gaA</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">d1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d1Y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gaB</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gaB</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">d2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">d2Y</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">lengthB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxLengthA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2_minPulleyLength</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxLengthB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2PulleyJoint</span><span class="p">.</span><span class="nx">b2_minPulleyLength</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ratio</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2RevoluteJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat22</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetJointSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsLimitEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLowerLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetUpperLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="p">,</span><span class="w"> </span><span class="nx">upper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lower</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">upper</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lower</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">upper</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">IsMotorEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">EnableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">speed</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">SetAwake</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetMaxMotorTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">torque</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">torque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetMotorTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorTorque</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">lowerAngle</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">upperAngle</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">maxMotorTorque</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableLimit</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">enableMotor</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// JDM: ESLint warning = empty block</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">         </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i2</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">jointAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointAngle</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">jointAngle</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">PX</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableMotor</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">w1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorSpeed</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">Cdot</span><span class="p">));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_maxMotorTorque</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">maxImpulse</span><span class="p">),</span><span class="w"> </span><span class="nx">maxImpulse</span><span class="p">);</span>
<span class="w">            </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorImpulse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve33</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot2</span><span class="p">));</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">));</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">newImpulse</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">));</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reduced</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">                  </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse3</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">));</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CdotY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">w2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">w1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve22</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">CdotX</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">CdotY</span><span class="p">));</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">m1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">i1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">m2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">w2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">i2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">impulse2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w1</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">w2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">oldLimitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_enableLimit</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_inactiveLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">limitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_equalLimits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">angle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxAngularCorrection</span><span class="p">),</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxAngularCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">limitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">               </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atLowerLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lowerAngle</span><span class="p">;</span>
<span class="w">               </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C</span><span class="p">);</span>
<span class="w">               </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxAngularCorrection</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">               </span><span class="nx">limitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_limitState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_atUpperLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_upperAngle</span><span class="p">;</span>
<span class="w">               </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">C</span><span class="p">;</span>
<span class="w">               </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Clamp</span><span class="p">(</span><span class="nx">C</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_maxAngularCorrection</span><span class="p">);</span>
<span class="w">               </span><span class="nx">limitImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">m_motorMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">limitImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">limitImpulse</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchor2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="nx">r2X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CLengthSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">CX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">CY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">CY</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">CLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">CLengthSquared</span><span class="p">);</span>
<span class="w">            </span><span class="nx">positionError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CLength</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invMass2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invI1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">invI2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_allowedStretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">CLengthSquared</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">k_allowedStretch</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">k_allowedStretch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">uX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">CLength</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">uY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CY</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">CLength</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMass2</span><span class="p">;</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">k</span><span class="p">;</span>
<span class="w">               </span><span class="nx">impulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">CX</span><span class="p">));</span>
<span class="w">               </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="nx">CY</span><span class="p">));</span>
<span class="w">               </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">k_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">k_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">k_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">invMass2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">               </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">k_beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">invMass2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">               </span><span class="nx">CX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">               </span><span class="nx">CY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMass2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invMass1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">invMass2</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r1X</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">invI2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2Y</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">invI2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r2X</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">SetM</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">K1</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">AddM</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">K2</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">AddM</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">K3</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">K</span><span class="p">.</span><span class="nx">Solve</span><span class="p">(</span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">tImpulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">CX</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">CY</span><span class="p">));</span>
<span class="w">            </span><span class="nx">impulseX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">tImpulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">tImpulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r2X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">r2Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulseX</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">positionError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">.</span><span class="nx">tImpulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2RevoluteJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_revoluteJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">.</span><span class="nb">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">lowerAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">upperAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">maxMotorTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">motorSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">enableMotor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2RevoluteJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2WeldJoint</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">.</span><span class="nx">GetWorldPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionForce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetReactionTorque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">inv_dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2WeldJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">def</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Mat33</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">InitVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">warmStarting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">step</span><span class="p">.</span><span class="nx">dtRatio</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">            </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">SetZero</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolveVelocityConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">vB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_linearVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">Cdot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">wA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve33</span><span class="p">(</span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot1Y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">Cdot2</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_impulse</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">impulse</span><span class="p">);</span>
<span class="w">         </span><span class="nx">vA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">vA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">wA</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="nx">vB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">vB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">wB</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wA</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_angularVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wB</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJoint</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SolvePositionConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">baumgarte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tMat</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyA</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">bB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_bodyB</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorA</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_xf</span><span class="p">.</span><span class="nx">R</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_localAnchorB</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">localCenter</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">tX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tMat</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="p">);</span>
<span class="w">         </span><span class="nx">rBX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invMass</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_invI</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C1X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAX</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C1Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">C2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_referenceAngle</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">k_allowedStretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">positionError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">C1X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C1X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">C1Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">C1Y</span><span class="p">);</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">C2</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">positionError</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">k_allowedStretch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">iA</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">iB</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">col3</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">iB</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">impulse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec3</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_mass</span><span class="p">.</span><span class="nx">Solve33</span><span class="p">(</span><span class="nx">impulse</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1X</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C1Y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">C2</span><span class="p">));</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">mA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">iA</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rAX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">mB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">m_sweep</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">iB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">rBX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">rBY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">impulse</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="w">         </span><span class="nx">bA</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="nx">bB</span><span class="p">.</span><span class="nx">SynchronizeTransform</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nx">positionError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_linearSlop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">angularError</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">b2Settings</span><span class="p">.</span><span class="nx">b2_angularSlop</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">b2WeldJointDef</span><span class="p">,</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">);</span>
<span class="w">      </span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__super</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">b2Vec2</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2WeldJointDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">__super</span><span class="p">.</span><span class="nx">b2JointDef</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_weldJoint</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">b2WeldJointDef</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">bA</span><span class="p">,</span><span class="w"> </span><span class="nx">bB</span><span class="p">,</span><span class="w"> </span><span class="nx">anchor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bA</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bB</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorA</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">localAnchorB</span><span class="p">.</span><span class="nx">SetV</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetLocalPoint</span><span class="p">(</span><span class="nx">anchor</span><span class="p">));</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">referenceAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyB</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">bodyA</span><span class="p">.</span><span class="nx">GetAngle</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">})();</span>
<span class="w">   </span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="p">;</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">__this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">         </span><span class="c1">//#WORKAROUND</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_sprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">graphics</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">clear</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">__this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">};</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;rgba(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF00</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b2DebugDraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flags</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawFlags</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">AppendFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawFlags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="nx">flags</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClearFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">flags</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawFlags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="nx">flags</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetSprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">sprite</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sprite</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetSprite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetDrawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">drawScale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">drawScale</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetDrawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetLineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">lineThickness</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lineThickness</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">lineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lineThickness</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">.</span><span class="nx">strokeWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lineThickness</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetLineThickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_lineThickness</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alpha</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetFillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">alpha</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alpha</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetFillAlpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fillAlpha</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">SetXFormScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xformScale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xformScale</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="nx">xformScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xformScale</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">GetXFormScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawPolygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSolidPolygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">vertexCount</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fillAlpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">vertexCount</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">vertices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSolidCircle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">,</span><span class="w"> </span><span class="nx">axis</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">,</span>
<span class="w">            </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">,</span>
<span class="w">            </span><span class="nx">cx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span>
<span class="w">            </span><span class="nx">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_fillAlpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">cx</span><span class="p">,</span><span class="w"> </span><span class="nx">cy</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">cx</span><span class="p">,</span><span class="w"> </span><span class="nx">cy</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">((</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawSegment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">,</span>
<span class="w">            </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="nx">color</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">      </span><span class="nx">b2DebugDraw</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DrawTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_ctx</span><span class="p">,</span>
<span class="w">            </span><span class="nx">drawScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_drawScale</span><span class="p">;</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="mh">0xff0000</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">((</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>

<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">(</span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_alpha</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">((</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">xf</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">m_xformScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">xf</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">col2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">drawScale</span><span class="p">);</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="w">         </span><span class="nx">s</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">   </span><span class="p">})();</span><span class="w"> </span><span class="c1">//post-definitions</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">[</span><span class="nx">i</span><span class="p">]();</span>
<span class="w">   </span><span class="ow">delete</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">postDefs</span><span class="p">;</span>

<span class="w">   </span><span class="c1">// end of original code</span>

<span class="w">   </span><span class="c1">// Reveal public references.</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">&#39;Vec2&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">b2Vec2</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;BodyDef&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2BodyDef</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;Body&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Body</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;FixtureDef&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2FixtureDef</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;Fixture&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2Fixture</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;World&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2World</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;Manifold&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2Manifold</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;WorldManifold&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2WorldManifold</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;DistanceJointDef&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJointDef</span><span class="p">,</span><span class="w">      </span>
<span class="w">      </span><span class="s1">&#39;DistanceJoint&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2DistanceJoint</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;RevoluteJointDef&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJointDef</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;RevoluteJoint&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">Joints</span><span class="p">.</span><span class="nx">b2RevoluteJoint</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;MassData&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2MassData</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;PolygonShape&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2PolygonShape</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;CircleShape&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">Shapes</span><span class="p">.</span><span class="nx">b2CircleShape</span><span class="p">,</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;AABB&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Collision</span><span class="p">.</span><span class="nx">b2AABB</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;ContactListener&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Dynamics</span><span class="p">.</span><span class="nx">b2ContactListener</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;Settings&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">Box2D</span><span class="p">.</span><span class="nx">Common</span><span class="p">.</span><span class="nx">b2Settings</span>
<span class="w">   </span><span class="p">};</span>
<span class="w">   </span>
<span class="p">})();</span>
</pre></div>
</body>
</html>
