<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://triquence.org/monkeyHunt.js.html' />
  <title>monkeyHunt.js</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #3D7B7B; font-style: italic } /* Comment */
body .err { border: 1px solid #F00 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666 } /* Operator */
body .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
body .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
body .cp { color: #9C6500 } /* Comment.Preproc */
body .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
body .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #E40000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #008400 } /* Generic.Inserted */
body .go { color: #717171 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #04D } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #687822 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #00F; font-weight: bold } /* Name.Class */
body .no { color: #800 } /* Name.Constant */
body .nd { color: #A2F } /* Name.Decorator */
body .ni { color: #717171; font-weight: bold } /* Name.Entity */
body .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
body .nf { color: #00F } /* Name.Function */
body .nl { color: #767600 } /* Name.Label */
body .nn { color: #00F; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #A2F; font-weight: bold } /* Operator.Word */
body .w { color: #BBB } /* Text.Whitespace */
body .mb { color: #666 } /* Literal.Number.Bin */
body .mf { color: #666 } /* Literal.Number.Float */
body .mh { color: #666 } /* Literal.Number.Hex */
body .mi { color: #666 } /* Literal.Number.Integer */
body .mo { color: #666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #A45A77 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #00F } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">Copyright 2022 James D. Miller</span>

<span class="cm">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="cm">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="cm">in the Software without restriction, including without limitation the rights</span>
<span class="cm">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="cm">copies of the Software, and to permit persons to whom the Software is</span>
<span class="cm">furnished to do so, subject to the following conditions:</span>

<span class="cm">The above copyright notice and this permission notice shall be included in all</span>
<span class="cm">copies or substantial portions of the Software.</span>

<span class="cm">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="cm">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm">SOFTWARE.</span>
<span class="cm">*/</span>

<span class="c1">// Monkey Hunt (mH) module</span>
<span class="c1">// monkeyHunt.js</span>
<span class="w">   </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;mH _*-*_&#39;</span><span class="p">);</span>
<span class="c1">// 1:30 PM Tue January 3, 2023</span>

<span class="cm">/*</span>
<span class="cm">gwModule.js has an alphabetical list of all modules and their nicknames as added to the windows namespace.</span>
<span class="cm">*/</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">mH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// Names starting with m_ indicate module-scope globals.</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">m_timeOfStart</span><span class="p">,</span><span class="w"> </span><span class="nx">m_reportedWin</span><span class="p">,</span><span class="w"> </span><span class="nx">m_updatedScore</span><span class="p">,</span><span class="w"> </span><span class="nx">m_monkeyInWindow</span><span class="p">,</span><span class="w"> </span><span class="nx">m_monkeyHitFloor</span><span class="p">,</span><span class="w"> </span><span class="nx">m_autoPosition</span><span class="p">,</span>
<span class="w">       </span><span class="nx">m_timeOutID_autoPosition</span><span class="p">,</span><span class="w"> </span><span class="nx">m_timeOutID_niceShot</span><span class="p">,</span><span class="w"> </span><span class="nx">m_reportedWin</span><span class="p">,</span><span class="w"> </span><span class="nx">m_clientName</span><span class="p">,</span><span class="w"> </span><span class="nx">m_projectileName</span><span class="p">,</span>
<span class="w">       </span><span class="nx">m_hitCount</span><span class="p">,</span><span class="w"> </span><span class="nx">m_hitMessageIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">m_shotIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">m_gameOverReported</span><span class="p">,</span><span class="w"> </span><span class="nx">m_timeOfStart</span><span class="p">,</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="p">,</span><span class="w"> </span><span class="nx">m_shotInPlay</span><span class="p">;</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">m_wallMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;wall3&#39;</span><span class="o">:</span><span class="s1">&#39;floor&#39;</span><span class="p">,</span><span class="s1">&#39;wall8&#39;</span><span class="o">:</span><span class="s1">&#39;topWindow&#39;</span><span class="p">,</span><span class="s1">&#39;wall5&#39;</span><span class="o">:</span><span class="s1">&#39;bottomRight&#39;</span><span class="p">,</span><span class="s1">&#39;wall9&#39;</span><span class="o">:</span><span class="s1">&#39;topRight&#39;</span><span class="p">};</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">m_puckMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;puck1&#39;</span><span class="o">:</span><span class="s1">&#39;shooter&#39;</span><span class="p">,</span><span class="s1">&#39;puck2&#39;</span><span class="o">:</span><span class="s1">&#39;monkey&#39;</span><span class="p">};</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">m_rightWall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;wall5&#39;</span><span class="p">,</span><span class="s1">&#39;wall9&#39;</span><span class="p">];</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// module globals for objects brought in by initializeModule</span>
<span class="w">   </span><span class="c1">// (none)</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="w">   </span><span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">initializeModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// nothing yet</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// This is called in the poolShot function and acts to prepares for collision detection by sensors.</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">resetShotState</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">m_clientName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="p">.</span><span class="nx">clientName</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">m_projectileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="p">.</span><span class="nx">puckName</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;puck1&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">initializing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="p">.</span><span class="nx">initializing</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">m_monkeyInWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_updatedScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_hitCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="c1">// 1,2,3.. After shooting the first shot, the m_shotIndex is 2.</span>
<span class="w">      </span><span class="nx">m_shotIndex</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_shotInPlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_autoPosition</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">initializing</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_timeOutID_autoPosition</span><span class="p">)</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="w"> </span><span class="nx">m_timeOutID_autoPosition</span><span class="p">);</span>
<span class="w">         </span><span class="nx">waitThenSetPositions</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// the s key runs this directly, no wait.</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">setPositions</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">disableAutoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span><span class="w"> </span><span class="nx">pars</span><span class="p">.</span><span class="nx">disableAutoPosition</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">disableAutoPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">m_autoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_timeOutID_autoPosition</span><span class="p">)</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="w"> </span><span class="nx">m_timeOutID_autoPosition</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_timeOutID_niceShot</span><span class="p">)</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="w"> </span><span class="nx">m_timeOutID_niceShot</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Make sure the platforms aren&#39;t still there (before we create and position new ones).</span>
<span class="w">      </span><span class="nx">deleteMonkeyWalls</span><span class="p">();</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// monkey and platform</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">].</span><span class="nx">setPosition</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">17.8</span><span class="p">,</span><span class="w"> </span><span class="mf">12.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">         </span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="w"> </span><span class="mf">17.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.19</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;wall6&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.60</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;monkeyHunt&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Shooter</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">].</span><span class="nx">setPosition</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">  </span><span class="mf">12.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">         </span><span class="ow">new</span><span class="w"> </span><span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="w"> </span><span class="mf">0.173</span><span class="p">,</span><span class="w"> </span><span class="mf">9.19</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.60</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;monkeyHunt&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
<span class="w">         </span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">].</span><span class="nx">setPosition</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">  </span><span class="mf">1.5</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_gameOverReported</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">setFont</span><span class="p">(</span><span class="s1">&#39;25px Arial&#39;</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;He&#39;s back... \\ \\ ...shot &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; of &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;He&#39;s back... \\ \\   you&#39;re on the ground this time... \\ \\...shot &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; of &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">m_monkeyHitFloor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_shotInPlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">updateScore</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Taunt the user if not hitting monkey before floor collision.</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">someOneHasHitIt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">someOneHasHitIt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">someOneHasHitIt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">addToIt</span><span class="p">(</span><span class="s2">&quot;\\ \\ \\ \\[25px Arial,lightgray]Bump him[base] out the window.&quot;</span><span class="p">);</span>
<span class="w">         </span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="mf">2</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">6</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="w"> </span><span class="nx">m_shotIndex</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;monkeyPlacement2&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;monkeyPlacement&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w">  </span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">waitThenSetPositions</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help2&#39;</span><span class="p">].</span><span class="nx">loc_px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mf">4</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mf">15</span><span class="p">};</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help2&#39;</span><span class="p">].</span><span class="nx">newMessageSeries</span><span class="p">({</span>
<span class="w">         </span><span class="mf">1</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]6[15px Arial,lightgray]: wait for next shot.&#39;</span><span class="p">},</span>
<span class="w">         </span><span class="mf">2</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]5[base]&#39;</span><span class="p">},</span>
<span class="w">         </span><span class="mf">3</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]4[base]&#39;</span><span class="p">},</span>
<span class="w">         </span><span class="mf">4</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]3[base]&#39;</span><span class="p">},</span>
<span class="w">         </span><span class="mf">5</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]2[base]&#39;</span><span class="p">},</span>
<span class="w">         </span><span class="mf">6</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[15px Arial,yellow]1[base]&#39;</span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">m_timeOutID_autoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">setPositions</span><span class="p">();</span>
<span class="w">         </span><span class="nx">m_timeOutID_autoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="mf">6000</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">initializeGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">resetShotState</span><span class="p">({</span><span class="s1">&#39;initializing&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">m_autoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_monkeyHitFloor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_timeOfStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">      </span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_timeOutID_autoPosition</span><span class="p">)</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="w"> </span><span class="nx">m_timeOutID_autoPosition</span><span class="p">);</span>
<span class="w">      </span><span class="nx">m_timeOutID_autoPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_timeOutID_niceShot</span><span class="p">)</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="w"> </span><span class="nx">m_timeOutID_niceShot</span><span class="p">);</span>
<span class="w">      </span><span class="nx">m_timeOutID_niceShot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">m_reportedWin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_updatedScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_hitCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_shotLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">;</span><span class="w"> </span><span class="c1">// 6</span>
<span class="w">      </span><span class="nx">m_gameOverReported</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">m_timeOfStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">      </span><span class="nx">m_shotInPlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">updateScore</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;monkeyPlacement&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">loc_px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mf">450</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mf">350</span><span class="p">};</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">setFont</span><span class="p">(</span><span class="s1">&#39;50px Arial&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">popAtEnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;Monkey Hunt \\  [30px Arial]a challenge for you...[base]&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                                   </span><span class="s2">&quot;\\ \\  [italic 35px Arial]     hit the monkey before he lands&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">loc_px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mf">75</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mf">90</span><span class="p">};</span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">newMessageSeries</span><span class="p">({</span>
<span class="w">         </span><span class="mf">1</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,yellow]full-screen[25px Arial,lightgray] view:&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                </span><span class="s1">&#39;\\    press the [base,yellow]esc[base] or [base,yellow]zero[base] key to return to the normal view&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                </span><span class="s1">&#39;\\    press the [base,yellow]v key[base] for full-screen&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">2</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,yellow]aim[25px Arial,lightgray] your shot:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    use the mouse to [base,yellow]drag[base] the projectile forecast out of the ball&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                             </span><span class="s1">&#39;\\ \\    (on a touch screen, touch the ball and drag)&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">3</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,yellow]shoot[25px Arial,lightgray] the ball:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    [base,yellow]release[base] the mouse button after aiming&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    release [base,yellow]over[base] the ball to [base,yellow]cancel[base] the shot&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                             </span><span class="s1">&#39;\\ \\    (on a touch screen, release your touch point after aiming)&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">4</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,yellow]fine tune[25px Arial,lightgray] your shot:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    to toggle fine-moves, tap the [base,yellow]b key[base] while dragging the ball&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                             </span><span class="s1">&#39;\\ \\    (on a touch screen, tap a second-finger while dragging)&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">5</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">7.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,lightgray](alternately) lock the ball [25px Arial,yellow]speed[25px Arial,lightgray]:&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                </span><span class="s1">&#39;\\    tap the [base,yellow]z key[base] while dragging the ball to set new speed locks&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                </span><span class="s1">&#39;\\    or use the [base,yellow]mouse wheel[base] to change the speed after locking&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    to unlock, tap z with no ball selected&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">6</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s1">&#39;[25px Arial,yellow]Manually[25px Arial,lightgray] start the next shot with the [25px Arial,yellow]s key[25px Arial,lightgray]&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                </span><span class="s1">&#39;\\    (instead of waiting 6 seconds)&#39;</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">         </span><span class="mf">7</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;tL_s&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="o">:</span><span class="s2">&quot;[25px Arial,yellow]restart[25px Arial,lightgray] the challenge (and this help):&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                </span><span class="s1">&#39;\\    press [base,yellow]#4 key[base] &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                             </span><span class="s1">&#39;\\ \\    (on a touch screen, restart with a four-finger touch)&#39;</span>
<span class="w">                                </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help2&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
<span class="w">            </span>
<span class="w">      </span><span class="c1">// Make sure all touch-screen clients have their control key UP (so not ball-in-hand). This must be set on the client and then sent from there to the host.</span>
<span class="w">      </span><span class="nx">hC</span><span class="p">.</span><span class="nx">sendSocketControlMessage</span><span class="p">({</span><span class="s1">&#39;from&#39;</span><span class="o">:</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;to&#39;</span><span class="o">:</span><span class="s1">&#39;roomNoSender&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;data&#39;</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;controlKey&#39;</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="o">:</span><span class="s1">&#39;U&#39;</span><span class="p">}}});</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">deleteMonkeyWalls</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span><span class="w"> </span><span class="nx">wall</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">wall</span><span class="p">.</span><span class="nx">monkeyHunt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">wall</span><span class="p">.</span><span class="nx">deleteThisOne</span><span class="p">({});</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">updateScore</span><span class="p">(</span><span class="w"> </span><span class="nx">scoreChange</span><span class="p">,</span><span class="w"> </span><span class="nx">showChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Allow only one score update per shot (similar, a bit redundant, to the checks on m_hitCount).</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_updatedScore</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">clients</span><span class="p">[</span><span class="w"> </span><span class="nx">m_clientName</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">scoreChange</span><span class="p">;</span>
<span class="w">         </span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="nx">scoreString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="nx">n_nonZeroScores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">n_nonZeroScores</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">scoreChangeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">m_clientName</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">scoreChange</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">scoreChangeString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">showChange</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39; (+&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">scoreChangeValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="nx">scoreString</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">nameString</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;: [base,yellow]&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">scoreChangeString</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;[base]    &#39;</span><span class="p">;</span>
<span class="w">         </span><span class="p">});</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">n_nonZeroScores</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">scoreString</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;\\[20px Arial, gray]Multiple players share a total of six shots.[base]&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_reportedWin</span><span class="p">)</span><span class="w"> </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="w"> </span><span class="nx">scoreString</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">);</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">m_updatedScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// This gets called in gwModule for any puck collisions with walls during demo 4.e.</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">processWallCollisions</span><span class="p">(</span><span class="w"> </span><span class="nx">puck</span><span class="p">,</span><span class="w"> </span><span class="nx">wall</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotInPlay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">m_puckMap</span><span class="p">[</span><span class="w"> </span><span class="nx">m_projectileName</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;shooter&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">m_puckMap</span><span class="p">[</span><span class="w"> </span><span class="nx">puck</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;monkey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">m_wallMap</span><span class="p">[</span><span class="w"> </span><span class="nx">wall</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;topWindow&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">m_monkeyInWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span>
<span class="w">         </span><span class="c1">// This one sounds like a monkey friend laughing at him being pushed outside. Delay a little so the alarmed sound can finish.</span>
<span class="w">         </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;monkeyOK&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="mf">300</span><span class="p">);</span>
<span class="w">         </span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_gameOverReported</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="nx">updateScore</span><span class="p">(</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">            </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">gameOver</span><span class="p">(</span><span class="s2">&quot;Ending on a high note!&quot;</span><span class="p">);</span>
<span class="w">               </span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">setFont</span><span class="p">(</span><span class="s1">&#39;35px Arial&#39;</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">                  </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;That&#39;s it... \\ \\[25px Arial]  some time outside...\\ \\[25px Arial]  probably a banana out there&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">                  </span>
<span class="w">               </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;Very satisfying... \\ \\[25px Arial]  free at last...&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">m_puckMap</span><span class="p">[</span><span class="w"> </span><span class="nx">puck</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;monkey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">m_wallMap</span><span class="p">[</span><span class="w"> </span><span class="nx">wall</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;floor&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">m_monkeyHitFloor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="p">)</span><span class="w"> </span><span class="nx">gameOver</span><span class="p">(</span><span class="s1">&#39;Not your best shot...&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// Check if puck hits the monkey before the monkey lands on the floor.</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">processHits</span><span class="p">(</span><span class="w"> </span><span class="nx">puck_A</span><span class="p">,</span><span class="w"> </span><span class="nx">puck_B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">puck_A</span><span class="p">.</span><span class="nx">bullet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">puck_bullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puck_A</span><span class="p">,</span><span class="w"> </span><span class="nx">puck_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puck_B</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">puck_bullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puck_B</span><span class="p">,</span><span class="w"> </span><span class="nx">puck_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puck_A</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">m_puckMap</span><span class="p">[</span><span class="w"> </span><span class="nx">m_projectileName</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;shooter&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">m_puckMap</span><span class="p">[</span><span class="w"> </span><span class="nx">puck_target</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;monkey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_monkeyHitFloor</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;monkeyAlarmed&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span>
<span class="w">         </span>
<span class="w">         </span><span class="c1">// Wait to see if the monkey has been pushed out the window. Don&#39;t comment on hitting the monkey if that (window transit) happens.</span>
<span class="w">         </span><span class="c1">// If game is over, send final shot comment.</span>
<span class="w">         </span><span class="nx">m_timeOutID_niceShot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_monkeyInWindow</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_gameOverReported</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span>
<span class="w">               </span><span class="c1">// Only give credit for hitting the monkey once per shot, and only if not a window transit.</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">updateScore</span><span class="p">(</span><span class="w"> </span><span class="mf">25</span><span class="p">);</span>
<span class="w">               </span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_shotIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">m_shotLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">gameOver</span><span class="p">(</span><span class="s1">&#39;That one landed.&#39;</span><span class="p">);</span>
<span class="w">                  </span>
<span class="w">               </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">setFont</span><span class="p">(</span><span class="s1">&#39;30px Arial&#39;</span><span class="p">);</span>
<span class="w">                  </span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;[35px Arial]            Good shot.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                                    </span><span class="s2">&quot;\\ \\[25px Arial]Even better if you escort the monkey out. &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                                    </span><span class="s2">&quot;\\ \\[25px Arial]             (through the window)&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;[35px Arial]      That one connected.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                                    </span><span class="s2">&quot;\\ \\[25px Arial]Better if you send the monkey packing. &quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;[35px Arial]               Nice one.&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                                    </span><span class="s2">&quot;\\ \\[25px Arial]100 points if you put him outside via the window. &quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;[30px Arial]            Well done.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">);</span>
<span class="w">                     </span>
<span class="w">                  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m_hitMessageIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;[30px Arial]            Good eye.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">);</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">                  </span>
<span class="w">                  </span><span class="nx">m_hitMessageIndex</span><span class="o">++</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span><span class="w">    </span>
<span class="w">               </span>
<span class="w">               </span><span class="nx">m_hitCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">m_timeOutID_niceShot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">         </span><span class="p">},</span><span class="w"> </span><span class="mf">700</span><span class="p">);</span>
<span class="w">         </span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">gameOver</span><span class="p">(</span><span class="w"> </span><span class="nx">shotComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">m_gameOverReported</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">setFont</span><span class="p">(</span><span class="s1">&#39;25px Arial&#39;</span><span class="p">);</span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="nx">shotCommentString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">shotComment</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">shotComment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;\\ \\&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">shotCommentString</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                            </span><span class="s2">&quot;Put another quarter in (the 4 key) to reset the scoring... &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                              </span><span class="s2">&quot;\\[20px Arial]                (a four-finger touch) &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                           </span><span class="s2">&quot;\\ \\[25px Arial]Or, you can keep shooting. &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                     </span><span class="s2">&quot;\\ \\ \\ \\[30px Arial]         Thanks for playing.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">);</span>
<span class="w">         </span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="nx">playTime_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">m_timeOfStart</span><span class="p">)</span><span class="o">/</span><span class="mf">1000</span><span class="p">;</span>
<span class="w">         </span><span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="c1">// If not using TwoThumbs, must set this before calling addScoreToSummary.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">touchScreenUsage</span><span class="p">)</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">virtualGamePadUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">client</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">))</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">addScoreToSummary</span><span class="p">(</span><span class="w"> </span><span class="nx">playTime_s</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">         </span><span class="p">});</span>
<span class="w">         </span><span class="nx">lB</span><span class="p">.</span><span class="nx">reportGameResults</span><span class="p">();</span>
<span class="w">         </span><span class="c1">// Send a score for each human player to the leader-board. Build leader-board report at the end.</span>
<span class="w">         </span><span class="nx">lB</span><span class="p">.</span><span class="nx">submitScoresThenReport</span><span class="p">();</span>
<span class="w">         </span><span class="c1">// Open up the multi-player panel so you can see the leader-board report.</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="nx">gW</span><span class="p">.</span><span class="nx">dC</span><span class="p">.</span><span class="nx">multiplayer</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chkMultiplayer&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">m_gameOverReported</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// see comments before the &quot;return&quot; section of gwModule.js</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Objects</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Variables</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Methods</span>
<span class="w">      </span><span class="s1">&#39;initializeModule&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">initializeModule</span><span class="p">,</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39;setPositions&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">setPositions</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;resetShotState&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">resetShotState</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;initializeGame&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">initializeGame</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;deleteMonkeyWalls&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">deleteMonkeyWalls</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;processWallCollisions&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">processWallCollisions</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;processHits&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">processHits</span>
<span class="w">   </span><span class="p">};</span>

<span class="p">})();</span>
</pre></div>
</body>
</html>
