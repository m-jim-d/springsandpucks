<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <http://pygments.org>
Copyright 2006-2019 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://triquence.org/leaderBoard.js.html' />
  <title>leaderBoard.js</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <http://pygments.org>
Copyright 2006-2019 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">Copyright 2022 James D. Miller</span>

<span class="cm">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="cm">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="cm">in the Software without restriction, including without limitation the rights</span>
<span class="cm">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="cm">copies of the Software, and to permit persons to whom the Software is</span>
<span class="cm">furnished to do so, subject to the following conditions:</span>

<span class="cm">The above copyright notice and this permission notice shall be included in all</span>
<span class="cm">copies or substantial portions of the Software.</span>

<span class="cm">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="cm">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm">SOFTWARE.</span>
<span class="cm">*/</span>

<span class="c1">// Leader Board (lB) module</span>
<span class="c1">// leaderBoard.js</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;lB _*-*_&#39;</span><span class="p">);</span>
<span class="c1">// 5:11 PM Wed July 20, 2022</span>

<span class="cm">/*</span>
<span class="cm">gwModule.js has an alphabetical list of all modules and their nicknames as added to the windows namespace.</span>
<span class="cm">*/</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">lB</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
   
   <span class="c1">// Names starting with m_ indicate module-scope globals.</span>
   <span class="kd">var</span> <span class="nx">m_leaderBoardIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   
   <span class="kd">var</span> <span class="nx">m_timeTipPool</span> <span class="o">=</span> <span class="s1">&#39;time (seconds) to finish the pool game&#39;</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">m_scoreTip</span> <span class="o">=</span> <span class="s1">&#39;+200: win,\n+100: pop client or drone \n+50: pop regular puck \n+10: hit a puck with your bullet \n-10: get hit by somebody else&amp;#39;s bullet \n-1: bad shot&#39;</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">m_scoreTipPool_9ball</span>    <span class="o">=</span> <span class="s1">&#39;+50: win \n+15: pocket a ball \n-5: take a shot \n-10: object ball not low ball \n-20: scratch the cue ball&#39;</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">m_scoreTipPool_rotation</span> <span class="o">=</span> <span class="s1">&#39;+50: win \n+15: pocket a ball \n-5: take a shot \n-10: object ball not low ball \n-20: scratch the cue ball&#39;</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">m_scoreTipPool_8ball</span>    <span class="o">=</span> <span class="s1">&#39;+50: win \n+15: pocket a ball \n-5: take a shot \n-10: object ball not in group \n-20: scratch the cue ball&#39;</span><span class="p">;</span>
   
   <span class="c1">// module globals for objects brought in by initializeModule</span>
   <span class="c1">// (none)</span>
   
   <span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
   
   <span class="kd">function</span> <span class="nx">initializeModule</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// nothing yet...</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">leaderBoardReport</span><span class="p">(</span> <span class="nx">lbResp</span><span class="p">,</span> <span class="nx">gameVersion</span><span class="p">,</span> <span class="nx">outputMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">m_leaderBoardIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">scoreCell_id</span> <span class="o">=</span> <span class="s1">&#39;scoresCell&#39;</span> <span class="o">+</span> <span class="nx">m_leaderBoardIndex</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">timeCell_id</span> <span class="o">=</span> <span class="s1">&#39;timesCell&#39;</span> <span class="o">+</span> <span class="nx">m_leaderBoardIndex</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">scoreOrTime_id</span> <span class="o">=</span> <span class="s1">&#39;scoreOrTime&#39;</span> <span class="o">+</span> <span class="nx">m_leaderBoardIndex</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">leaderBoardReportHTML</span><span class="p">,</span> <span class="nx">rankString</span><span class="p">;</span>
      
      <span class="c1">// Simplify the reporting for Jello Madness because there is only the time-based result (no scoring result).</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">dS</span><span class="p">.</span><span class="nx">demoVersionIndex</span><span class="p">(</span> <span class="nx">gameVersion</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">outputMode</span> <span class="o">!=</span> <span class="s2">&quot;reportOnly&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rankString</span> <span class="o">=</span> <span class="s2">&quot;On a time basis, &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userName</span> <span class="o">+</span> <span class="s2">&quot; placed &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">userRank</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">scoreCount</span> <span class="o">+</span> 
                                <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">winTime</span> <span class="o">+</span> <span class="s2">&quot; seconds.&lt;/br&gt;&lt;br class=&#39;score&#39;&gt;&lt;/br&gt;&quot;</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">rankString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="nx">leaderBoardReportHTML</span> <span class="o">=</span> <span class="s2">&quot;Leader Board Report: &quot;</span> <span class="o">+</span> <span class="nx">gameVersion</span> <span class="o">+</span> <span class="s2">&quot;&lt;/br&gt;&lt;br class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">rankString</span><span class="p">;</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">outputMode</span> <span class="o">!=</span> <span class="s2">&quot;reportOnly&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">lbResp</span><span class="p">.</span><span class="nx">userRank</span> <span class="o">!=</span> <span class="s1">&#39;mouse or npcSleep usage&#39;</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">rankString</span> <span class="o">=</span> <span class="s2">&quot;Highest human scorer, &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userName</span> <span class="o">+</span> <span class="s1">&#39;, placed &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userRank</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">scoreCount</span> <span class="o">+</span> <span class="s1">&#39; with a score of &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userScore</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">winTime</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">rankString</span> <span class="o">+=</span> <span class="s2">&quot;On a time basis, placed &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">userRank</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">scoreCount</span> <span class="o">+</span> 
                                <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">.</span><span class="nx">winTime</span> <span class="o">+</span> <span class="s2">&quot; seconds.&lt;/br&gt;&quot;</span><span class="p">;</span>
               <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">rankString</span> <span class="o">=</span> <span class="s2">&quot;Highest human scorer, &quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userName</span> <span class="o">+</span> <span class="s1">&#39;, scored &#39;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">userScore</span> <span class="o">+</span> <span class="s2">&quot; (mouse or npc-sleep used).&lt;/br&gt;&quot;</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
            <span class="nx">rankString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
         
         <span class="nx">rankString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br class=&#39;score&#39;&gt;&quot;</span><span class="p">;</span>
         <span class="c1">// Build the toggle link that swaps the time-sorted and score-sorted tables.</span>
         <span class="c1">// (Note the use of the escape \ to get three levels of quotations in the following string.) </span>
         <span class="kd">let</span> <span class="nx">scoreOrTime_string</span> <span class="o">=</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()))</span> <span class="o">?</span> <span class="s1">&#39;time&#39;</span><span class="o">:</span><span class="s1">&#39;score&#39;</span><span class="p">;</span>
         <span class="nx">leaderBoardReportHTML</span> <span class="o">=</span> <span class="s2">&quot;Leader Board Report: &quot;</span> <span class="o">+</span> <span class="nx">gameVersion</span> <span class="o">+</span> <span class="s2">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;&lt;a title = &#39;toggle between low-time and high-score based queries&#39; &quot;</span> <span class="o">+</span> 
                 <span class="s2">&quot;onclick=\&quot;uT.toggleElementDisplay(&#39;&quot;</span> <span class="o">+</span> <span class="nx">timeCell_id</span> <span class="o">+</span>  <span class="s2">&quot;&#39;,&#39;block&#39;); &quot;</span> <span class="o">+</span> 
                           <span class="s2">&quot;uT.toggleElementDisplay(&#39;&quot;</span> <span class="o">+</span> <span class="nx">scoreCell_id</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;block&#39;); &quot;</span> <span class="o">+</span>
                           <span class="s2">&quot;uT.toggleSpanValue(&#39;&quot;</span> <span class="o">+</span> <span class="nx">scoreOrTime_id</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;time&#39;,&#39;score&#39;);\&quot;&gt;&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;&lt;span id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">scoreOrTime_id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">scoreOrTime_string</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt;&lt;/a&gt;)&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;&lt;/br&gt;&lt;br class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">rankString</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c1">// Add the tables</span>
      <span class="kd">let</span> <span class="nx">scoreTable</span> <span class="o">=</span> <span class="nx">leaderBoardTable</span><span class="p">(</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span>   <span class="nx">lbResp</span><span class="p">,</span>                   <span class="nx">gameVersion</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">timeTable</span>  <span class="o">=</span> <span class="nx">leaderBoardTable</span><span class="p">(</span> <span class="s2">&quot;winTime&quot;</span><span class="p">,</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">timeSortedResults</span><span class="p">,</span> <span class="nx">gameVersion</span><span class="p">);</span>
      
      <span class="c1">// For ghost-ball pool and the projectile games, make the score-sorted table the default.</span>
      <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()))</span> <span class="p">{</span>
         <span class="nx">leaderBoardReportHTML</span> <span class="o">+=</span> 
            <span class="s2">&quot;&lt;table&gt;&lt;tr&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">scoreCell_id</span> <span class="o">+</span> <span class="s2">&quot;&#39; style=&#39;vertical-align:text-top; display:block&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">scoreTable</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">timeCell_id</span> <span class="o">+</span>  <span class="s2">&quot;&#39; style=&#39;display:none&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">timeTable</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;/tr&gt;&lt;/table&gt;&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">leaderBoardReportHTML</span> <span class="o">+=</span> 
            <span class="s2">&quot;&lt;table&gt;&lt;tr&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">scoreCell_id</span> <span class="o">+</span> <span class="s2">&quot;&#39; style=&#39;display:none&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">scoreTable</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">timeCell_id</span> <span class="o">+</span>  <span class="s2">&quot;&#39; style=&#39;vertical-align:text-top; display:block&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">timeTable</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;/tr&gt;&lt;/table&gt;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c1">// Find the most recent game report element (in the chat panel).</span>
      <span class="kd">let</span> <span class="nx">gameReportElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;gR&quot;</span> <span class="o">+</span> <span class="nx">hC</span><span class="p">.</span><span class="nx">gb</span><span class="p">.</span><span class="nx">gameReportCounter</span><span class="p">);</span>
      <span class="c1">// Append the leader-board report to the game report.</span>
      <span class="nx">gameReportElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">gameReportElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span> <span class="o">+</span> <span class="nx">leaderBoardReportHTML</span><span class="p">;</span>
      
      <span class="c1">// Send this, the combo of the game summary and leader-board report, to everyone else in the </span>
      <span class="c1">// room so they can see it in their chat panel.</span>
      <span class="nx">hC</span><span class="p">.</span><span class="nx">chatToNonHostPlayers</span><span class="p">(</span> <span class="nx">gameReportElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">checkIfInGameTable</span><span class="p">(</span> <span class="nx">userName</span><span class="p">,</span> <span class="nx">winTime</span><span class="p">,</span> <span class="nx">userScore</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// This compares one row from the leaderboard report to each row in the game table.</span>
      <span class="kd">var</span> <span class="nx">inTable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">scoreRecord</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">((</span><span class="nx">scoreRecord</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">userName</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">scoreRecord</span><span class="p">[</span><span class="s1">&#39;winner&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">winTime</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">scoreRecord</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">userScore</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">scoreRecord</span><span class="p">[</span><span class="s1">&#39;randomIndex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">inTable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
         <span class="p">}</span> 
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">inTable</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">scoreTipPool</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;8ball&#39;</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">m_scoreTipPool_8ball</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;9ball&#39;</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">m_scoreTipPool_9ball</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;rotation&#39;</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">m_scoreTipPool_rotation</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">leaderBoardTable</span><span class="p">(</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">lbResp</span><span class="p">,</span> <span class="nx">gameVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">rowIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      
      <span class="c1">// If no records in the report, return with this simple warning.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lbResp</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;(no &quot;</span> <span class="o">+</span> <span class="nx">mode</span> <span class="o">+</span> <span class="s2">&quot; records)&quot;</span><span class="p">;</span>
      
      <span class="kd">var</span> <span class="nx">colHighLightStyle</span> <span class="o">=</span> <span class="s2">&quot;style=&#39;background-color:#ffffef;&#39;&quot;</span><span class="p">;</span> <span class="c1">// #FFFFFF #e2e2b7 #f7f7d7 #f9f9e5 #ffffef</span>
      <span class="kd">var</span> <span class="nx">rowHighLightStyle</span> <span class="o">=</span> <span class="s2">&quot;style=&#39;background-color:darkgray; color:white&#39;&quot;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">style_score</span> <span class="o">=</span> <span class="nx">colHighLightStyle</span><span class="p">;</span>
         <span class="kd">var</span> <span class="nx">style_winTime</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
         <span class="kd">var</span> <span class="nx">tableClass</span> <span class="o">=</span> <span class="s2">&quot;score&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">style_winTime</span> <span class="o">=</span> <span class="nx">colHighLightStyle</span><span class="p">;</span>
         <span class="kd">var</span> <span class="nx">style_score</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
         <span class="kd">var</span> <span class="nx">tableClass</span> <span class="o">=</span> <span class="s2">&quot;score&quot;</span><span class="p">;</span>
      <span class="p">}</span>
            
      <span class="c1">// Ghost-ball pool and projectile games</span>
      <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()))</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">tableString</span> <span class="o">=</span> <span class="s2">&quot;&lt;table class=&#39;&quot;</span> <span class="o">+</span> <span class="nx">tableClass</span> <span class="o">+</span> <span class="s2">&quot;&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39;&gt;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">m_timeTipPool</span><span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime</span><span class="o">+</span> <span class="s2">&quot;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">scoreTipPool</span><span class="p">()</span><span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span><span class="nx">style_score</span><span class="o">+</span> <span class="s2">&quot;&gt;score&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;monitor frames per second&#39;&gt;fps&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;inverse of the physics timestep&#39;&gt;ipt&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;virtual gamepad was used during game&#39;&gt;vgp&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
      <span class="c1">// Jello Madness      </span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">tableString</span> <span class="o">=</span> <span class="s2">&quot;&lt;table class=&#39;&quot;</span> <span class="o">+</span> <span class="nx">tableClass</span> <span class="o">+</span> <span class="s2">&quot;&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39;&gt;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;time (seconds) to untangle the jello (separate the pucks)&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime</span><span class="o">+</span> <span class="s2">&quot;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;human players&#39;&gt;p&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;monitor frames per second&#39;&gt;fps&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;inverse of the physics timestep&#39;&gt;ipt&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
      <span class="c1">// Puck Popper      </span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">tableString</span> <span class="o">=</span> <span class="s2">&quot;&lt;table class=&#39;&quot;</span> <span class="o">+</span> <span class="nx">tableClass</span> <span class="o">+</span> <span class="s2">&quot;&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39;&gt;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;time (seconds) to win game (last puck standing)&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime</span><span class="o">+</span> <span class="s2">&quot;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">m_scoreTip</span><span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span><span class="nx">style_score</span><span class="o">+</span> <span class="s2">&quot;&gt;score&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;human players&#39;&gt;p&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;drones&#39;&gt;d&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;monitor frames per second&#39;&gt;fps&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;inverse of the physics timestep&#39;&gt;ipt&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;virtual gamepad was used during game&#39;&gt;vgp&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;leaderboardHeader&#39; title=&#39;friendly fire was prevented during game&#39;&gt;nff&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Highlight each row in the leader-board report that matches any row in the game result report.</span>
         <span class="k">if</span> <span class="p">(</span> <span class="nx">checkIfInGameTable</span><span class="p">(</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;userName&#39;</span><span class="p">],</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winTime&#39;</span><span class="p">],</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rowStyle</span> <span class="o">=</span> <span class="nx">rowHighLightStyle</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">style_score_td</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">style_winTime_td</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rowStyle</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">style_score_td</span> <span class="o">=</span> <span class="nx">style_score</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">style_winTime_td</span> <span class="o">=</span> <span class="nx">style_winTime</span><span class="p">;</span>
         <span class="p">}</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winTime&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span> <span class="p">{</span>
               <span class="kd">var</span> <span class="nx">timeResult</span> <span class="o">=</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winTime&#39;</span><span class="p">].</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="kd">var</span> <span class="nx">timeResult</span> <span class="o">=</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winTime&#39;</span><span class="p">].</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">timeResult</span> <span class="o">=</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winTime&#39;</span><span class="p">];</span>
         <span class="p">}</span>
         
         <span class="c1">// Ghost-ball pool and projectile games</span>
         <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()))</span> <span class="p">{</span>
            <span class="nx">tableString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39; &quot;</span> <span class="o">+</span> <span class="nx">rowStyle</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> 
               <span class="s2">&quot;&lt;td class=&#39;leaderboardIndex&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">rowIndex</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardName&#39;                        &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;userName&#39;</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;(host)&#39;</span><span class="p">,</span><span class="s1">&#39;(h)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime_td</span><span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">timeResult</span> <span class="o">+</span>                                <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39; &quot;</span> <span class="o">+</span><span class="nx">style_score_td</span><span class="o">+</span>   <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">+</span>                            <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;frMonitor&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;hzPhysics&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;virtualGamePad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="c1">// Jello Madness</span>
         <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">tableString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39; &quot;</span> <span class="o">+</span> <span class="nx">rowStyle</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> 
               <span class="s2">&quot;&lt;td class=&#39;leaderboardIndex&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">rowIndex</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardName&#39;                        &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;userName&#39;</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;(host)&#39;</span><span class="p">,</span><span class="s1">&#39;(h)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime_td</span><span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">timeResult</span> <span class="o">+</span>                                <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;nPeople&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;frMonitor&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;hzPhysics&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="c1">// Puck Popper</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">tableString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39; &quot;</span> <span class="o">+</span> <span class="nx">rowStyle</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> 
               <span class="s2">&quot;&lt;td class=&#39;leaderboardIndex&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">rowIndex</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardName&#39;                        &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;userName&#39;</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;(host)&#39;</span><span class="p">,</span><span class="s1">&#39;(h)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39; &quot;</span> <span class="o">+</span><span class="nx">style_winTime_td</span><span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">timeResult</span> <span class="o">+</span>                                <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39; &quot;</span> <span class="o">+</span><span class="nx">style_score_td</span><span class="o">+</span>   <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">+</span>                            <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;nPeople&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;nDrones&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;frMonitor&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;hzPhysics&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;virtualGamePad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;td class=&#39;leaderboardScore&#39;                       &gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;noFriendlyFire&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="nx">rowIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">tableString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">tableString</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">sendScoreToSpreadSheet</span><span class="p">(</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">nR</span><span class="p">,</span> <span class="nx">peopleClients</span><span class="p">,</span> <span class="nx">gameVersion</span><span class="p">,</span> <span class="nx">n_people</span><span class="p">,</span> <span class="nx">n_drones</span><span class="p">,</span> <span class="nx">frameRate_monitor</span><span class="p">,</span> <span class="nx">frameRate_physics</span><span class="p">,</span> <span class="nx">noFriendlyFire</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">userName</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">n_soloAndTeam</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">userScore</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;winner&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">mouse</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;mouse&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">npcSleep</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;npcSleep&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">virtualGamePad</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;virtualGamePad&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">[</span> <span class="nx">nR</span><span class="p">][</span><span class="s1">&#39;randomIndex&#39;</span><span class="p">];</span>
      
      <span class="kd">let</span> <span class="nx">outputMode</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s2">&quot;reportOnly&quot;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;report&quot;</span><span class="p">;</span>
         <span class="nx">userName</span> <span class="o">=</span> <span class="s2">&quot;reportOnly&quot;</span><span class="p">;</span>
         <span class="nx">outputMode</span> <span class="o">=</span> <span class="s2">&quot;reportOnly&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">outputMode</span> <span class="o">=</span> <span class="nx">mode</span><span class="p">;</span>
      <span class="p">}</span>
                                       
      <span class="c1">// The &quot;Deployment ID&quot; in this URL is found via the &quot;Tools/Script editor/Select a project...&quot; interface for the spreadsheet. Pick &quot;Manage deployments&quot; from the &quot;Deploy&quot; select element, upper right.</span>
      <span class="c1">// The &quot;Deployment ID&quot; does not give general access to the account. It only allows the web user to submit parameters to the doGet function in the spreadsheet project&#39;s script.</span>
      <span class="kd">var</span> <span class="nx">sheetURL</span> <span class="o">=</span> <span class="s1">&#39;https://script.google.com/macros/s/AKfycbw-MubGpT943K31y6df19zwraGf0GBMuKk9TlOd3yImYO5BSbDxeWTysuYqye0d4mQ_og/exec&#39;</span><span class="p">;</span>
      <span class="c1">// AJAX</span>
      <span class="kd">var</span> <span class="nx">xhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
      <span class="nx">xhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">sheetURL</span> <span class="o">+</span> <span class="s1">&#39;?mode=&#39;</span> <span class="o">+</span> <span class="nx">mode</span> <span class="o">+</span> 
                                   <span class="s1">&#39;&amp;userName=&#39;</span> <span class="o">+</span> <span class="nx">userName</span> <span class="o">+</span> <span class="s1">&#39;&amp;score=&#39;</span> <span class="o">+</span> <span class="nx">userScore</span> <span class="o">+</span>  <span class="s1">&#39;&amp;gameVersion=&#39;</span> <span class="o">+</span> <span class="nx">gameVersion</span> <span class="o">+</span> 
                                   <span class="s1">&#39;&amp;winTime=&#39;</span> <span class="o">+</span> <span class="nx">winner</span> <span class="o">+</span>    <span class="s1">&#39;&amp;mouse=&#39;</span> <span class="o">+</span> <span class="nx">mouse</span> <span class="o">+</span>      <span class="s1">&#39;&amp;npcSleep=&#39;</span> <span class="o">+</span> <span class="nx">npcSleep</span> <span class="o">+</span>
                                   <span class="s1">&#39;&amp;nPeople=&#39;</span> <span class="o">+</span> <span class="nx">n_people</span> <span class="o">+</span>  <span class="s1">&#39;&amp;nDrones=&#39;</span> <span class="o">+</span> <span class="nx">n_drones</span> <span class="o">+</span> <span class="s1">&#39;&amp;frMonitor=&#39;</span> <span class="o">+</span> <span class="nx">frameRate_monitor</span> <span class="o">+</span> <span class="s1">&#39;&amp;hzPhysics=&#39;</span> <span class="o">+</span> <span class="nx">frameRate_physics</span> <span class="o">+</span> 
                                   <span class="s1">&#39;&amp;virtualGamePad=&#39;</span> <span class="o">+</span> <span class="nx">virtualGamePad</span> <span class="o">+</span> <span class="s1">&#39;&amp;noFriendlyFire=&#39;</span> <span class="o">+</span> <span class="nx">noFriendlyFire</span> <span class="o">+</span> <span class="s1">&#39;&amp;index=&#39;</span> <span class="o">+</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">xhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
      <span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="c1">// If there is a response from the spreadsheet:</span>
         <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// lbResp is short for leaderBoardResponse</span>
            <span class="kd">var</span> <span class="nx">lbResp</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">lbResp</span><span class="p">.</span><span class="nx">result</span> <span class="o">==</span> <span class="s1">&#39;report&#39;</span><span class="p">)</span> <span class="p">{</span>
               <span class="cm">/*</span>
<span class="cm">               // useful for testing:</span>
<span class="cm">               console.log(&#39;You, &#39; + lbResp.userID + &#39;, placed &#39; + lbResp.userRank + &#39; of &#39; + lbResp.scoreCount + &#39; with a score of &#39; + lbResp.userScore);</span>
<span class="cm">               for (var i = 0; i &lt; lbResp.users.length; i++) {</span>
<span class="cm">                  // Convert the date so can display it.</span>
<span class="cm">                  var recordDate = new Date(lbResp.users[i].date);</span>
<span class="cm">                  var recordDateString = recordDate.getDate() +&#39;/&#39;+ (recordDate.getMonth() + 1) +&#39;/&#39;+ recordDate.getFullYear() +&#39; &#39;+ recordDate.getHours() +&#39;:&#39;+ recordDate.getMinutes();         </span>
<span class="cm">                  console.log(recordDateString + &#39;, &#39; + lbResp.users[i].id + &#39;, &#39; + lbResp.users[i].score);</span>
<span class="cm">               } </span>
<span class="cm">               */</span>
               
               <span class="c1">// Assemble the html needed to display the leaderboard query results in the chat panel.</span>
               <span class="nx">leaderBoardReport</span><span class="p">(</span> <span class="nx">lbResp</span><span class="p">,</span> <span class="nx">gameVersion</span><span class="p">,</span> <span class="nx">outputMode</span><span class="p">);</span>
               <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;leaderboard app:&quot;</span> <span class="o">+</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">version</span><span class="p">);</span>
               
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">lbResp</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">lbResp</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Keep (recursively) sending data until the last score (highest). Ask for a report in that last send.</span>
            <span class="kd">let</span> <span class="nx">reportMode</span> <span class="o">=</span> <span class="s1">&#39;noReport&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">nR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">n_soloAndTeam</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// 0 is first row. n_soloAndTeam-1 is last row.</span>
               <span class="nx">nR</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
               <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;rC=&#39;</span><span class="o">+</span><span class="nx">nR</span><span class="p">);</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">nR</span> <span class="o">==</span> <span class="nx">n_soloAndTeam</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">reportMode</span> <span class="o">=</span> <span class="s1">&#39;report&#39;</span><span class="p">;</span> <span class="c1">// Do a final submission, and ask for a report from the spreadsheet.</span>
               <span class="nx">sendScoreToSpreadSheet</span><span class="p">(</span> <span class="nx">reportMode</span><span class="p">,</span> <span class="nx">nR</span><span class="p">,</span> <span class="nx">peopleClients</span><span class="p">,</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">(),</span> <span class="nx">n_people</span><span class="p">,</span> <span class="nx">n_drones</span><span class="p">,</span> <span class="nx">frameRate_monitor</span><span class="p">,</span> <span class="nx">frameRate_physics</span><span class="p">,</span> <span class="nx">noFriendlyFire</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">submitScoresThenReport</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">nR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">peopleClients</span> <span class="o">=</span> <span class="p">[];</span>
      
      <span class="c1">// Ascending sort (this way the report gets issued on the highest score, last one.)</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nx">b</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]);</span>
      
      <span class="c1">// Make a subset of the scores to only include real people.</span>
      <span class="kd">let</span> <span class="nx">n_people</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">n_drones</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Filter out the NPC pucks here. And, only report solo and team scores, not team-member scores.</span>
         <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">oneOfThese</span><span class="p">([</span><span class="s2">&quot;NPC&quot;</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">],</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">peopleClients</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">score</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">score</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;NPC&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">n_drones</span><span class="o">++</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">score</span><span class="p">[</span><span class="s1">&#39;rawName&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;team&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">n_people</span><span class="o">++</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
      <span class="kd">let</span> <span class="nx">n_soloAndTeam</span> <span class="o">=</span> <span class="nx">peopleClients</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      
      <span class="kd">let</span> <span class="nx">frameRate_monitor</span> <span class="o">=</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">dC</span><span class="p">.</span><span class="nx">fps</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span> <span class="c1">//current observed refresh rate of the monitor</span>
      <span class="kd">let</span> <span class="nx">frameRate_physics</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#FrameRate&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="c1">//timestep for engine</span>
      <span class="kd">let</span> <span class="nx">noFriendlyFire</span> <span class="o">=</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">dC</span><span class="p">.</span><span class="nx">friendlyFire</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span><span class="o">:</span><span class="s1">&#39;x&#39;</span><span class="p">;</span> 
      
      <span class="c1">// Recursively send the scores. If only one player, go right to &#39;report&#39; mode.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n_soloAndTeam</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">let</span> <span class="nx">reportMode</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n_soloAndTeam</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;report&#39;</span><span class="o">:</span><span class="s1">&#39;noReport&#39;</span><span class="p">;</span> 
         <span class="nx">sendScoreToSpreadSheet</span><span class="p">(</span> <span class="nx">reportMode</span><span class="p">,</span> <span class="nx">nR</span><span class="p">,</span> <span class="nx">peopleClients</span><span class="p">,</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">(),</span> <span class="nx">n_people</span><span class="p">,</span> <span class="nx">n_drones</span><span class="p">,</span> <span class="nx">frameRate_monitor</span><span class="p">,</span> <span class="nx">frameRate_physics</span><span class="p">,</span> <span class="nx">noFriendlyFire</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">requestReportOnly</span><span class="p">(</span> <span class="nx">gameName</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">hC</span><span class="p">.</span><span class="nx">displayMessage</span><span class="p">(</span><span class="s2">&quot;Game Summary (do not display)&quot;</span><span class="p">);</span>
      
      <span class="kd">let</span> <span class="nx">peopleClients</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">peopleClients</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rawName&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;nickName&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;virtualGamePad&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;winner&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;npcSleep&#39;</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;randomIndex&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">);</span>                       
      
      <span class="nx">sendScoreToSpreadSheet</span><span class="p">(</span><span class="s1">&#39;reportOnly&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">peopleClients</span><span class="p">,</span> <span class="nx">gameName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">reportGameResults</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">gameName</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">demoBase</span> <span class="o">=</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">demoIndex</span> <span class="o">=</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">([</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoIndex</span><span class="p">))</span> <span class="p">{</span>
         <span class="nx">gameName</span> <span class="o">=</span> <span class="s1">&#39;Puck Popper&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="s1">&#39;6.a&#39;</span><span class="p">,</span><span class="s1">&#39;6.d&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoBase</span><span class="p">))</span> <span class="p">{</span>
         <span class="nx">gameName</span> <span class="o">=</span> <span class="s1">&#39;Jello Madness&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoBase</span> <span class="o">==</span> <span class="s1">&#39;3.d&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">gameName</span> <span class="o">=</span> <span class="s1">&#39;Ghostball Pool&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoBase</span> <span class="o">==</span> <span class="s1">&#39;5.e&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">gameName</span> <span class="o">=</span> <span class="s1">&#39;Bipartisan Hoops&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoBase</span> <span class="o">==</span> <span class="s1">&#39;4.e&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">gameName</span> <span class="o">=</span> <span class="s1">&#39;Monkey Hunt&#39;</span><span class="p">;</span>
      <span class="p">}</span> 
      
      <span class="c1">// Delete the old help link in leaderboard (in the prior report) before making one in the current report.</span>
      <span class="nx">$</span><span class="p">(</span> <span class="s2">&quot;.helpLinkFromLB&quot;</span> <span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">firstLine</span> <span class="o">=</span> <span class="s2">&quot;Game Summary: &lt;span style=&#39;color:brown&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">gameName</span> <span class="o">+</span> <span class="s2">&quot;&lt;/span&gt; (&quot;</span> <span class="o">+</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;&lt;span class=&#39;helpLinkFromLB&#39; style=&#39;float:right&#39;&gt;(&lt;a title=&#39;click or use the m key to toggle between help and leaderboard&#39;&quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;onclick= \&quot; $(&#39;#chkMultiplayer&#39;).trigger(&#39;click&#39;); \&quot; &gt;help&lt;/a&gt;)&lt;/span&gt; &lt;/br&gt;&lt;br class=&#39;score&#39;&gt;&quot;</span><span class="p">;</span>
      
      <span class="c1">// Jello Madness</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">summaryString</span> <span class="o">=</span> <span class="nx">firstLine</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;table class=&#39;score&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;time (seconds) to untangle the jello (separate the pucks)&#39;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">summaryString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>     <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winner&#39;</span><span class="p">]</span>   <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="c1">// Ghost Pool and projectile games</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">()))</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">summaryString</span> <span class="o">=</span> <span class="nx">firstLine</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;table class=&#39;score&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">m_timeTipPool</span><span class="o">+</span> <span class="s2">&quot;&#39;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">scoreTipPool</span><span class="p">()</span><span class="o">+</span> <span class="s2">&quot;&#39;&gt;score&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;virtual gamepad used during game&#39;&gt;vgp&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">summaryString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>     <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winner&#39;</span><span class="p">]</span>   <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>    <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;virtualGamePad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="c1">// Puck Popper</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">b</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nx">a</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]);</span>
         <span class="kd">var</span> <span class="nx">summaryString</span> <span class="o">=</span> <span class="nx">firstLine</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;table class=&#39;score&#39;&gt;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;client name \n or \nnickname (client name)&#39;&gt;name&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;time (seconds) to win game (last puck standing)&#39;&gt;time&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;&quot;</span> <span class="o">+</span><span class="nx">m_scoreTip</span><span class="o">+</span> <span class="s2">&quot;&#39;&gt;score&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;mouse usage in the canvas area&#39;&gt;m&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;NPCs have been sleeping (ctrl-q)&#39;&gt;s&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;scoreHeader&#39; title=&#39;virtual gamepad used during game&#39;&gt;vgp&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="c1">// Check for any mouse usage by the players as you write out the rows.</span>
         <span class="kd">var</span> <span class="nx">someMouseFunnyBz</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">score</span><span class="p">[</span><span class="s1">&#39;mouse&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="nx">someMouseFunnyBz</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">summaryString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr align=&#39;right&#39;&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>     <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;winner&#39;</span><span class="p">]</span>   <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>    <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;mouse&#39;</span><span class="p">]</span>    <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;npcSleep&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;td class=&#39;score&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;virtualGamePad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="c1">// Now report the sorted score summary (pass in function to give descending numeric sort)</span>
      <span class="nx">summaryString</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span>
      <span class="nx">hC</span><span class="p">.</span><span class="nx">displayMessage</span><span class="p">(</span> <span class="nx">summaryString</span><span class="p">);</span>
      
      <span class="c1">// If any of the players or the host (without a puck player) used the mouse, mark everyone </span>
      <span class="c1">// as suspect before doing the submission to the leaderboard. This appropriately blocks the case where the host</span>
      <span class="c1">// turns off his player and uses his mouse to delete the drones and lets one network player win.</span>
      <span class="c1">// That&#39;s clever, but that&#39;s not allowed.</span>
      <span class="c1">// (Notice the word &quot;of&quot; here. This type of for-of loop works nicely on arrays, and presents the item, not simply the index.)</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">score</span> <span class="k">of</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">scoreSummary</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// For Jello Madness, Ghost-ball pool and the projectile games, don&#39;t check for mouse usage. Mouse is always used.</span>
         <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoIndex</span><span class="p">())</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;mouse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">someMouseFunnyBz</span> <span class="o">||</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">mouseUsage</span><span class="p">)</span> <span class="nx">score</span><span class="p">[</span><span class="s1">&#39;mouse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="c1">// see comments before the &quot;return&quot; section of gwModule.js</span>
   <span class="k">return</span> <span class="p">{</span>
      <span class="c1">// Objects</span>
      
      <span class="c1">// Variables</span>
      
      <span class="c1">// Methods</span>
      <span class="s1">&#39;reportGameResults&#39;</span><span class="o">:</span> <span class="nx">reportGameResults</span><span class="p">,</span>
      <span class="s1">&#39;submitScoresThenReport&#39;</span><span class="o">:</span> <span class="nx">submitScoresThenReport</span><span class="p">,</span>
      <span class="s1">&#39;requestReportOnly&#39;</span><span class="o">:</span><span class="nx">requestReportOnly</span>
   <span class="p">};</span>

<span class="p">})();</span>
</pre></div>
</body>
</html>
