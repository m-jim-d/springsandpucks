<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <http://pygments.org>
Copyright 2006-2019 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://triquence.org/demoStart.js.html' />
  <title>demoStart.js</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <http://pygments.org>
Copyright 2006-2019 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">Copyright 2022 James D. Miller</span>

<span class="cm">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="cm">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="cm">in the Software without restriction, including without limitation the rights</span>
<span class="cm">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="cm">copies of the Software, and to permit persons to whom the Software is</span>
<span class="cm">furnished to do so, subject to the following conditions:</span>

<span class="cm">The above copyright notice and this permission notice shall be included in all</span>
<span class="cm">copies or substantial portions of the Software.</span>

<span class="cm">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="cm">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm">SOFTWARE.</span>
<span class="cm">*/</span>

<span class="c1">// Demo Starter (dS) module</span>
<span class="c1">// demoStart.js </span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dS _*-*_&#39;</span><span class="p">);</span>
<span class="c1">// 10:03 PM Fri December 8, 2023</span>

<span class="cm">/*</span>
<span class="cm">gwModule.js has an alphabetical list of all modules and their nicknames as added to the windows namespace.</span>
<span class="cm">*/</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">dS</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
   
   <span class="c1">// Module globals for objects brought in by initializeModule and initializeEventListeners.</span>
   <span class="kd">var</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">dC</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">aT</span><span class="p">,</span> <span class="nx">keyMap</span><span class="p">,</span> <span class="nx">clients</span><span class="p">;</span>
   
   <span class="c1">// Two functions in this module are used by the client page: fullScreenState and adjustSizeOfChatDiv. </span>
   <span class="c1">// The client does not call initializeModule (importing name space from the host) so dC and c are initialized here.</span>
   <span class="kd">var</span> <span class="nx">m_hostOrClient</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">m_hostOrClient</span> <span class="o">=</span> <span class="s2">&quot;client&quot;</span><span class="p">;</span>
      
      <span class="nx">dC</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenState</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">m_hostOrClient</span> <span class="o">=</span> <span class="s2">&quot;host&quot;</span><span class="p">;</span>
   <span class="p">}</span>
    
   <span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
   
   <span class="kd">function</span> <span class="nx">initializeModule</span><span class="p">(</span> <span class="nx">gW_canvas</span><span class="p">,</span> <span class="nx">gW_ctx</span><span class="p">,</span> <span class="nx">gW_dC</span><span class="p">,</span> <span class="nx">gW_c</span><span class="p">,</span> <span class="nx">gW_aT</span><span class="p">,</span> <span class="nx">gW_keyMap</span><span class="p">,</span> <span class="nx">gW_clients</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// the client page doesn&#39;t use this initialization (see note above)</span>
      <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">gW_canvas</span><span class="p">;</span>
      <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">gW_ctx</span><span class="p">;</span>
      
      <span class="nx">dC</span> <span class="o">=</span> <span class="nx">gW_dC</span><span class="p">;</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="nx">gW_c</span><span class="p">;</span>
      <span class="nx">aT</span> <span class="o">=</span> <span class="nx">gW_aT</span><span class="p">;</span>     
      <span class="nx">keyMap</span> <span class="o">=</span> <span class="nx">gW_keyMap</span><span class="p">;</span>
      <span class="nx">clients</span> <span class="o">=</span> <span class="nx">gW_clients</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="c1">// Functions in support of the demos ////////////////////////////////////////</span>
   
   <span class="kd">function</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">demoVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">demoVersion</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">demoVersionIndex</span><span class="p">(</span> <span class="nx">demoVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">demoVersion</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
   <span class="p">}</span>
   
   <span class="cm">/*</span>
<span class="cm">   // Editor help toggle</span>
<span class="cm">   function openDemoHelp() {</span>
<span class="cm">      // Not using this anymore. A bit confusing. Might bring it back.</span>
<span class="cm">      if (dC.multiplayer.checked) {</span>
<span class="cm">         $(&#39;#chkMultiplayer&#39;).trigger(&#39;click&#39;);</span>
<span class="cm">      }</span>
<span class="cm">      uT.toggleElementDisplay(&#39;outline1&#39;,&#39;block&#39;);</span>
<span class="cm">      uT.toggleSpanValue(&#39;moreOrLess&#39;,&#39;More&#39;,&#39;Less&#39;);</span>
<span class="cm">      uT.toggleSpanValue(&#39;moreOrLess2&#39;,&#39;More&#39;,&#39;Less&#39;);</span>
<span class="cm">      pS.scroll(&#39;editorMark&#39;);</span>
<span class="cm">   }</span>
<span class="cm">   */</span>
   
   <span class="kd">function</span> <span class="nx">resetToDefaults_gOnOff_RestAndFriction</span><span class="p">()</span> <span class="p">{</span>    
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_default_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_default_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_default_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_default_gOff</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
      
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_default_gOn</span><span class="p">;</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_default_gOn</span><span class="p">;</span>
      
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_default_gOff</span><span class="p">;</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_default_gOff</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">setGravityRelatedParameters</span><span class="p">(</span> <span class="nx">pars</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">restitution</span><span class="p">,</span> <span class="nx">friction</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">showMessage</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">showMessage</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">updatePucks</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">updatePucks</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
   
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">g_ON</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Box2D velocityThreshold setting is needed for settling stacks of pucks.</span>
         <span class="nx">b2DW</span><span class="p">.</span><span class="nx">Settings</span><span class="p">.</span><span class="nx">b2_velocityThreshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="c1">// 1.0</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">g_2d_mps2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="nx">c</span><span class="p">.</span><span class="nx">g_mps2</span><span class="p">);</span>
         <span class="nx">restitution</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span><span class="p">;</span>
         <span class="nx">friction</span> <span class="o">=</span>    <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="c1">// But here, with no gravity, it&#39;s better to turn the velocityThreshold setting off </span>
         <span class="c1">// so pucks don&#39;t stick to walls.</span>
         <span class="nx">b2DW</span><span class="p">.</span><span class="nx">Settings</span><span class="p">.</span><span class="nx">b2_velocityThreshold</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="c1">// 0.0</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">g_2d_mps2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
         <span class="nx">restitution</span> <span class="o">=</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span><span class="p">;</span>
         <span class="nx">friction</span> <span class="o">=</span>    <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">showMessage</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s1">&#39;Gravity = [base,yellow]&#39;</span> <span class="o">+</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">g_2d_mps2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;[base]&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="c1">// If not fixed, set puck restitution and friction properties.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">updatePucks</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span> <span class="nx">puck</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">puck</span><span class="p">.</span><span class="nx">restitution_fixed</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">puck</span><span class="p">.</span><span class="nx">b2d</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">.</span><span class="nx">m_restitution</span> <span class="o">=</span> <span class="nx">restitution</span><span class="p">;</span>
               <span class="nx">puck</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="nx">restitution</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">puck</span><span class="p">.</span><span class="nx">friction_fixed</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">puck</span><span class="p">.</span><span class="nx">b2d</span><span class="p">.</span><span class="nx">m_fixtureList</span><span class="p">.</span><span class="nx">m_friction</span>    <span class="o">=</span> <span class="nx">friction</span><span class="p">;</span>
               <span class="nx">puck</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="nx">friction</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">});</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">em</span><span class="p">(</span> <span class="nx">px</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Convert to em units based on a font-size of 16px.</span>
      <span class="k">return</span> <span class="nx">px</span><span class="o">/</span><span class="mf">16.0</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">fullScreenState</span><span class="p">(</span> <span class="nx">mode</span> <span class="o">=</span> <span class="s1">&#39;get&#39;</span><span class="p">)</span> <span class="p">{</span>      
      <span class="c1">// Get or set the fullscreen state. This function is revealed.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;get&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenState</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenState</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenState</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;from fullScreenState&#39;</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">improveCanvasResolution</span><span class="p">(</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">width_px</span><span class="p">,</span> <span class="nx">height_px</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">;</span>
      <span class="nx">ratio</span> <span class="o">*=</span> <span class="mi">3</span><span class="p">;</span>
      
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width_px</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">;</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height_px</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">;</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width_px</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height_px</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">).</span><span class="nx">scale</span><span class="p">(</span> <span class="nx">ratio</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">);</span>
   <span class="p">}</span>   

   <span class="kd">function</span> <span class="nx">adjustSizeOfChatDiv</span><span class="p">(</span> <span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// This is used for both the host and client pages. Any calls to getElementById</span>
      <span class="c1">// will return a null for elements not found on that page.</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;mobile&#39;</span><span class="p">)</span> <span class="nx">mode</span> <span class="o">=</span> <span class="s1">&#39;small&#39;</span><span class="p">;</span>
      
      <span class="c1">// Input fields</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">nodeServer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;nodeServer&#39;</span><span class="p">);</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">roomName</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;roomName&#39;</span><span class="p">);</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">inputField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;inputField&#39;</span><span class="p">);</span>
      
      <span class="c1">// The two divs that toggle</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">multiPlayer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;multiPlayer&#39;</span><span class="p">);</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">ttcIntro</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ttcIntro&#39;</span><span class="p">);</span>
      
      <span class="c1">// connectionCanvas is only on the client page.</span>
      <span class="nx">dC</span><span class="p">.</span><span class="nx">connectionCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;connectionCanvas&#39;</span><span class="p">);</span>
      
      <span class="kd">var</span> <span class="nx">divW_Large</span> <span class="o">=</span> <span class="nx">em</span><span class="p">(</span><span class="mi">540</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">divW_Small</span> <span class="o">=</span> <span class="nx">em</span><span class="p">(</span><span class="mi">540</span><span class="o">-</span><span class="mi">118</span><span class="p">);</span>  <span class="c1">//118</span>

      <span class="kd">var</span> <span class="nx">tweek</span> <span class="o">=</span> <span class="o">-</span><span class="mi">8</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">nodeServer_Large</span> <span class="o">=</span> <span class="nx">em</span><span class="p">(</span><span class="mi">332</span><span class="o">+</span><span class="nx">tweek</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">roomName_Large</span>   <span class="o">=</span> <span class="nx">em</span><span class="p">(</span> <span class="mi">70</span><span class="o">+</span><span class="mi">0</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">inputField_Large</span> <span class="o">=</span> <span class="nx">em</span><span class="p">(</span><span class="mi">534</span><span class="o">+</span><span class="nx">tweek</span><span class="p">);</span> <span class="c1">//536</span>
      <span class="kd">var</span> <span class="nx">connectionCanvas_Large_px</span> <span class="o">=</span> <span class="mi">518</span><span class="o">+</span><span class="nx">tweek</span><span class="p">;</span>  <span class="c1">//518</span>
      
      <span class="kd">var</span> <span class="nx">shrink_px</span> <span class="o">=</span> <span class="mi">141</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">shrink</span> <span class="o">=</span> <span class="nx">em</span><span class="p">(</span> <span class="nx">shrink_px</span><span class="p">);</span>
      
      <span class="kd">var</span> <span class="nx">nodeServer_Small</span> <span class="o">=</span> <span class="nx">nodeServer_Large</span> <span class="o">-</span> <span class="nx">shrink</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">roomName_Small</span>   <span class="o">=</span> <span class="nx">roomName_Large</span>   <span class="o">-</span>  <span class="nx">em</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">inputField_Small</span> <span class="o">=</span> <span class="nx">inputField_Large</span> <span class="o">-</span> <span class="nx">shrink</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">connectionCanvas_Small_px</span> <span class="o">=</span> <span class="nx">connectionCanvas_Large_px</span> <span class="o">-</span> <span class="mi">117</span><span class="p">;</span>
      
      <span class="kd">let</span> <span class="nx">canvasWidth_px</span><span class="p">,</span> <span class="nx">canvasHeight_px</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;small&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">nodeServer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nodeServer_Small</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">roomName</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">roomName_Small</span>  <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">inputField</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">inputField_Small</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         
         <span class="nx">canvasWidth_px</span> <span class="o">=</span> <span class="nx">connectionCanvas_Small_px</span><span class="p">;</span>
         <span class="nx">canvasHeight_px</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">connectionCanvas</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//dC.connectionCanvas.width = canvasWidth_px;</span>
            <span class="c1">//dC.connectionCanvas.height = canvasHeight_px;</span>
            <span class="nx">hC</span><span class="p">.</span><span class="nx">refresh_P2P_indicator</span><span class="p">({</span><span class="s1">&#39;mode&#39;</span><span class="o">:</span><span class="s1">&#39;p2p&#39;</span><span class="p">,</span><span class="s1">&#39;context&#39;</span><span class="o">:</span><span class="s1">&#39;sizeAdjust&#39;</span><span class="p">});</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">ttcIntro</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">maxWidth</span>    <span class="o">=</span> <span class="nx">divW_Small</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">ttcIntro</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">minWidth</span>    <span class="o">=</span> <span class="nx">divW_Small</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">multiPlayer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">=</span> <span class="nx">divW_Small</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">multiPlayer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">minWidth</span> <span class="o">=</span> <span class="nx">divW_Small</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">nodeServer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nodeServer_Large</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">roomName</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">roomName_Large</span>  <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">inputField</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">inputField_Large</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span> 
         
         <span class="nx">canvasWidth_px</span> <span class="o">=</span> <span class="nx">connectionCanvas_Large_px</span><span class="p">;</span>
         <span class="nx">canvasHeight_px</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">connectionCanvas</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//dC.connectionCanvas.width = canvasWidth_px;</span>
            <span class="c1">//dC.connectionCanvas.height = canvasHeight_px;</span>
            <span class="nx">hC</span><span class="p">.</span><span class="nx">refresh_P2P_indicator</span><span class="p">({</span><span class="s1">&#39;mode&#39;</span><span class="o">:</span><span class="s1">&#39;p2p&#39;</span><span class="p">,</span><span class="s1">&#39;context&#39;</span><span class="o">:</span><span class="s1">&#39;sizeAdjust&#39;</span><span class="p">});</span>
         <span class="p">}</span>

         <span class="nx">dC</span><span class="p">.</span><span class="nx">ttcIntro</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">maxWidth</span>    <span class="o">=</span> <span class="nx">divW_Large</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">ttcIntro</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">minWidth</span>    <span class="o">=</span> <span class="nx">divW_Large</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">multiPlayer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">=</span> <span class="nx">divW_Large</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">multiPlayer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">minWidth</span> <span class="o">=</span> <span class="nx">divW_Large</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">connectionCanvas</span><span class="p">)</span> <span class="nx">improveCanvasResolution</span><span class="p">(</span> <span class="nx">dC</span><span class="p">.</span><span class="nx">connectionCanvas</span><span class="p">,</span> <span class="nx">canvasWidth_px</span><span class="p">,</span> <span class="nx">canvasHeight_px</span><span class="p">);</span>
   <span class="p">}</span>    
   
   <span class="kd">function</span> <span class="nx">setNickNameWithoutConnecting</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">nickNameResult</span> <span class="o">=</span> <span class="nx">hC</span><span class="p">.</span><span class="nx">checkForNickName</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">nickNameResult</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="s1">&#39;too long&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">hC</span><span class="p">.</span><span class="nx">displayMessage</span><span class="p">(</span><span class="s1">&#39;Nicknames must have 10 characters or less.&#39;</span><span class="p">);</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">nickNameResult</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="s1">&#39;too short&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">hC</span><span class="p">.</span><span class="nx">displayMessage</span><span class="p">(</span><span class="s1">&#39;Nicknames must have more than 1 alphanumeric character.&#39;</span><span class="p">);</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m_hostOrClient</span> <span class="o">==</span> <span class="s2">&quot;host&quot;</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">nickName</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Wait for the capture file to load, the demoVersion gets set as it loads.</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
               <span class="kd">let</span> <span class="nx">teamString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">teamName</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot; Your team name is &quot;</span> <span class="o">+</span> <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">teamName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
               
               <span class="kd">let</span> <span class="nx">itsAGame</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">oneOfTheseV2</span><span class="p">([</span><span class="s1">&#39;3.d&#39;</span><span class="p">,</span><span class="s1">&#39;4.e&#39;</span><span class="p">,</span><span class="s1">&#39;5.e.basketball&#39;</span><span class="p">,</span><span class="s1">&#39;6.a&#39;</span><span class="p">,</span><span class="s1">&#39;6.d&#39;</span><span class="p">,</span><span class="s1">&#39;7&#39;</span><span class="p">,</span><span class="s1">&#39;8&#39;</span><span class="p">],</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">getDemoVersion</span><span class="p">());</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">itsAGame</span><span class="p">)</span> <span class="nx">hC</span><span class="p">.</span><span class="nx">displayMessage</span><span class="p">(</span><span class="s1">&#39;Your nickname is &#39;</span> <span class="o">+</span> <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">nickName</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">teamString</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
         <span class="p">}</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m_hostOrClient</span> <span class="o">==</span> <span class="s2">&quot;client&quot;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Should never see this. This function only runs on the host.&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// If no nickname yet (unless there&#39;s modify-capture JSON in the chat field), put back the nickname reminder tip in the chat input field.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nickNameResult</span><span class="p">.</span><span class="nx">status</span> <span class="o">!=</span> <span class="s1">&#39;JSON&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="p">(</span><span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">nickName</span><span class="p">))</span> <span class="nx">hC</span><span class="p">.</span><span class="nx">restoreInputDefault</span><span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;inputField&#39;</span><span class="p">));</span>
      <span class="p">}</span>
   <span class="p">}</span>
      
   <span class="kd">function</span> <span class="nx">hL</span><span class="p">(</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/*      </span>
<span class="cm">      hL is short for highlighting...</span>
<span class="cm">      This inserts a style string in the links of the &quot;Plus&quot; row below the </span>
<span class="cm">      number button cluster. So, when a link in the plus row is clicked (or a </span>
<span class="cm">      number clicked), the demo is loaded and started, and each link in the </span>
<span class="cm">      row is rebuilt (using calls to hL) and highlighted according to whether </span>
<span class="cm">      it matches the first part of the demo version (e.g. 3.d). See calls to </span>
<span class="cm">      hL in demoStart. See related code (that modifies the plus row) in </span>
<span class="cm">      cR.saveState, cR.clearState, and near the top of demoStart.</span>
<span class="cm">      */</span>
      <span class="c1">//console.log(id + &#39;,&#39; + c.demoVersion.slice(0,3) + &#39;,&#39; + c.demoVersion.length);</span>
      <span class="kd">var</span> <span class="nx">idString</span> <span class="o">=</span> <span class="s2">&quot; id=&#39;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">;</span>
      
      <span class="c1">// the link id that matches demoVersion (from capture in the text area), e.g. 2.c</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
         <span class="c1">// special captures have a black border, e.g. 2.c.334</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">styleString</span> <span class="o">=</span> <span class="s2">&quot;style=&#39;color:white; background-color:gray; border-style:solid; border-color:black; border-width:4px 0px 4px 0px&#39;&quot;</span><span class="p">;</span>
         <span class="c1">// link ids that match a regular selected capture get a gray background (without a black border)</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">styleString</span> <span class="o">=</span> <span class="s2">&quot;style=&#39;color:white; background-color:gray; padding:2px 0px&#39;&quot;</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="c1">// link ids that don&#39;t match get a normal background color (off white)  </span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">styleString</span> <span class="o">=</span> <span class="s2">&quot;style=&#39;padding:2px 0px&#39;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">idString</span> <span class="o">+</span> <span class="nx">styleString</span><span class="p">;</span>
   <span class="p">}</span>
      
   <span class="kd">function</span> <span class="nx">defaultStartingPosAndVel</span><span class="p">(</span> <span class="nx">demoVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">startingPandV</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;8.a&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">9.34</span><span class="p">,</span> <span class="mf">5.23</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">10.21</span><span class="p">,</span> <span class="mf">7.61</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">10.21</span><span class="p">,</span> <span class="mf">4.46</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">9.34</span><span class="p">,</span> <span class="mf">6.84</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;8.b&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;8.c&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;8.d&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.95</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">6.95</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">7.95</span><span class="p">,</span> <span class="mf">4.91</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;8.e&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span>
                           <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span> <span class="p">];</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">startingPandV</span><span class="p">;</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">demoStart</span><span class="p">(</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">pars</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="nx">buttonColor</span><span class="p">,</span> <span class="nx">buttonTextColor</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">,</span> <span class="nx">p4</span><span class="p">;</span>
      
      <span class="kd">var</span> <span class="nx">scrollCA</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">scrollCA</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">scrollHelp</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">scrollHelp</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">restartLoop</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">restartLoop</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">logThis</span> <span class="o">=</span> <span class="nx">uT</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">logThis</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      
      <span class="nx">aT</span><span class="p">.</span><span class="nx">collisionCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">aT</span><span class="p">.</span><span class="nx">collisionInThisStep</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      
      <span class="c1">// by default no blending</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="s1">&#39;source-over&#39;</span><span class="p">;</span>
            
      <span class="c1">// Scroll the capture, so you can see the name of the capture if it&#39;s there.</span>
      <span class="c1">// However, nice to be able to edit the capture and run it without losing the spot where</span>
      <span class="c1">// you&#39;re working. In that case, set scrollCA to be false.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">scrollCA</span><span class="p">)</span> <span class="nx">cR</span><span class="p">.</span><span class="nx">scrollCaptureArea</span><span class="p">();</span>
      
      <span class="c1">// Set this module-level value to support the JSON capture.</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">index</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">networkPuckTemplate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      
      <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      
      <span class="c1">// Scaling factor between the Box2d world and the screen (pixels per meter)</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">px_per_m</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>  <span class="c1">// a module-level value</span>
      
      <span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenDemo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      
      <span class="nx">cP</span><span class="p">.</span><span class="nx">EpL</span><span class="p">.</span><span class="nx">turnDisplayOff</span><span class="p">({});</span>
      <span class="nx">cP</span><span class="p">.</span><span class="nx">EpL</span><span class="p">.</span><span class="nx">COM</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// reset this flag that indicates when a capture uses COM for the angular axis.</span>
      
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">canvasColor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">;</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">clearCanvas</span><span class="p">();</span>
      
      <span class="c1">// The canvas background color must match the border color to avoid border edge problems in Chrome. (border is usually &#39;#008080&#39;)</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">borderAndBackGroundColor</span><span class="p">;</span> <span class="c1">// border dimensions are initially set for hostCanvas in hostAndClient.css</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenState</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// There&#39;s no border in full-screen mode.</span>
         <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">borderAndBackGroundColor</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">topFenceLegName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// For use in pi-calc demos</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// see layout adjustments for demo 8 in (index == 8) block below</span>
         <span class="nx">adjustSizeOfChatDiv</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">);</span> <span class="c1">// on the host (note: see demo 8 where a smaller chat div is set).</span>
         <span class="nx">hC</span><span class="p">.</span><span class="nx">resizeClients</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">);</span> <span class="c1">// adjust the chat div on all the clients</span>
         <span class="c1">// Set this module-level value to help new connecting clients adjust their layout.</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">chatLayoutState</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span><span class="p">;</span>
      <span class="p">}</span>
                
      <span class="c1">// Change the color of the demo button that was clicked.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">==</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">buttonColor</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span><span class="p">;</span>
            <span class="nx">buttonTextColor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Darkgray (with white text) for the game buttons</span>
            <span class="k">if</span> <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
               <span class="nx">buttonColor</span> <span class="o">=</span> <span class="s2">&quot;darkgray&quot;</span><span class="p">;</span>
               <span class="nx">buttonTextColor</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">buttonColor</span> <span class="o">=</span> <span class="s2">&quot;lightgray&quot;</span><span class="p">;</span>
               <span class="nx">buttonTextColor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="nx">j</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">buttonColor</span><span class="p">;</span>
         <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="nx">j</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">buttonTextColor</span><span class="p">;</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">indexInPlusRow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">tA</span><span class="p">.</span><span class="nx">clearTable</span><span class="p">();</span> 
      
      <span class="nx">gB</span><span class="p">.</span><span class="nx">resetTableHistory</span><span class="p">();</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span> <span class="o">=</span> <span class="p">[];</span>
      
      <span class="nx">gW</span><span class="p">.</span><span class="nx">hostMSelect</span><span class="p">.</span><span class="nx">candidateReportPasteDelete</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      
      <span class="c1">// Reset input devices (key states sometimes get stuck down).</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span> <span class="nx">client</span> <span class="p">=&gt;</span> <span class="p">{</span>
         <span class="c1">// Force a mouseUp event.</span>
         <span class="nx">eV</span><span class="p">.</span><span class="nx">mouseUp_handler</span><span class="p">(</span> <span class="nx">client</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
         
         <span class="nx">client</span><span class="p">.</span><span class="nx">touchScreenUsage</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         
         <span class="c1">// Reset all keys to be up.</span>
         <span class="c1">// Don&#39;t reset the number key that corresponds to the current demo. That avoids repetition if holding down a demo key (see comments in keydown listener).</span>
         <span class="kd">let</span> <span class="nx">keyBeingPressed</span> <span class="o">=</span> <span class="s1">&#39;key_&#39;</span> <span class="o">+</span> <span class="nx">index</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">keyMap</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">keyMap</span><span class="p">[</span> <span class="nx">key</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">keyBeingPressed</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">client</span><span class="p">[</span> <span class="nx">keyMap</span><span class="p">[</span> <span class="nx">key</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
         
         <span class="nx">client</span><span class="p">.</span><span class="nx">bulletAgeLimit_ms</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">});</span>
      
      <span class="nx">setNickNameWithoutConnecting</span><span class="p">();</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">resetScores</span><span class="p">();</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">hackerCheck</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">);</span>
      
      <span class="c1">// De-select anything still selected.</span>
      <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">selectedBody</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">hostMSelect</span><span class="p">.</span><span class="nx">resetAll</span><span class="p">();</span>
            
      <span class="nx">gW</span><span class="p">.</span><span class="nx">resetFenceColor</span><span class="p">(</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">pause</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">pause</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c1">// setPauseState will start the game loop only if it IS NOT running.</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">frameCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">setPauseState</span><span class="p">();</span>
      <span class="c1">// restartAnimationLoop will restart the loop only if it IS running.</span>
      <span class="kd">let</span> <span class="nx">notDemo0ExitFromFC</span> <span class="o">=</span> <span class="p">(</span> <span class="o">!</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span><span class="mi">0</span><span class="p">))</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">restartLoop</span> <span class="o">&amp;&amp;</span> <span class="nx">notDemo0ExitFromFC</span><span class="p">)</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">restartAnimationLoop</span><span class="p">(</span> <span class="mi">200</span><span class="p">);</span>
      
      <span class="c1">// Turn gravity off by default.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">g_ON</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">g_ON</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c1">// Note that setGravityRelatedParameters runs at the end of demoStart.</span>
      <span class="nx">resetToDefaults_gOnOff_RestAndFriction</span><span class="p">();</span>
      
      <span class="nx">dC</span><span class="p">.</span><span class="nx">comSelection</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      
      <span class="nx">pP</span><span class="p">.</span><span class="nx">setBulletAgeLimit_ms</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
      
      <span class="c1">// reset the pi stuff back to defaults</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">piCalcs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;clacks&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;usePiEngine&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">};</span>
      
      <span class="c1">// These message resets shut down any lingering messages from prior demos.</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">30</span><span class="p">};</span> <span class="c1">// The help location for all the non-game demos.</span>
      
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help2&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help2&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">200</span><span class="p">};</span> <span class="c1">// report for a selected spring.</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;EpLreport&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">50</span><span class="p">};</span> <span class="c1">// report for a selected spring.</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">].</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">;</span>
      
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;lowHelp&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
      <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">40</span><span class="p">};</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;videoTitle&#39;</span><span class="p">])</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;videoTitle&#39;</span><span class="p">].</span><span class="nx">resetMessage</span><span class="p">();</span>
            
      <span class="c1">// By default, use &quot;a&quot; for the demoVersion. </span>
      <span class="c1">// (Loading a capture will overwrite this default value, as it should.)</span>
      <span class="c1">// When a capture is taken, its name will be based on (added to) this demo version name.</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;.a&#39;</span><span class="p">;</span>
      
      <span class="c1">// Parse the JSON capture into a local object.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">state_capture</span> <span class="o">=</span> <span class="nx">cR</span><span class="p">.</span><span class="nx">loadJSON</span><span class="p">(</span> <span class="nx">dC</span><span class="p">.</span><span class="nx">json</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="c1">// Reset the shot locks and speed.</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span> <span class="nx">client</span> <span class="p">=&gt;</span> <span class="p">{</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">ctrlShiftLock</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">poolShotLocked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">poolShotLockedSpeed_mps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">});</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">cR</span><span class="p">.</span><span class="nx">clearState</span><span class="p">();</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">pauseErase</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">displaySCM</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">)</span> <span class="nx">eVN</span><span class="p">.</span><span class="nx">changeFullScreenMode</span><span class="p">(</span> <span class="nx">canvas</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">);</span>
         <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;scroll-to-very-top&#39;</span><span class="p">);</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot; reset&quot;</span><span class="p">;</span>         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;The zero key triggers a complete reset.\\   For a stronger reset, try reloading the page.&quot;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">);</span>         
                  
         <span class="c1">// Normally, the &quot;0&quot; demo is kept blank for observing the framerate.</span>
         
         <span class="cm">/*</span>
<span class="cm">         // The following is an animation that was used in the beginning of the Puck Popper video.</span>
<span class="cm">         //canvas.width = 1250, canvas.height = 950;</span>
<span class="cm">         //canvas.width = 1920, canvas.height = 1080;</span>
<span class="cm">         canvas.width = 1850, canvas.height = 1060;</span>
<span class="cm">         cP.Wall.makeFence({&#39;tOn&#39;:false,&#39;rOn&#39;:false}, canvas); // Turn top and right walls off.</span>
<span class="cm">         </span>
<span class="cm">         gW.messages[&#39;videoTitle&#39;].font = &quot;35px Arial&quot;;</span>
<span class="cm">         gW.messages[&#39;videoTitle&#39;].loc_px = {&#39;x&#39;:300,&#39;y&#39;:400};</span>
<span class="cm">         gW.messages[&#39;videoTitle&#39;].popAtEnd = false;</span>
<span class="cm">         var theSeries = {</span>
<span class="cm">            1:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;an introduction...&quot;},</span>
<span class="cm">            2:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;maybe less...&quot;,            &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:400} },</span>
<span class="cm">            3:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;maybe more...&quot;,            &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450} },</span>
<span class="cm">            4:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;than you should know...&quot;,  &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:400} },</span>
<span class="cm">            6:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;about...&quot;,                 &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450},                      &#39;popAtEnd&#39;:true},</span>
<span class="cm">            7:{&#39;tL_s&#39;:1.3, &#39;message&#39;:&quot;Puck&quot;,                     &#39;loc_px&#39;:{&#39;x&#39;:250,&#39;y&#39;:350}, &#39;font&#39;:&quot;90px Arial&quot;, &#39;popAtEnd&#39;:true},</span>
<span class="cm">            8:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;Popper&quot;,                   &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450},                      &#39;popAtEnd&#39;:false},</span>
<span class="cm">            </span>
<span class="cm">            9:{&#39;tL_s&#39;:1.0, &#39;message&#39;:&quot;...&quot;,                                 &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450}, &#39;font&#39;:&quot;35px Arial&quot;},</span>
<span class="cm">            10:{&#39;tL_s&#39;:1.5, &#39;message&#39;:&quot;but first...&quot;,                       &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450}, &#39;font&#39;:&quot;35px Arial&quot;},</span>
<span class="cm">            11:{&#39;tL_s&#39;:3.0, &#39;message&#39;:&quot;a game of the #8c version...&quot;, &#39;loc_px&#39;:{&#39;x&#39;:300,&#39;y&#39;:450} },</span>
<span class="cm">         };</span>
<span class="cm">         gW.messages[&#39;videoTitle&#39;].newMessageSeries( theSeries);</span>
<span class="cm">         </span>
<span class="cm">         var nBalls = 36; //100 36 180</span>
<span class="cm">         var angle_step_deg = 360.0 / nBalls;</span>
<span class="cm">         var v_2d_mps = new wS.Vec2D(0, 2.0);</span>
<span class="cm">         // 12.5/2, 9.5/2</span>
<span class="cm">         for (var i = 1; i &lt;= nBalls; i++) {</span>
<span class="cm">               new cP.Puck(new wS.Vec2D(3.0, 3.0), v_2d_mps, {&#39;radius_m&#39;:0.1, &#39;groupIndex&#39;:-1, &#39;color&#39;:&#39;white&#39;, &#39;friction&#39;:0.0});</span>
<span class="cm">               // Rotate for the next ball.</span>
<span class="cm">               v_2d_mps.rotated_by( angle_step_deg);</span>
<span class="cm">         }</span>
<span class="cm">         */</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;1.c&#39;</span><span class="p">,</span><span class="s1">&#39;1.d&#39;</span><span class="p">,</span><span class="s1">&#39;1.e&#39;</span><span class="p">,</span><span class="s1">&#39;1.f&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
               <span class="c1">// play the clack sound once at low (not zero) volume to make sure it is loaded and ready for the first collision.</span>
               <span class="nx">gW</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="s1">&#39;clack2&#39;</span><span class="p">].</span><span class="nx">play</span><span class="p">(</span><span class="mf">0.05</span><span class="p">);</span>
               
               <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">piCalcs</span><span class="p">.</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">massRatio</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">].</span><span class="nx">mass_kg</span> <span class="o">/</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">].</span><span class="nx">mass_kg</span><span class="p">);</span>
                  <span class="kd">var</span> <span class="nx">massRatio_string</span> <span class="o">=</span> <span class="nx">massRatio</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">();</span> <span class="c1">// commas in the string</span>
                  <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;lowHelp&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;Mass ratio = &quot;</span> <span class="o">+</span> <span class="nx">massRatio_string</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">);</span>
                  
                  <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">piCalcs</span><span class="p">.</span><span class="nx">usePiEngine</span><span class="p">)</span> <span class="p">{</span>
                     <span class="kd">var</span> <span class="nx">initialCount</span> <span class="o">=</span> <span class="nx">pE</span><span class="p">.</span><span class="nx">get_collisionCount</span><span class="p">();</span>
                  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                     <span class="kd">var</span> <span class="nx">initialCount</span> <span class="o">=</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">collisionCount</span><span class="p">;</span>
                  <span class="p">}</span>
                  <span class="c1">// This initial message is updated for both engines, box2d and piCalcs.</span>
                  <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span><span class="s2">&quot;count = &quot;</span> <span class="o">+</span> <span class="nx">initialCount</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">);</span>
               <span class="p">}</span>
            <span class="p">}</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">v_init_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">),</span>       <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;GoldenRod&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span>       <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.80</span>                                         <span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            
            <span class="kd">var</span> <span class="nx">v_init_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="mf">2.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">1.60</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.35</span>                                         <span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">1.60</span><span class="o">+</span><span class="mf">1.5</span><span class="p">),</span>   <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;GoldenRod&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">1.60</span><span class="p">),</span>       <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.35</span>                                         <span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">5.60</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;bullet&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span> <span class="nx">puck</span> <span class="p">=&gt;</span> <span class="p">{</span> 
               <span class="k">if</span> <span class="p">(</span><span class="nx">puck</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;puck1111&quot;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">puck</span><span class="p">.</span><span class="nx">angleLine</span> <span class="o">=</span> <span class="s2">&quot;stripe&quot;</span><span class="p">;</span>
                  <span class="nx">puck</span><span class="p">.</span><span class="nx">borderWidth_px</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                  <span class="nx">puck</span><span class="p">.</span><span class="nx">b2d</span><span class="p">.</span><span class="nx">SetAngle</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
               <span class="p">}</span>
            <span class="p">})</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;big and little&#39;     &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;1.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(1)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;a gentle landing&#39; &quot;</span>   <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;1.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(1, {&#39;fileName&#39;:&#39;demo1b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;calculating the first two digits of pi with collisions&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;1.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(1, {&#39;fileName&#39;:&#39;demo1c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;three digits of pi&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;1.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(1, {&#39;fileName&#39;:&#39;demo1d.js&#39;})\&quot;&gt;&amp;nbsp;d,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;five digits of pi&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;1.e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(1, {&#39;fileName&#39;:&#39;demo1e.js&#39;})\&quot;&gt;&amp;nbsp;e&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;1.c&#39;</span><span class="p">,</span><span class="s1">&#39;1.d&#39;</span><span class="p">,</span><span class="s1">&#39;1.e&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>               
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d1_pi&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d1&#39;</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d2&#39;</span><span class="p">);</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;angleLine&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>
                                                                  <span class="s1">&#39;createTail&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;tail&#39;</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;propSpeed_ppf_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;length_limit&#39;</span><span class="o">:</span><span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;teal&#39;</span><span class="p">}</span> <span class="p">});</span>
                                                                  
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.60</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;angleLine&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span> <span class="p">});</span>
                                                                  
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;angleLine&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>
                                                                  <span class="s1">&#39;createTail&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;tail&#39;</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;propSpeed_ppf_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;length_limit&#39;</span><span class="o">:</span><span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;teal&#39;</span><span class="p">}</span> <span class="p">});</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;sound field&#39;                          &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;2.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(2)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;pretty&#39;                               &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;2.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(2, {&#39;fileName&#39;:&#39;demo2b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;Mach speeds of 1.0, 1.4, and 2.0&#39;     &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;2.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(2, {&#39;fileName&#39;:&#39;demo2c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;tag&#39;                                  &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;2.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(2, {&#39;fileName&#39;:&#39;demo2d.js&#39;})\&quot;&gt;&amp;nbsp;d,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;rainbow&#39;                              &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;2.e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(2, {&#39;fileName&#39;:&#39;demo2e.js&#39;})\&quot;&gt;&amp;nbsp;e&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
            
         <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2.e&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">messageString</span> <span class="o">=</span>                                 <span class="s1">&#39;Play with the rainbow tail:&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">)</span> <span class="nx">messageString</span> <span class="o">+=</span> <span class="s1">&#39;\\    click the full-canvas button, then...&#39;</span><span class="p">;</span>
            <span class="nx">messageString</span> <span class="o">+=</span>                                    <span class="s1">&#39;\\    click and drag the black ball.&#39;</span><span class="p">;</span>
            <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">newMessage</span><span class="p">(</span> <span class="nx">messageString</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">);</span>
         <span class="p">}</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
         
         <span class="nx">v_init_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">);</span> 
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;3.d&quot;</span><span class="p">)</span> <span class="p">{</span>               
               <span class="nx">c</span><span class="p">.</span><span class="nx">canvasColor</span> <span class="o">=</span> <span class="s1">&#39;#2b473b&#39;</span><span class="p">;</span> <span class="c1">// #36594a</span>
               <span class="nx">gB</span><span class="p">.</span><span class="nx">resetGame</span><span class="p">();</span> <span class="c1">// ghost-ball</span>
            <span class="p">}</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">grid_order</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">grid_spacing_m</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">startPosition_2d_m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
            
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">grid_order</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
               <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">grid_order</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">delta_2d_m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">i</span> <span class="o">*</span> <span class="nx">grid_spacing_m</span><span class="p">,</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">grid_spacing_m</span><span class="p">);</span>
                  <span class="kd">var</span> <span class="nx">position_2d_m</span> <span class="o">=</span> <span class="nx">startPosition_2d_m</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">delta_2d_m</span><span class="p">);</span>
                  <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">position_2d_m</span><span class="p">,</span> <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;groupIndex&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">});</span>
               <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="nx">v_init_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span> <span class="nx">v_init_2d_mps</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;GoldenRod&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;groupIndex&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">}</span> <span class="p">);</span>
            
            <span class="cm">/*</span>
<span class="cm">            // Expanding ring of non-colliding balls.</span>
<span class="cm">            var nBalls = 36; //100 36 180</span>
<span class="cm">            var angle_step_deg = 360.0 / nBalls;</span>
<span class="cm">            var v_2d_mps = new wS.Vec2D(0, 2.0);</span>
<span class="cm">            for (var i = 1; i &lt;= nBalls; i++) {</span>
<span class="cm">                  new cP.Puck(new wS.Vec2D(3, 3), v_2d_mps, {&#39;radius_m&#39;:0.1, &#39;groupIndex&#39;:-1, &#39;color&#39;:&#39;white&#39;});</span>
<span class="cm">                  // Rotate for the next ball.</span>
<span class="cm">                  v_2d_mps.rotated_by( angle_step_deg);</span>
<span class="cm">            }</span>
<span class="cm">            window.setTimeout( function() {</span>
<span class="cm">               cR.saveState();</span>
<span class="cm">            }, 1);</span>
<span class="cm">            */</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;order and disorder&#39;      &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;3.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(3)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;no puck-puck collisions&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;3.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(3, {&#39;fileName&#39;:&#39;demo3b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;no puck-puck collisions&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;3.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(3, {&#39;fileName&#39;:&#39;demo3c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;pool shots&#39; &quot;</span>              <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;3.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(3, {&#39;fileName&#39;:&#39;demo3d.js&#39;})\&quot;&gt;&amp;nbsp;d&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
            
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;3.d&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>               
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d3d&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d3&#39;</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
                 
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;4.e&quot;</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Monkey Hunt game             </span>
               <span class="nx">c</span><span class="p">.</span><span class="nx">canvasColor</span> <span class="o">=</span> <span class="s1">&#39;#324440&#39;</span><span class="p">;</span> 
               <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">40</span><span class="p">};</span>
               <span class="nx">mH</span><span class="p">.</span><span class="nx">initializeGame</span><span class="p">();</span>
            <span class="p">}</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.00</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> 
               <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.40</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;GoldenRod&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span> <span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="o">:</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="s1">&#39;angularSpeed_rps&#39;</span><span class="o">:</span><span class="mf">25.0</span><span class="p">});</span>
            
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> 
               <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="o">:</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="s1">&#39;aspectR&#39;</span><span class="o">:</span><span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;angularSpeed_rps&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;angle_r&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.75</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> 
               <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="o">:</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span> <span class="s1">&#39;aspectR&#39;</span><span class="o">:</span><span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;angularSpeed_rps&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;angle_r&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">});</span>
               
            <span class="c1">// Include two pins and a spring as a source for replicating. </span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),{}),</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),{}),</span> 
                 <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">1.3</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">10.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;damper_Ns2pm2&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">});</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;rectangular symmetry&#39;                &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;4.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(4)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;conservation of angular momentum...&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;4.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(4, {&#39;fileName&#39;:&#39;demo4b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;no surface friction or y momentum&#39; &quot;</span>   <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;4.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(4, {&#39;fileName&#39;:&#39;demo4c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;little moves big&#39; &quot;</span>                    <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;4.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(4, {&#39;fileName&#39;:&#39;demo4d.js&#39;})\&quot;&gt;&amp;nbsp;d&amp;nbsp;&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;get that monkey&#39; &quot;</span>                     <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;4.e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(4, {&#39;fileName&#39;:&#39;demo4e.monkeyhunt.js&#39;})\&quot;&gt;&amp;nbsp;e&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;4.e.monkeyhunt&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;hunt&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d4&#39;</span><span class="p">);</span>
            <span class="p">}</span>   
         <span class="p">}</span> 
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

         <span class="nx">v_init_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>         
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;basketball-par&#39;</span><span class="p">))</span> <span class="p">{</span>
               <span class="nx">c</span><span class="p">.</span><span class="nx">canvasColor</span> <span class="o">=</span> <span class="s1">&#39;#262626&#39;</span><span class="p">;</span>  <span class="c1">// gray 262626 333333 (lighter)</span>
               <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">40</span><span class="p">};</span>
               <span class="nx">bpH</span><span class="p">.</span><span class="nx">initializeGame</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;basketball-pol&#39;</span><span class="p">))</span> <span class="p">{</span>
               <span class="nx">c</span><span class="p">.</span><span class="nx">canvasColor</span> <span class="o">=</span> <span class="s1">&#39;#262626&#39;</span><span class="p">;</span>  <span class="c1">// gray 262626 333333 (lighter)</span>
               <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">40</span><span class="p">};</span>
               <span class="nx">bpH</span><span class="p">.</span><span class="nx">initializeGame</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">);</span>
            <span class="p">}</span>        
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            <span class="nx">gW</span><span class="p">.</span><span class="nx">aT</span><span class="p">.</span><span class="nx">wallMap</span><span class="p">[</span><span class="s1">&#39;wall1&#39;</span><span class="p">].</span><span class="nx">deleteThisOne</span><span class="p">({});</span>
            
            <span class="nx">cP</span><span class="p">.</span><span class="nx">EpL</span><span class="p">.</span><span class="nx">turnDisplayOn</span><span class="p">();</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">EpL</span><span class="p">.</span><span class="nx">angularAxis_2d_m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mf">2.5</span><span class="p">};</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">EpL</span><span class="p">.</span><span class="nx">reportType</span> <span class="o">=</span> <span class="s2">&quot;EpL&quot;</span><span class="p">;</span>
            
            <span class="c1">// Spring triangle.</span>
            <span class="kd">var</span> <span class="nx">d5_puckPars_triangle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;restitution&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;restitution_fixed&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;friction_fixed&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">};</span>
            <span class="kd">let</span> <span class="nx">xNudge_m</span> <span class="o">=</span> <span class="mf">0.10</span><span class="p">;</span>
            
            <span class="kd">var</span> <span class="nx">tri_vel_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">1.00</span> <span class="o">+</span> <span class="nx">xNudge_m</span><span class="p">,</span> <span class="mf">0.80</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span> <span class="nx">tri_vel_mps</span><span class="p">.</span><span class="nx">scaleBy</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">),</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">d5_puckPars_triangle</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck1&#39;</span><span class="p">}));</span>
            
            <span class="nx">tri_vel_mps</span><span class="p">.</span><span class="nx">rotated_by</span><span class="p">(</span><span class="o">-</span><span class="mf">120.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">1.50</span> <span class="o">+</span> <span class="nx">xNudge_m</span><span class="p">,</span> <span class="mf">0.80</span>                   <span class="p">),</span> <span class="nx">tri_vel_mps</span><span class="p">.</span><span class="nx">scaleBy</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">),</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">d5_puckPars_triangle</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck3&#39;</span><span class="p">}));</span>
            
            <span class="nx">tri_vel_mps</span><span class="p">.</span><span class="nx">rotated_by</span><span class="p">(</span><span class="o">-</span><span class="mf">120.0</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.50</span> <span class="o">+</span> <span class="nx">xNudge_m</span><span class="p">,</span> <span class="mf">0.80</span>                   <span class="p">),</span> <span class="nx">tri_vel_mps</span><span class="p">.</span><span class="nx">scaleBy</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">),</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">d5_puckPars_triangle</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck2&#39;</span><span class="p">}));</span>
            
            <span class="kd">var</span> <span class="nx">springColor1</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">;</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">],</span> 
                                        <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">60.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor1</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck3&#39;</span><span class="p">],</span> 
                                        <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">60.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor1</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck3&#39;</span><span class="p">],</span> 
                                        <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">60.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor1</span><span class="p">});</span>
            
            <span class="c1">// Single puck with two springs and pins.</span>
            <span class="kd">let</span> <span class="nx">p_radius_m</span> <span class="o">=</span> <span class="mf">1.30</span><span class="p">;</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="nx">p_radius_m</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck4&#39;</span><span class="p">,</span> <span class="s1">&#39;restitution&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> 
                         <span class="s1">&#39;angle_r&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;angDamp&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;linDamp&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;friction_fixed&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                         <span class="s1">&#39;angleLine&#39;</span><span class="o">:</span><span class="s1">&#39;stripe&#39;</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">});</span>
            <span class="kd">var</span> <span class="nx">springColor2</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">d5_springPars_onePuck</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor2</span><span class="p">,</span> <span class="s1">&#39;damper_Ns2pm2&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;drag_c&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">};</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck4&#39;</span><span class="p">],</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),{</span><span class="nx">borderColor</span><span class="o">:</span><span class="s1">&#39;yellow&#39;</span><span class="p">}),</span> 
                  <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">d5_springPars_onePuck</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;spo1_ap_l_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">p_radius_m</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">)})</span> <span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck4&#39;</span><span class="p">],</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),{</span><span class="nx">borderColor</span><span class="o">:</span><span class="s1">&#39;yellow&#39;</span><span class="p">}),</span> 
                  <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">d5_springPars_onePuck</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;spo1_ap_l_2d_m&#39;</span><span class="o">:</span><span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="nx">p_radius_m</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">)})</span> <span class="p">);</span>
                                        
            <span class="c1">// Two pucks (one bigger than the other) on spring orbiting each other (upper left corner)</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.00</span>                          <span class="o">*</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck5&#39;</span><span class="p">});</span>
            <span class="c1">// Scale the y velocity by the square of the radius ratio. This gives a net momentum of zero (so it stays in one place as it spins).</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">+</span><span class="mf">5.00</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">0.15</span><span class="o">/</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck6&#39;</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck5&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck6&#39;</span><span class="p">],</span> 
                                        <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor2</span><span class="p">});</span>
                                        
            <span class="c1">// Same thing (lower right corner)</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.70</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">+</span><span class="mf">4.90</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck7&#39;</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">4.70</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">4.90</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck8&#39;</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span><span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck7&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck8&#39;</span><span class="p">],</span> 
                                        <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="nx">springColor2</span><span class="p">});</span>
                                        
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;stretchy things&#39;          &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(5)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;conservation of angular momentum&#39;  &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;spring pendulum&#39;          &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;dandelion seeds&#39;          &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5d.js&#39;})\&quot;&gt;&amp;nbsp;d,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;chain-link loop using revolute joints&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5e.js&#39;})\&quot;&gt;&amp;nbsp;e,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;double-compound pendulum&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.f&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5f.js&#39;})\&quot;&gt;&amp;nbsp;f,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;wild west action&#39;         &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.g&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5g.js&#39;})\&quot;&gt;&amp;nbsp;g,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;Newton&amp;#39;s cradle&#39;      &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;5.h&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(5, {&#39;fileName&#39;:&#39;demo5h.js&#39;})\&quot;&gt;&amp;nbsp;h&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>

         
         <span class="c1">// Scroll AFTER loading the capture (and setting c.demoVersion) so can scroll to the special help for the 5d demo.</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// distance joints, Newton&#39;s cradle</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;5.h&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>                 
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5h&#39;</span><span class="p">);</span>
               
            <span class="c1">// spring pendulum   </span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;5.c&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5c&#39;</span><span class="p">);</span>
            
            <span class="c1">// dandelions   </span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="s1">&#39;5.d&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.a.dandelion&#39;</span><span class="p">))</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5d&#39;</span><span class="p">);</span>
                              
            <span class="c1">// distance joints, non-traditional springs</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.a.soft&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.a.twinkle&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5a_soft&#39;</span><span class="p">);</span>
               
            <span class="c1">// two puck on a spring in orbit, COM constant.</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.a.orbitingOnSpring&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5a-orbit&#39;</span><span class="p">);</span>          
               
            <span class="c1">// basketball</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.e.basketball&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;bphoops&#39;</span><span class="p">);</span>
               
            <span class="c1">// For this group of 5.b, must check the more specific ones first.</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b.two&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// inelastic collision</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5btwo&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b.four&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// inelastic collision</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5bfour&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b.five&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// inelastic collision</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5bfive&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b.six&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// inelastic collision</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5bsix&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b.rube&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// Rube&#39;s creation</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5brube&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;5.b&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5b&#39;</span><span class="p">);</span>   
               
            <span class="c1">// revolute joints</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="s1">&#39;5.e&#39;</span><span class="p">,</span><span class="s1">&#39;5.f&#39;</span><span class="p">,</span><span class="s1">&#39;5.g&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span> <span class="nx">demoVersionBase</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>               
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5e&#39;</span><span class="p">);</span>
               
            <span class="c1">// 5a -- 5d</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d5&#39;</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
      
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d6&#39;</span><span class="p">);</span>
         
         <span class="nx">c</span><span class="p">.</span><span class="nx">g_ON</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         
         <span class="c1">// This is an alternate way to fix the restitution and friction.</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
         
         <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">demo_6_fromFile</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">demo_6_fromFile</span><span class="p">);</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            <span class="nx">jM</span><span class="p">.</span><span class="nx">makeJello</span><span class="p">({});</span>
         <span class="p">}</span>
         
         <span class="nx">jM</span><span class="p">.</span><span class="nx">setUpPreGameHelp</span><span class="p">();</span>
      
         <span class="c1">// An extra puck to play with.</span>
         <span class="c1">//puckParms.restitution = 0.0;</span>
         <span class="c1">//new cP.Puck( 3.8, 5.5, v_init_2d_mps, puck_radius_m * 2.8, puckParms);</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;Jello Madness&#39;                            &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;6.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(6)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;the editor turned the jello into this...&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;6.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(6, {&#39;fileName&#39;:&#39;demo6b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;the editor turned the jello into this...&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;6.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(6, {&#39;fileName&#39;:&#39;demo6c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;a tough tangle...&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;6.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(6, {&#39;fileName&#39;:&#39;demo6d.js&#39;})\&quot;&gt;&amp;nbsp;d&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d7&#39;</span><span class="p">);</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">75</span><span class="p">};</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">200</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">popAtEnd</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span>   <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">25</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;ppTimer&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">45</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span>     <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">125</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;lowHelp&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">325</span><span class="p">};</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span> 
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> 
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
         
         <span class="nx">pP</span><span class="p">.</span><span class="nx">setBulletAgeLimit_ms</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">7</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">networkPuckTemplate</span> <span class="o">=</span> <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="c1">// Normal pucks</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span> <span class="c1">//   , &#39;categoryBits&#39;:&#39;0x0000&#39;, &#39;maskBits&#39;:&#39;0x0000&#39;, &#39;color&#39;:&#39;pink&#39;</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.65</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span> <span class="c1">//   , &#39;categoryBits&#39;:&#39;0x0000&#39;, &#39;maskBits&#39;:&#39;0x0000&#39;, &#39;color&#39;:&#39;pink&#39;</span>
            
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">2.75</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">+</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span>
            
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">5.65</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">+</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">5.65</span><span class="p">,</span> <span class="mf">5.65</span><span class="p">),</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.25</span><span class="p">});</span>
            
            <span class="c1">// Shelter</span>
            <span class="c1">//    Vertical part</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.50</span><span class="p">});</span>
            <span class="c1">//    Horizontal part</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            
            <span class="c1">// Note the &#39;bullet_restitution&#39;:0.85 in what follows for the local and NPC client pucks. I have</span>
            <span class="c1">// also changed the 7b,c,d (captures) to include this parameter and value for all the driven pucks.</span>
            
            <span class="c1">// Puck for the local client (the host) to drive.</span>
            <span class="kd">var</span> <span class="nx">position_2d_m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">velocity_2d_mps</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">dC</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
               <span class="c1">// Make the requested puck for the host</span>
               <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">position_2d_m</span><span class="p">,</span> <span class="nx">velocity_2d_mps</span><span class="p">,</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">hostPars</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="c1">// Don&#39;t actually create a puck for the host. But collect parameters needed for creating the network pucks in a</span>
               <span class="c1">// way that reflects the birth parameters here.</span>
               <span class="nx">networkPuckTemplate</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="p">{</span><span class="s1">&#39;position_2d_m&#39;</span><span class="o">:</span><span class="nx">position_2d_m</span><span class="p">,</span> <span class="s1">&#39;velocity_2d_mps&#39;</span><span class="o">:</span><span class="nx">velocity_2d_mps</span><span class="p">},</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">hostPars</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// A 4-pin track for NPC client navigation.</span>
            <span class="kd">var</span> <span class="nx">pinRadius</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">e1</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="nx">e2</span> <span class="o">=</span> <span class="mf">4.5</span><span class="p">;</span>
            <span class="nx">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">e1</span><span class="p">,</span> <span class="nx">e1</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_px&#39;</span><span class="o">:</span><span class="nx">pinRadius</span><span class="p">,</span> <span class="s1">&#39;NPC&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;previousPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin4&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;pin1&#39;</span><span class="p">,</span> <span class="s1">&#39;nextPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin2&#39;</span><span class="p">});</span>
            <span class="nx">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">e2</span><span class="p">,</span> <span class="nx">e1</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_px&#39;</span><span class="o">:</span><span class="nx">pinRadius</span><span class="p">,</span> <span class="s1">&#39;NPC&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;previousPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin1&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;pin2&#39;</span><span class="p">,</span> <span class="s1">&#39;nextPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin3&#39;</span><span class="p">});</span>
            <span class="nx">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">e2</span><span class="p">,</span> <span class="nx">e2</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_px&#39;</span><span class="o">:</span><span class="nx">pinRadius</span><span class="p">,</span> <span class="s1">&#39;NPC&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;previousPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin2&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;pin3&#39;</span><span class="p">,</span> <span class="s1">&#39;nextPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin4&#39;</span><span class="p">});</span>
            <span class="nx">p4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="nx">e1</span><span class="p">,</span> <span class="nx">e2</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_px&#39;</span><span class="o">:</span><span class="nx">pinRadius</span><span class="p">,</span> <span class="s1">&#39;NPC&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;previousPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin3&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;pin4&#39;</span><span class="p">,</span> <span class="s1">&#39;nextPinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin1&#39;</span><span class="p">});</span>
            
            <span class="c1">// Add local non-player clients (NPC, aka drones) and associated pucks to drive. Assign</span>
            <span class="c1">// a starting pin.</span>
            <span class="k">new</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;NPC1&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;purple&#39;</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">position_2d_m</span><span class="p">,</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">0.30</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;clientName&#39;</span><span class="o">:</span><span class="s1">&#39;NPC1&#39;</span><span class="p">,</span> <span class="s1">&#39;hitLimit&#39;</span><span class="o">:</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;pinName&#39;</span><span class="o">:</span><span class="s1">&#39;pin1&#39;</span><span class="p">,</span> <span class="s1">&#39;rayCast_init_deg&#39;</span><span class="o">:</span><span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;bullet_restitution&#39;</span><span class="o">:</span><span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;linDamp&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">}</span> <span class="p">);</span>
            <span class="c1">//new cT.Client({&#39;name&#39;:&#39;NPC2&#39;, &#39;color&#39;:&#39;purple&#39;});</span>
            <span class="c1">//new cP.Puck( p3.position_2d_m, new wS.Vec2D(0.0, 0.0), {&#39;radius_m&#39;:0.30, &#39;color&#39;:&#39;darkblue&#39;, &#39;colorSource&#39;:false, &#39;clientName&#39;:&#39;NPC2&#39;, &#39;linDamp&#39;:1.0, </span>
            <span class="c1">//                                                        &#39;hitLimit&#39;:20, &#39;pinName&#39;:&#39;pin3&#39;, &#39;rayCast_init_deg&#39;:-90} );</span>
            
            <span class="c1">// A 2-pin navigation track for a single client.</span>
            <span class="c1">//var p5 = new cP.Pin( new wS.Vec2D( 5.0, 2.5), {&#39;radius_px&#39;:pinRadius, &#39;NPC&#39;:true, &#39;previousPinName&#39;:&#39;pin6&#39;, &#39;name&#39;:&#39;pin5&#39;, &#39;nextPinName&#39;:&#39;pin6&#39;});</span>
            <span class="c1">//var p6 = new cP.Pin( new wS.Vec2D( 5.0, 3.5), {&#39;radius_px&#39;:pinRadius, &#39;NPC&#39;:true, &#39;previousPinName&#39;:&#39;pin5&#39;, &#39;name&#39;:&#39;pin6&#39;, &#39;nextPinName&#39;:&#39;pin5&#39;});</span>
            <span class="c1">//new cT.Client({&#39;name&#39;:&#39;NPC3&#39;, &#39;color&#39;:&#39;purple&#39;});</span>
            <span class="c1">//new cP.Puck( new wS.Vec2D( 5.0, 2.5), new wS.Vec2D(0.0, 0.0), {&#39;radius_m&#39;:0.30, &#39;color&#39;:&#39;darkblue&#39;, &#39;colorSource&#39;:false, &#39;clientName&#39;:&#39;NPC3&#39;, &#39;linDamp&#39;:1.0, </span>
            <span class="c1">//                                                               &#39;hitLimit&#39;:20, &#39;pinName&#39;:&#39;pin5&#39;, &#39;rayCast_init_deg&#39;:0} );</span>
            
            <span class="c1">// Make a one single-pin track and corresponding NPC client.</span>
            <span class="c1">//pP.makeNPC_OnSinglePin(1, cP.Pin.nameIndex + 1, cT.Client.npcIndex + 1, new wS.Vec2D( 1.0, 1.0));</span>
         <span class="p">}</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">state_capture</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">state_capture</span><span class="p">.</span><span class="nx">startingPosAndVels</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span> <span class="o">=</span> <span class="nx">state_capture</span><span class="p">.</span><span class="nx">startingPosAndVels</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span> <span class="o">=</span> <span class="nx">defaultStartingPosAndVel</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="nx">pP</span><span class="p">.</span><span class="nx">createPucksForNetworkClients</span><span class="p">(</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">networkPuckTemplate</span><span class="p">,</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span><span class="p">);</span>
         <span class="nx">pP</span><span class="p">.</span><span class="nx">preGameSetUp</span><span class="p">(</span> <span class="mi">7</span><span class="p">);</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;Puck Popper (1 drone on 4 pins)&#39;  &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;7.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  onclick=\&quot;cR.clearState(); dS.demoStart(7)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;2 drones on 4 pins&#39;               &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;7.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  onclick=\&quot;cR.demoStart_fromCapture(7, {&#39;fileName&#39;:&#39;demo7b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;4 drones on 5 pins&#39;               &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;7.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  onclick=\&quot;cR.demoStart_fromCapture(7, {&#39;fileName&#39;:&#39;demo7c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;1 drone on 2 pins&#39;                &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;7.d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  onclick=\&quot;cR.demoStart_fromCapture(7, {&#39;fileName&#39;:&#39;demo7d.js&#39;})\&quot;&gt;&amp;nbsp;d,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;puck cannibalization inside springy chain&#39;&quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;7.e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  onclick=\&quot;cR.demoStart_fromCapture(7, {&#39;fileName&#39;:&#39;demo7e.js&#39;})\&quot;&gt;&amp;nbsp;e&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
         
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
         
         <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">950</span><span class="p">;</span>
         <span class="nx">adjustSizeOfChatDiv</span><span class="p">(</span><span class="s1">&#39;small&#39;</span><span class="p">);</span> <span class="c1">// on the host (note: chat div is set to normal as the default, see the beginning of demoStart)  </span>
         <span class="nx">hC</span><span class="p">.</span><span class="nx">resizeClients</span><span class="p">(</span><span class="s1">&#39;small&#39;</span><span class="p">);</span>    <span class="c1">// adjust chat div on the clients</span>
         <span class="c1">// Set this module-level value to help new connecting clients adjust their layout.</span>
         <span class="nx">c</span><span class="p">.</span><span class="nx">chatLayoutState</span> <span class="o">=</span> <span class="s1">&#39;small&#39;</span><span class="p">;</span>
         
         <span class="c1">// Must do this AFTER the chat-div adjustment.</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d8&#39;</span><span class="p">);</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">84</span><span class="p">};</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">200</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;gameTitle&#39;</span><span class="p">].</span><span class="nx">popAtEnd</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
         
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">].</span><span class="nx">loc_px</span>   <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">35</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;ppTimer&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">55</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span>     <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">120</span><span class="p">};</span>
         <span class="nx">gW</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="s1">&#39;lowHelp&#39;</span><span class="p">].</span><span class="nx">loc_px</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="o">:</span><span class="mi">325</span><span class="p">};</span>
         
         <span class="nx">c</span><span class="p">.</span><span class="nx">g_ON</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">gravity</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
         
         <span class="c1">// This applies only to pucks without fixed parameters:</span>
         <span class="c1">// Keep the restitution low (but not zero) for gOff situations (zero will produce bullets that act like clay). </span>
         <span class="c1">// Low restitution helps the drones fly smoothly through the navigation channels in the terrain.</span>
         <span class="c1">// setGravityRelatedParameters runs after the drones are restored.</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="nx">pP</span><span class="p">.</span><span class="nx">setBulletAgeLimit_ms</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">networkPuckTemplate</span> <span class="o">=</span> <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
         
         <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">demo_8_fromFile</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Don&#39;t need to parse here because read in from a file.</span>
            <span class="nx">networkPuckTemplate</span> <span class="o">=</span> <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">demo_8_fromFile</span><span class="p">);</span>
            
            <span class="c1">// Some little walls in the middle.</span>
            <span class="cm">/*</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 2.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02, &#39;angularSpeed_rps&#39;:3.14});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 3.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 4.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02, &#39;angularSpeed_rps&#39;:3.14/2});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 5.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 6.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02, &#39;angularSpeed_rps&#39;:3.14});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 7.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02});</span>
<span class="cm">            new cP.Wall( new wS.Vec2D( 8.0, 0.5), {&#39;half_width_m&#39;:0.4, &#39;half_height_m&#39;:0.02, &#39;angularSpeed_rps&#39;:3.14/2});            </span>
<span class="cm">            */</span>
            
            <span class="cm">/*</span>
<span class="cm">            // Puck for the local client (the host) to drive.</span>
<span class="cm">            if (dC.player.checked) {</span>
<span class="cm">               new cP.Puck( new wS.Vec2D(3.0, 4.5), new wS.Vec2D(0.0, 0.0), {&#39;radius_m&#39;:0.30, &#39;color&#39;:&#39;black&#39;, &#39;colorSource&#39;:true, &#39;clientName&#39;:&#39;local&#39;, &#39;linDamp&#39;:1.0, &#39;hitLimit&#39;:20} );</span>
<span class="cm">            }</span>
<span class="cm">            </span>
<span class="cm">            var pinRadius = 3;</span>
<span class="cm">            p1 = new cP.Pin( new wS.Vec2D( 1.0, 2.0), {&#39;radius_px&#39;:pinRadius, &#39;NPC&#39;:true, &#39;previousPinName&#39;:&#39;pin103&#39;, &#39;name&#39;:&#39;pin101&#39;, &#39;nextPinName&#39;:&#39;pin102&#39;});</span>
<span class="cm">            p2 = new cP.Pin( new wS.Vec2D( 1.0, 4.0), {&#39;radius_px&#39;:pinRadius, &#39;NPC&#39;:true, &#39;previousPinName&#39;:&#39;pin101&#39;, &#39;name&#39;:&#39;pin102&#39;, &#39;nextPinName&#39;:&#39;pin103&#39;});</span>
<span class="cm">            p3 = new cP.Pin( new wS.Vec2D( 1.0, 5.0), {&#39;radius_px&#39;:pinRadius, &#39;NPC&#39;:true, &#39;previousPinName&#39;:&#39;pin102&#39;, &#39;name&#39;:&#39;pin103&#39;, &#39;nextPinName&#39;:&#39;pin101&#39;});</span>
<span class="cm">            */</span>
            
            <span class="cm">/*</span>
<span class="cm">            // Add some local non-player clients (NPCs)</span>
<span class="cm">            new cT.Client({&#39;name&#39;:&#39;NPC3&#39;, &#39;color&#39;:&#39;purple&#39;});</span>
<span class="cm">            new cT.Client({&#39;name&#39;:&#39;NPC4&#39;, &#39;color&#39;:&#39;purple&#39;});</span>
<span class="cm">            </span>
<span class="cm">            // Controllable pucks for these NPC clients; assign a starting pin.</span>
<span class="cm">            new cP.Puck( new wS.Vec2D( 1.0, 2.0), new wS.Vec2D(0.0, 0.0), {&#39;radius_m&#39;:0.30, &#39;color&#39;:&#39;darkblue&#39;, &#39;colorSource&#39;:false, &#39;clientName&#39;:&#39;NPC3&#39;, &#39;linDamp&#39;:1.0, &#39;hitLimit&#39;:20, &#39;pinName&#39;:&#39;pin102&#39;} );</span>
<span class="cm">            new cP.Puck( new wS.Vec2D( 1.0, 2.0), new wS.Vec2D(0.0, 0.0), {&#39;radius_m&#39;:0.30, &#39;color&#39;:&#39;darkblue&#39;, &#39;colorSource&#39;:false, &#39;clientName&#39;:&#39;NPC4&#39;, &#39;linDamp&#39;:1.0, &#39;hitLimit&#39;:20, &#39;pinName&#39;:&#39;pin103&#39;} );</span>
<span class="cm">            */</span>
            
            <span class="c1">// Make a set of drones and single-pin navigation tracks (use editor to add more pins if wanted). </span>
            <span class="c1">//pP.makeNPC_OnSinglePin(3, cP.Pin.nameIndex + 1, cT.Client.npcIndex + 1, new wS.Vec2D( 1.0, 1.0));</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">jM</span><span class="p">.</span><span class="nx">makeJello</span><span class="p">({</span><span class="s1">&#39;pinned&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;gridsize&#39;</span><span class="o">:</span><span class="mi">4</span><span class="p">});</span>
          
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="c1">// Some little walls in the middle.</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;angularSpeed_rps&#39;</span><span class="o">:</span><span class="mf">3.14</span><span class="o">/</span><span class="mi">2</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;half_width_m&#39;</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;half_height_m&#39;</span><span class="o">:</span><span class="mf">0.02</span><span class="p">});</span>
            
         <span class="p">}</span>
         
         <span class="k">if</span> <span class="p">(</span><span class="nx">state_capture</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">state_capture</span><span class="p">.</span><span class="nx">startingPosAndVels</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span> <span class="o">=</span> <span class="nx">state_capture</span><span class="p">.</span><span class="nx">startingPosAndVels</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span> <span class="o">=</span> <span class="nx">defaultStartingPosAndVel</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="nx">pP</span><span class="p">.</span><span class="nx">createPucksForNetworkClients</span><span class="p">(</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">networkPuckTemplate</span><span class="p">,</span> <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">startingPandV</span><span class="p">);</span>
         <span class="nx">pP</span><span class="p">.</span><span class="nx">preGameSetUp</span><span class="p">(</span> <span class="mi">8</span><span class="p">);</span>
         
         <span class="c1">// Removing the old version of 8c (similar to 8b). </span>
         <span class="c1">// File is still out there for running from a URL query string. Old one runs as 8f now.</span>
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
           <span class="s2">&quot;&lt;a title=&#39;Puck Popper (with jello)&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;8.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(8)\&quot; style=&#39;cursor: pointer&#39;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
           <span class="s2">&quot;&lt;a title=&#39;high-noon maze&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;8.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(8, {&#39;fileName&#39;:&#39;demo8b.js&#39;})\&quot;&gt;&amp;nbsp;b,&lt;/a&gt;&quot;</span> <span class="o">+</span>
           <span class="s2">&quot;&lt;a title=&#39;wide open spaces (no drag)&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;8.c&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(8, {&#39;fileName&#39;:&#39;demo8c.js&#39;})\&quot;&gt;&amp;nbsp;c,&lt;/a&gt;&quot;</span> <span class="o">+</span>
           <span class="s2">&quot;&lt;a title=&#39;bullet energy (no drag, and elastic collisions)&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;8.d&#39;</span><span class="p">)</span> <span class="o">+</span>
                                                   <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(8, {&#39;fileName&#39;:&#39;demo8d.js&#39;})\&quot;&gt;&amp;nbsp;d,&lt;/a&gt;&quot;</span> <span class="o">+</span>
           <span class="s2">&quot;&lt;a title=&#39;target-leading demo (no recoil, no drag, and elastic collisions)&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;8.e&#39;</span><span class="p">)</span> <span class="o">+</span>
                                                   <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(8, {&#39;fileName&#39;:&#39;demo8e.js&#39;})\&quot;&gt;&amp;nbsp;e&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
                  
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">scrollHelp</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;d9&#39;</span><span class="p">);</span>
         
         <span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOn</span> <span class="o">=</span>  <span class="mf">0.7</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOn</span> <span class="o">=</span>  <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">restitution_gOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
         <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">.</span><span class="nx">friction_gOff</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="k">if</span> <span class="p">((</span><span class="nx">state_capture</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">state_capture</span><span class="p">.</span><span class="nx">demoIndex</span> <span class="o">==</span> <span class="mi">9</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cR</span><span class="p">.</span><span class="nx">restoreFromState</span><span class="p">(</span> <span class="nx">state_capture</span><span class="p">);</span>
            
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>            
            <span class="nx">cP</span><span class="p">.</span><span class="nx">Wall</span><span class="p">.</span><span class="nx">makeFence</span><span class="p">({},</span> <span class="nx">canvas</span><span class="p">);</span>
            
            <span class="c1">// To simulate additive color mixing.</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="s1">&#39;screen&#39;</span><span class="p">;</span> <span class="c1">// &#39;source-over&#39; &#39;screen&#39;</span>
            
            <span class="c1">// pucks</span>
            <span class="kd">var</span> <span class="nx">puckStart_2d_m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">puckBasePars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;radius_m&#39;</span><span class="o">:</span><span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;borderWidth_px&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;angleLine&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;colorSource&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;linDamp&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;angDamp&#39;</span><span class="o">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;friction&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">};</span>
            <span class="c1">// Green, Red, and Blue</span>
            <span class="c1">// Use Object.assign to make an independent pars object (a copy) that builds off the puckBasePars object. Note: it is important to</span>
            <span class="c1">// have the {} target in order to make a copy. If you use puckBasePars as the target, you&#39;ll just keep updating the reference to </span>
            <span class="c1">// puckBasePars (not good).</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">puckStart_2d_m</span><span class="p">,</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">+</span><span class="mf">0.08</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">),</span>   <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">puckBasePars</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck1&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">}));</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">puckStart_2d_m</span><span class="p">,</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">),</span>   <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">puckBasePars</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck2&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;#ff0000&#39;</span><span class="p">}));</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Puck</span><span class="p">(</span> <span class="nx">puckStart_2d_m</span><span class="p">,</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="mf">0.0894</span><span class="p">),</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">puckBasePars</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;puck3&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;#0000ff&#39;</span><span class="p">}));</span>
            
            <span class="c1">// Springs between the three pucks</span>
            <span class="kd">var</span> <span class="nx">springPars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">25.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.125</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;damper_Ns2pm2&#39;</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span> 
                              <span class="s1">&#39;softConstraints&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;collideConnected&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;white&#39;</span><span class="p">};</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">],</span> <span class="nx">springPars</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck3&#39;</span><span class="p">],</span> <span class="nx">springPars</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck3&#39;</span><span class="p">],</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">],</span> <span class="nx">springPars</span><span class="p">);</span>
            
            <span class="c1">// Three weaker springs (on final-position pins) that bring the triangle back to a nice center position.</span>
            <span class="kd">var</span> <span class="nx">centeringSpringPars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;length_m&#39;</span><span class="o">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;strength_Npm&#39;</span><span class="o">:</span><span class="mf">10.0</span><span class="p">,</span> <span class="s1">&#39;unstretched_width_m&#39;</span><span class="o">:</span><span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;damper_Ns2pm2&#39;</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span> 
                                       <span class="s1">&#39;softConstraints&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;collideConnected&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="s1">&#39;white&#39;</span><span class="p">};</span>
            <span class="nx">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.711</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;borderColor&#39;</span><span class="o">:</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fillColor&#39;</span><span class="o">:</span><span class="s1">&#39;black&#39;</span><span class="p">});</span>
            <span class="nx">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.711</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;borderColor&#39;</span><span class="o">:</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fillColor&#39;</span><span class="o">:</span><span class="s1">&#39;black&#39;</span><span class="p">});</span>
            <span class="nx">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Pin</span><span class="p">(</span> <span class="k">new</span> <span class="nx">wS</span><span class="p">.</span><span class="nx">Vec2D</span><span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.577</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;borderColor&#39;</span><span class="o">:</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fillColor&#39;</span><span class="o">:</span><span class="s1">&#39;black&#39;</span><span class="p">});</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck1&#39;</span><span class="p">],</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">centeringSpringPars</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck2&#39;</span><span class="p">],</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">centeringSpringPars</span><span class="p">);</span>
            <span class="k">new</span> <span class="nx">cP</span><span class="p">.</span><span class="nx">Spring</span><span class="p">(</span> <span class="nx">aT</span><span class="p">.</span><span class="nx">puckMap</span><span class="p">[</span><span class="s1">&#39;puck3&#39;</span><span class="p">],</span> <span class="nx">p3</span><span class="p">,</span> <span class="nx">centeringSpringPars</span><span class="p">);</span>
         <span class="p">}</span>
         
         <span class="nx">dC</span><span class="p">.</span><span class="nx">extraDemos</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> 
            <span class="s2">&quot;&lt;a title=&#39;color mixer&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;9.a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.clearState(); dS.demoStart(9)\&quot;&gt;&amp;nbsp;a,&lt;/a&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;a title=&#39;colorful&#39; &quot;</span> <span class="o">+</span> <span class="nx">hL</span><span class="p">(</span><span class="s1">&#39;9.b&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; onclick=\&quot;cR.demoStart_fromCapture(9, {&#39;fileName&#39;:&#39;demo9b.js&#39;})\&quot;&gt;&amp;nbsp;b&amp;nbsp;&lt;/a&gt;&quot;</span><span class="p">;</span>
         
      <span class="p">}</span>
      
      <span class="c1">// Now, after all the scripted and captured demos have loaded and possibly turned gravity on/off, update the gravity related stuff.</span>
      <span class="nx">setGravityRelatedParameters</span><span class="p">({</span><span class="s2">&quot;updatePucks&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
      
      <span class="c1">// If any demo uses special canvas dimensions, now is a good time to let the clients know.</span>
      <span class="c1">// (note: this canvas resize is different from the chat div resizing that is done for demo 8).</span>
      <span class="nx">eV</span><span class="p">.</span><span class="nx">setClientCanvasToMatchHost</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">logThis</span><span class="p">)</span> <span class="nx">pS</span><span class="p">.</span><span class="nx">logEntry</span><span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">);</span>
      
      <span class="c1">// Sometimes just want to be sure the user gets the fullscreen view.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">fullScreenDemo</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">eVN</span><span class="p">.</span><span class="nx">changeFullScreenMode</span><span class="p">(</span> <span class="nx">canvas</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Start all client with shot-locks equal to the host.</span>
      <span class="nx">cT</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">applyToAll</span><span class="p">(</span> <span class="nx">client</span> <span class="p">=&gt;</span> <span class="p">{</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">ctrlShiftLock</span> <span class="o">=</span> <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">ctrlShiftLock</span><span class="p">;</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">poolShotLocked</span> <span class="o">=</span> <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">poolShotLocked</span><span class="p">;</span>
         <span class="nx">client</span><span class="p">.</span><span class="nx">poolShotLockedSpeed_mps</span> <span class="o">=</span> <span class="nx">clients</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">].</span><span class="nx">poolShotLockedSpeed_mps</span><span class="p">;</span>
      <span class="p">});</span>
      
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;c.demoVersion=&#39;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">demoVersion</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="kd">function</span> <span class="nx">testing</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;===================================&quot;</span><span class="p">);</span>
      
      <span class="k">try</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;dS testing: canvas.width = &quot;</span> <span class="o">+</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;canvas.width Error: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">try</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;dS testing: gW.aT.testObj.test = &quot;</span> <span class="o">+</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">aT</span><span class="p">.</span><span class="nx">testObj</span><span class="p">.</span><span class="nx">test</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;gW.aT.testObj.test: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">}</span>
        
      <span class="k">try</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;exposed canvas.width = &quot;</span> <span class="o">+</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;gW.canvas.width Error: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">get_hostCanvasWH</span><span class="p">()</span> <span class="p">));</span>
      <span class="c1">//gW.set_hostCanvasWH(300,300);</span>
      
      <span class="k">try</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;dS testing: gW.testGlobal.something = &quot;</span> <span class="o">+</span> <span class="nx">gW</span><span class="p">.</span><span class="nx">testGlobal</span><span class="p">.</span><span class="nx">something</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;gW.testGlobal.something: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
   
   
   <span class="c1">// Public references to objects, variables, and methods</span>
   
   <span class="k">return</span> <span class="p">{</span>
      <span class="c1">// Objects</span>
      
      <span class="c1">// Variables</span>
      
      <span class="c1">// Methods</span>
      <span class="s1">&#39;initializeModule&#39;</span><span class="o">:</span> <span class="nx">initializeModule</span><span class="p">,</span>
      <span class="s1">&#39;testing&#39;</span><span class="o">:</span> <span class="nx">testing</span><span class="p">,</span>
      
      <span class="s1">&#39;demoStart&#39;</span><span class="o">:</span> <span class="nx">demoStart</span><span class="p">,</span>
      <span class="s1">&#39;demoVersionBase&#39;</span><span class="o">:</span> <span class="nx">demoVersionBase</span><span class="p">,</span>
      <span class="s1">&#39;demoVersionIndex&#39;</span><span class="o">:</span> <span class="nx">demoVersionIndex</span><span class="p">,</span>
      <span class="s1">&#39;setGravityRelatedParameters&#39;</span><span class="o">:</span> <span class="nx">setGravityRelatedParameters</span><span class="p">,</span>
      <span class="s1">&#39;fullScreenState&#39;</span><span class="o">:</span> <span class="nx">fullScreenState</span><span class="p">,</span>
      <span class="s1">&#39;adjustSizeOfChatDiv&#39;</span><span class="o">:</span> <span class="nx">adjustSizeOfChatDiv</span><span class="p">,</span>
      <span class="s1">&#39;setNickNameWithoutConnecting&#39;</span><span class="o">:</span> <span class="nx">setNickNameWithoutConnecting</span><span class="p">,</span>
      <span class="s1">&#39;defaultStartingPosAndVel&#39;</span><span class="o">:</span> <span class="nx">defaultStartingPosAndVel</span><span class="p">,</span>

   <span class="p">};</span>   
   
<span class="p">})();</span>
</pre></div>
</body>
</html>
